{"data":"aW1wb3J0ICogYXMgUmVhY3QgZnJvbSAicmVhY3QiOwppbXBvcnQgeyBTbG90IH0gZnJvbSAiQHJhZGl4LXVpL3JlYWN0LXNsb3QiOwppbXBvcnQgeyBWYXJpYW50UHJvcHMsIGN2YSB9IGZyb20gImNsYXNzLXZhcmlhbmNlLWF1dGhvcml0eSI7CmltcG9ydCB7IFBhbmVsTGVmdCB9IGZyb20gImx1Y2lkZS1yZWFjdCI7CgppbXBvcnQgeyB1c2VJc01vYmlsZSB9IGZyb20gIkAvaG9va3MvdXNlLW1vYmlsZSI7CmltcG9ydCB7IGNuIH0gZnJvbSAiQC9saWIvdXRpbHMiOwppbXBvcnQgeyBCdXR0b24gfSBmcm9tICJAL2NvbXBvbmVudHMvdWkvYnV0dG9uIjsKaW1wb3J0IHsgSW5wdXQgfSBmcm9tICJAL2NvbXBvbmVudHMvdWkvaW5wdXQiOwppbXBvcnQgeyBTZXBhcmF0b3IgfSBmcm9tICJAL2NvbXBvbmVudHMvdWkvc2VwYXJhdG9yIjsKaW1wb3J0IHsgU2hlZXQsIFNoZWV0Q29udGVudCB9IGZyb20gIkAvY29tcG9uZW50cy91aS9zaGVldCI7CmltcG9ydCB7IFNrZWxldG9uIH0gZnJvbSAiQC9jb21wb25lbnRzL3VpL3NrZWxldG9uIjsKaW1wb3J0IHsgVG9vbHRpcCwgVG9vbHRpcENvbnRlbnQsIFRvb2x0aXBQcm92aWRlciwgVG9vbHRpcFRyaWdnZXIgfSBmcm9tICJAL2NvbXBvbmVudHMvdWkvdG9vbHRpcCI7Cgpjb25zdCBTSURFQkFSX0NPT0tJRV9OQU1FID0gInNpZGViYXI6c3RhdGUiOwpjb25zdCBTSURFQkFSX0NPT0tJRV9NQVhfQUdFID0gNjAgKiA2MCAqIDI0ICogNzsKY29uc3QgU0lERUJBUl9XSURUSCA9ICIxNnJlbSI7CmNvbnN0IFNJREVCQVJfV0lEVEhfTU9CSUxFID0gIjE4cmVtIjsKY29uc3QgU0lERUJBUl9XSURUSF9JQ09OID0gIjNyZW0iOwpjb25zdCBTSURFQkFSX0tFWUJPQVJEX1NIT1JUQ1VUID0gImIiOwoKdHlwZSBTaWRlYmFyQ29udGV4dCA9IHsKICBzdGF0ZTogImV4cGFuZGVkIiB8ICJjb2xsYXBzZWQiOwogIG9wZW46IGJvb2xlYW47CiAgc2V0T3BlbjogKG9wZW46IGJvb2xlYW4pID0+IHZvaWQ7CiAgb3Blbk1vYmlsZTogYm9vbGVhbjsKICBzZXRPcGVuTW9iaWxlOiAob3BlbjogYm9vbGVhbikgPT4gdm9pZDsKICBpc01vYmlsZTogYm9vbGVhbjsKICB0b2dnbGVTaWRlYmFyOiAoKSA9PiB2b2lkOwp9OwoKY29uc3QgU2lkZWJhckNvbnRleHQgPSBSZWFjdC5jcmVhdGVDb250ZXh0PFNpZGViYXJDb250ZXh0IHwgbnVsbD4obnVsbCk7CgpmdW5jdGlvbiB1c2VTaWRlYmFyKCkgewogIGNvbnN0IGNvbnRleHQgPSBSZWFjdC51c2VDb250ZXh0KFNpZGViYXJDb250ZXh0KTsKICBpZiAoIWNvbnRleHQpIHsKICAgIHRocm93IG5ldyBFcnJvcigidXNlU2lkZWJhciBtdXN0IGJlIHVzZWQgd2l0aGluIGEgU2lkZWJhclByb3ZpZGVyLiIpOwogIH0KCiAgcmV0dXJuIGNvbnRleHQ7Cn0KCmNvbnN0IFNpZGViYXJQcm92aWRlciA9IFJlYWN0LmZvcndhcmRSZWY8CiAgSFRNTERpdkVsZW1lbnQsCiAgUmVhY3QuQ29tcG9uZW50UHJvcHM8ImRpdiI+ICYgewogICAgZGVmYXVsdE9wZW4/OiBib29sZWFuOwogICAgb3Blbj86IGJvb2xlYW47CiAgICBvbk9wZW5DaGFuZ2U/OiAob3BlbjogYm9vbGVhbikgPT4gdm9pZDsKICB9Cj4oKHsgZGVmYXVsdE9wZW4gPSB0cnVlLCBvcGVuOiBvcGVuUHJvcCwgb25PcGVuQ2hhbmdlOiBzZXRPcGVuUHJvcCwgY2xhc3NOYW1lLCBzdHlsZSwgY2hpbGRyZW4sIC4uLnByb3BzIH0sIHJlZikgPT4gewogIGNvbnN0IGlzTW9iaWxlID0gdXNlSXNNb2JpbGUoKTsKICBjb25zdCBbb3Blbk1vYmlsZSwgc2V0T3Blbk1vYmlsZV0gPSBSZWFjdC51c2VTdGF0ZShmYWxzZSk7CgogIC8vIFRoaXMgaXMgdGhlIGludGVybmFsIHN0YXRlIG9mIHRoZSBzaWRlYmFyLgogIC8vIFdlIHVzZSBvcGVuUHJvcCBhbmQgc2V0T3BlblByb3AgZm9yIGNvbnRyb2wgZnJvbSBvdXRzaWRlIHRoZSBjb21wb25lbnQuCiAgY29uc3QgW19vcGVuLCBfc2V0T3Blbl0gPSBSZWFjdC51c2VTdGF0ZShkZWZhdWx0T3Blbik7CiAgY29uc3Qgb3BlbiA9IG9wZW5Qcm9wID8/IF9vcGVuOwogIGNvbnN0IHNldE9wZW4gPSBSZWFjdC51c2VDYWxsYmFjaygKICAgICh2YWx1ZTogYm9vbGVhbiB8ICgodmFsdWU6IGJvb2xlYW4pID0+IGJvb2xlYW4pKSA9PiB7CiAgICAgIGNvbnN0IG9wZW5TdGF0ZSA9IHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIiA/IHZhbHVlKG9wZW4pIDogdmFsdWU7CiAgICAgIGlmIChzZXRPcGVuUHJvcCkgewogICAgICAgIHNldE9wZW5Qcm9wKG9wZW5TdGF0ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX3NldE9wZW4ob3BlblN0YXRlKTsKICAgICAgfQoKICAgICAgLy8gVGhpcyBzZXRzIHRoZSBjb29raWUgdG8ga2VlcCB0aGUgc2lkZWJhciBzdGF0ZS4KICAgICAgZG9jdW1lbnQuY29va2llID0gYCR7U0lERUJBUl9DT09LSUVfTkFNRX09JHtvcGVuU3RhdGV9OyBwYXRoPS87IG1heC1hZ2U9JHtTSURFQkFSX0NPT0tJRV9NQVhfQUdFfWA7CiAgICB9LAogICAgW3NldE9wZW5Qcm9wLCBvcGVuXSwKICApOwoKICAvLyBIZWxwZXIgdG8gdG9nZ2xlIHRoZSBzaWRlYmFyLgogIGNvbnN0IHRvZ2dsZVNpZGViYXIgPSBSZWFjdC51c2VDYWxsYmFjaygoKSA9PiB7CiAgICByZXR1cm4gaXNNb2JpbGUgPyBzZXRPcGVuTW9iaWxlKChvcGVuKSA9PiAhb3BlbikgOiBzZXRPcGVuKChvcGVuKSA9PiAhb3Blbik7CiAgfSwgW2lzTW9iaWxlLCBzZXRPcGVuLCBzZXRPcGVuTW9iaWxlXSk7CgogIC8vIEFkZHMgYSBrZXlib2FyZCBzaG9ydGN1dCB0byB0b2dnbGUgdGhlIHNpZGViYXIuCiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgIGNvbnN0IGhhbmRsZUtleURvd24gPSAoZXZlbnQ6IEtleWJvYXJkRXZlbnQpID0+IHsKICAgICAgaWYgKGV2ZW50LmtleSA9PT0gU0lERUJBUl9LRVlCT0FSRF9TSE9SVENVVCAmJiAoZXZlbnQubWV0YUtleSB8fCBldmVudC5jdHJsS2V5KSkgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdG9nZ2xlU2lkZWJhcigpOwogICAgICB9CiAgICB9OwoKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgaGFuZGxlS2V5RG93bik7CiAgICByZXR1cm4gKCkgPT4gd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBoYW5kbGVLZXlEb3duKTsKICB9LCBbdG9nZ2xlU2lkZWJhcl0pOwoKICAvLyBXZSBhZGQgYSBzdGF0ZSBzbyB0aGF0IHdlIGNhbiBkbyBkYXRhLXN0YXRlPSJleHBhbmRlZCIgb3IgImNvbGxhcHNlZCIuCiAgLy8gVGhpcyBtYWtlcyBpdCBlYXNpZXIgdG8gc3R5bGUgdGhlIHNpZGViYXIgd2l0aCBUYWlsd2luZCBjbGFzc2VzLgogIGNvbnN0IHN0YXRlID0gb3BlbiA/ICJleHBhbmRlZCIgOiAiY29sbGFwc2VkIjsKCiAgY29uc3QgY29udGV4dFZhbHVlID0gUmVhY3QudXNlTWVtbzxTaWRlYmFyQ29udGV4dD4oCiAgICAoKSA9PiAoewogICAgICBzdGF0ZSwKICAgICAgb3BlbiwKICAgICAgc2V0T3BlbiwKICAgICAgaXNNb2JpbGUsCiAgICAgIG9wZW5Nb2JpbGUsCiAgICAgIHNldE9wZW5Nb2JpbGUsCiAgICAgIHRvZ2dsZVNpZGViYXIsCiAgICB9KSwKICAgIFtzdGF0ZSwgb3Blbiwgc2V0T3BlbiwgaXNNb2JpbGUsIG9wZW5Nb2JpbGUsIHNldE9wZW5Nb2JpbGUsIHRvZ2dsZVNpZGViYXJdLAogICk7CgogIHJldHVybiAoCiAgICA8U2lkZWJhckNvbnRleHQuUHJvdmlkZXIgdmFsdWU9e2NvbnRleHRWYWx1ZX0+CiAgICAgIDxUb29sdGlwUHJvdmlkZXIgZGVsYXlEdXJhdGlvbj17MH0+CiAgICAgICAgPGRpdgogICAgICAgICAgc3R5bGU9ewogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIi0tc2lkZWJhci13aWR0aCI6IFNJREVCQVJfV0lEVEgsCiAgICAgICAgICAgICAgIi0tc2lkZWJhci13aWR0aC1pY29uIjogU0lERUJBUl9XSURUSF9JQ09OLAogICAgICAgICAgICAgIC4uLnN0eWxlLAogICAgICAgICAgICB9IGFzIFJlYWN0LkNTU1Byb3BlcnRpZXMKICAgICAgICAgIH0KICAgICAgICAgIGNsYXNzTmFtZT17Y24oImdyb3VwL3NpZGViYXItd3JhcHBlciBmbGV4IG1pbi1oLXN2aCB3LWZ1bGwgaGFzLVtbZGF0YS12YXJpYW50PWluc2V0XV06Ymctc2lkZWJhciIsIGNsYXNzTmFtZSl9CiAgICAgICAgICByZWY9e3JlZn0KICAgICAgICAgIHsuLi5wcm9wc30KICAgICAgICA+CiAgICAgICAgICB7Y2hpbGRyZW59CiAgICAgICAgPC9kaXY+CiAgICAgIDwvVG9vbHRpcFByb3ZpZGVyPgogICAgPC9TaWRlYmFyQ29udGV4dC5Qcm92aWRlcj4KICApOwp9KTsKU2lkZWJhclByb3ZpZGVyLmRpc3BsYXlOYW1lID0gIlNpZGViYXJQcm92aWRlciI7Cgpjb25zdCBTaWRlYmFyID0gUmVhY3QuZm9yd2FyZFJlZjwKICBIVE1MRGl2RWxlbWVudCwKICBSZWFjdC5Db21wb25lbnRQcm9wczwiZGl2Ij4gJiB7CiAgICBzaWRlPzogImxlZnQiIHwgInJpZ2h0IjsKICAgIHZhcmlhbnQ/OiAic2lkZWJhciIgfCAiZmxvYXRpbmciIHwgImluc2V0IjsKICAgIGNvbGxhcHNpYmxlPzogIm9mZmNhbnZhcyIgfCAiaWNvbiIgfCAibm9uZSI7CiAgfQo+KCh7IHNpZGUgPSAibGVmdCIsIHZhcmlhbnQgPSAic2lkZWJhciIsIGNvbGxhcHNpYmxlID0gIm9mZmNhbnZhcyIsIGNsYXNzTmFtZSwgY2hpbGRyZW4sIC4uLnByb3BzIH0sIHJlZikgPT4gewogIGNvbnN0IHsgaXNNb2JpbGUsIHN0YXRlLCBvcGVuTW9iaWxlLCBzZXRPcGVuTW9iaWxlIH0gPSB1c2VTaWRlYmFyKCk7CgogIGlmIChjb2xsYXBzaWJsZSA9PT0gIm5vbmUiKSB7CiAgICByZXR1cm4gKAogICAgICA8ZGl2CiAgICAgICAgY2xhc3NOYW1lPXtjbigiZmxleCBoLWZ1bGwgdy1bLS1zaWRlYmFyLXdpZHRoXSBmbGV4LWNvbCBiZy1zaWRlYmFyIHRleHQtc2lkZWJhci1mb3JlZ3JvdW5kIiwgY2xhc3NOYW1lKX0KICAgICAgICByZWY9e3JlZn0KICAgICAgICB7Li4ucHJvcHN9CiAgICAgID4KICAgICAgICB7Y2hpbGRyZW59CiAgICAgIDwvZGl2PgogICAgKTsKICB9CgogIGlmIChpc01vYmlsZSkgewogICAgcmV0dXJuICgKICAgICAgPFNoZWV0IG9wZW49e29wZW5Nb2JpbGV9IG9uT3BlbkNoYW5nZT17c2V0T3Blbk1vYmlsZX0gey4uLnByb3BzfT4KICAgICAgICA8U2hlZXRDb250ZW50CiAgICAgICAgICBkYXRhLXNpZGViYXI9InNpZGViYXIiCiAgICAgICAgICBkYXRhLW1vYmlsZT0idHJ1ZSIKICAgICAgICAgIGNsYXNzTmFtZT0idy1bLS1zaWRlYmFyLXdpZHRoXSBiZy1zaWRlYmFyIHAtMCB0ZXh0LXNpZGViYXItZm9yZWdyb3VuZCBbJj5idXR0b25dOmhpZGRlbiIKICAgICAgICAgIHN0eWxlPXsKICAgICAgICAgICAgewogICAgICAgICAgICAgICItLXNpZGViYXItd2lkdGgiOiBTSURFQkFSX1dJRFRIX01PQklMRSwKICAgICAgICAgICAgfSBhcyBSZWFjdC5DU1NQcm9wZXJ0aWVzCiAgICAgICAgICB9CiAgICAgICAgICBzaWRlPXtzaWRlfQogICAgICAgID4KICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGgtZnVsbCB3LWZ1bGwgZmxleC1jb2wiPntjaGlsZHJlbn08L2Rpdj4KICAgICAgICA8L1NoZWV0Q29udGVudD4KICAgICAgPC9TaGVldD4KICAgICk7CiAgfQoKICByZXR1cm4gKAogICAgPGRpdgogICAgICByZWY9e3JlZn0KICAgICAgY2xhc3NOYW1lPSJncm91cCBwZWVyIGhpZGRlbiB0ZXh0LXNpZGViYXItZm9yZWdyb3VuZCBtZDpibG9jayIKICAgICAgZGF0YS1zdGF0ZT17c3RhdGV9CiAgICAgIGRhdGEtY29sbGFwc2libGU9e3N0YXRlID09PSAiY29sbGFwc2VkIiA/IGNvbGxhcHNpYmxlIDogIiJ9CiAgICAgIGRhdGEtdmFyaWFudD17dmFyaWFudH0KICAgICAgZGF0YS1zaWRlPXtzaWRlfQogICAgPgogICAgICB7LyogVGhpcyBpcyB3aGF0IGhhbmRsZXMgdGhlIHNpZGViYXIgZ2FwIG9uIGRlc2t0b3AgKi99CiAgICAgIDxkaXYKICAgICAgICBjbGFzc05hbWU9e2NuKAogICAgICAgICAgInJlbGF0aXZlIGgtc3ZoIHctWy0tc2lkZWJhci13aWR0aF0gYmctdHJhbnNwYXJlbnQgdHJhbnNpdGlvbi1bd2lkdGhdIGR1cmF0aW9uLTIwMCBlYXNlLWxpbmVhciIsCiAgICAgICAgICAiZ3JvdXAtZGF0YS1bY29sbGFwc2libGU9b2ZmY2FudmFzXTp3LTAiLAogICAgICAgICAgImdyb3VwLWRhdGEtW3NpZGU9cmlnaHRdOnJvdGF0ZS0xODAiLAogICAgICAgICAgdmFyaWFudCA9PT0gImZsb2F0aW5nIiB8fCB2YXJpYW50ID09PSAiaW5zZXQiCiAgICAgICAgICAgID8gImdyb3VwLWRhdGEtW2NvbGxhcHNpYmxlPWljb25dOnctW2NhbGModmFyKC0tc2lkZWJhci13aWR0aC1pY29uKV8rX3RoZW1lKHNwYWNpbmcuNCkpXSIKICAgICAgICAgICAgOiAiZ3JvdXAtZGF0YS1bY29sbGFwc2libGU9aWNvbl06dy1bLS1zaWRlYmFyLXdpZHRoLWljb25dIiwKICAgICAgICApfQogICAgICAvPgogICAgICA8ZGl2CiAgICAgICAgY2xhc3NOYW1lPXtjbigKICAgICAgICAgICJmaXhlZCBpbnNldC15LTAgei0xMCBoaWRkZW4gaC1zdmggdy1bLS1zaWRlYmFyLXdpZHRoXSB0cmFuc2l0aW9uLVtsZWZ0LHJpZ2h0LHdpZHRoXSBkdXJhdGlvbi0yMDAgZWFzZS1saW5lYXIgbWQ6ZmxleCIsCiAgICAgICAgICBzaWRlID09PSAibGVmdCIKICAgICAgICAgICAgPyAibGVmdC0wIGdyb3VwLWRhdGEtW2NvbGxhcHNpYmxlPW9mZmNhbnZhc106bGVmdC1bY2FsYyh2YXIoLS1zaWRlYmFyLXdpZHRoKSotMSldIgogICAgICAgICAgICA6ICJyaWdodC0wIGdyb3VwLWRhdGEtW2NvbGxhcHNpYmxlPW9mZmNhbnZhc106cmlnaHQtW2NhbGModmFyKC0tc2lkZWJhci13aWR0aCkqLTEpXSIsCiAgICAgICAgICAvLyBBZGp1c3QgdGhlIHBhZGRpbmcgZm9yIGZsb2F0aW5nIGFuZCBpbnNldCB2YXJpYW50cy4KICAgICAgICAgIHZhcmlhbnQgPT09ICJmbG9hdGluZyIgfHwgdmFyaWFudCA9PT0gImluc2V0IgogICAgICAgICAgICA/ICJwLTIgZ3JvdXAtZGF0YS1bY29sbGFwc2libGU9aWNvbl06dy1bY2FsYyh2YXIoLS1zaWRlYmFyLXdpZHRoLWljb24pXytfdGhlbWUoc3BhY2luZy40KV8rMnB4KV0iCiAgICAgICAgICAgIDogImdyb3VwLWRhdGEtW2NvbGxhcHNpYmxlPWljb25dOnctWy0tc2lkZWJhci13aWR0aC1pY29uXSBncm91cC1kYXRhLVtzaWRlPWxlZnRdOmJvcmRlci1yIGdyb3VwLWRhdGEtW3NpZGU9cmlnaHRdOmJvcmRlci1sIiwKICAgICAgICAgIGNsYXNzTmFtZSwKICAgICAgICApfQogICAgICAgIHsuLi5wcm9wc30KICAgICAgPgogICAgICAgIDxkaXYKICAgICAgICAgIGRhdGEtc2lkZWJhcj0ic2lkZWJhciIKICAgICAgICAgIGNsYXNzTmFtZT0iZmxleCBoLWZ1bGwgdy1mdWxsIGZsZXgtY29sIGJnLXNpZGViYXIgZ3JvdXAtZGF0YS1bdmFyaWFudD1mbG9hdGluZ106cm91bmRlZC1sZyBncm91cC1kYXRhLVt2YXJpYW50PWZsb2F0aW5nXTpib3JkZXIgZ3JvdXAtZGF0YS1bdmFyaWFudD1mbG9hdGluZ106Ym9yZGVyLXNpZGViYXItYm9yZGVyIGdyb3VwLWRhdGEtW3ZhcmlhbnQ9ZmxvYXRpbmddOnNoYWRvdyIKICAgICAgICA+CiAgICAgICAgICB7Y2hpbGRyZW59CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgKTsKfSk7ClNpZGViYXIuZGlzcGxheU5hbWUgPSAiU2lkZWJhciI7Cgpjb25zdCBTaWRlYmFyVHJpZ2dlciA9IFJlYWN0LmZvcndhcmRSZWY8UmVhY3QuRWxlbWVudFJlZjx0eXBlb2YgQnV0dG9uPiwgUmVhY3QuQ29tcG9uZW50UHJvcHM8dHlwZW9mIEJ1dHRvbj4+KAogICh7IGNsYXNzTmFtZSwgb25DbGljaywgLi4ucHJvcHMgfSwgcmVmKSA9PiB7CiAgICBjb25zdCB7IHRvZ2dsZVNpZGViYXIgfSA9IHVzZVNpZGViYXIoKTsKCiAgICByZXR1cm4gKAogICAgICA8QnV0dG9uCiAgICAgICAgcmVmPXtyZWZ9CiAgICAgICAgZGF0YS1zaWRlYmFyPSJ0cmlnZ2VyIgogICAgICAgIHZhcmlhbnQ9Imdob3N0IgogICAgICAgIHNpemU9Imljb24iCiAgICAgICAgY2xhc3NOYW1lPXtjbigiaC03IHctNyIsIGNsYXNzTmFtZSl9CiAgICAgICAgb25DbGljaz17KGV2ZW50KSA9PiB7CiAgICAgICAgICBvbkNsaWNrPy4oZXZlbnQpOwogICAgICAgICAgdG9nZ2xlU2lkZWJhcigpOwogICAgICAgIH19CiAgICAgICAgey4uLnByb3BzfQogICAgICA+CiAgICAgICAgPFBhbmVsTGVmdCAvPgogICAgICAgIDxzcGFuIGNsYXNzTmFtZT0ic3Itb25seSI+VG9nZ2xlIFNpZGViYXI8L3NwYW4+CiAgICAgIDwvQnV0dG9uPgogICAgKTsKICB9LAopOwpTaWRlYmFyVHJpZ2dlci5kaXNwbGF5TmFtZSA9ICJTaWRlYmFyVHJpZ2dlciI7Cgpjb25zdCBTaWRlYmFyUmFpbCA9IFJlYWN0LmZvcndhcmRSZWY8SFRNTEJ1dHRvbkVsZW1lbnQsIFJlYWN0LkNvbXBvbmVudFByb3BzPCJidXR0b24iPj4oCiAgKHsgY2xhc3NOYW1lLCAuLi5wcm9wcyB9LCByZWYpID0+IHsKICAgIGNvbnN0IHsgdG9nZ2xlU2lkZWJhciB9ID0gdXNlU2lkZWJhcigpOwoKICAgIHJldHVybiAoCiAgICAgIDxidXR0b24KICAgICAgICByZWY9e3JlZn0KICAgICAgICBkYXRhLXNpZGViYXI9InJhaWwiCiAgICAgICAgYXJpYS1sYWJlbD0iVG9nZ2xlIFNpZGViYXIiCiAgICAgICAgdGFiSW5kZXg9ey0xfQogICAgICAgIG9uQ2xpY2s9e3RvZ2dsZVNpZGViYXJ9CiAgICAgICAgdGl0bGU9IlRvZ2dsZSBTaWRlYmFyIgogICAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgICAiYWJzb2x1dGUgaW5zZXQteS0wIHotMjAgaGlkZGVuIHctNCAtdHJhbnNsYXRlLXgtMS8yIHRyYW5zaXRpb24tYWxsIGVhc2UtbGluZWFyIGFmdGVyOmFic29sdXRlIGFmdGVyOmluc2V0LXktMCBhZnRlcjpsZWZ0LTEvMiBhZnRlcjp3LVsycHhdIGdyb3VwLWRhdGEtW3NpZGU9bGVmdF06LXJpZ2h0LTQgZ3JvdXAtZGF0YS1bc2lkZT1yaWdodF06bGVmdC0wIGhvdmVyOmFmdGVyOmJnLXNpZGViYXItYm9yZGVyIHNtOmZsZXgiLAogICAgICAgICAgIltbZGF0YS1zaWRlPWxlZnRdXyZdOmN1cnNvci13LXJlc2l6ZSBbW2RhdGEtc2lkZT1yaWdodF1fJl06Y3Vyc29yLWUtcmVzaXplIiwKICAgICAgICAgICJbW2RhdGEtc2lkZT1sZWZ0XVtkYXRhLXN0YXRlPWNvbGxhcHNlZF1fJl06Y3Vyc29yLWUtcmVzaXplIFtbZGF0YS1zaWRlPXJpZ2h0XVtkYXRhLXN0YXRlPWNvbGxhcHNlZF1fJl06Y3Vyc29yLXctcmVzaXplIiwKICAgICAgICAgICJncm91cC1kYXRhLVtjb2xsYXBzaWJsZT1vZmZjYW52YXNdOnRyYW5zbGF0ZS14LTAgZ3JvdXAtZGF0YS1bY29sbGFwc2libGU9b2ZmY2FudmFzXTphZnRlcjpsZWZ0LWZ1bGwgZ3JvdXAtZGF0YS1bY29sbGFwc2libGU9b2ZmY2FudmFzXTpob3ZlcjpiZy1zaWRlYmFyIiwKICAgICAgICAgICJbW2RhdGEtc2lkZT1sZWZ0XVtkYXRhLWNvbGxhcHNpYmxlPW9mZmNhbnZhc11fJl06LXJpZ2h0LTIiLAogICAgICAgICAgIltbZGF0YS1zaWRlPXJpZ2h0XVtkYXRhLWNvbGxhcHNpYmxlPW9mZmNhbnZhc11fJl06LWxlZnQtMiIsCiAgICAgICAgICBjbGFzc05hbWUsCiAgICAgICAgKX0KICAgICAgICB7Li4ucHJvcHN9CiAgICAgIC8+CiAgICApOwogIH0sCik7ClNpZGViYXJSYWlsLmRpc3BsYXlOYW1lID0gIlNpZGViYXJSYWlsIjsKCmNvbnN0IFNpZGViYXJJbnNldCA9IFJlYWN0LmZvcndhcmRSZWY8SFRNTERpdkVsZW1lbnQsIFJlYWN0LkNvbXBvbmVudFByb3BzPCJtYWluIj4+KCh7IGNsYXNzTmFtZSwgLi4ucHJvcHMgfSwgcmVmKSA9PiB7CiAgcmV0dXJuICgKICAgIDxtYWluCiAgICAgIHJlZj17cmVmfQogICAgICBjbGFzc05hbWU9e2NuKAogICAgICAgICJyZWxhdGl2ZSBmbGV4IG1pbi1oLXN2aCBmbGV4LTEgZmxleC1jb2wgYmctYmFja2dyb3VuZCIsCiAgICAgICAgInBlZXItZGF0YS1bdmFyaWFudD1pbnNldF06bWluLWgtW2NhbGMoMTAwc3ZoLXRoZW1lKHNwYWNpbmcuNCkpXSBtZDpwZWVyLWRhdGEtW3ZhcmlhbnQ9aW5zZXRdOm0tMiBtZDpwZWVyLWRhdGEtW3N0YXRlPWNvbGxhcHNlZF06cGVlci1kYXRhLVt2YXJpYW50PWluc2V0XTptbC0yIG1kOnBlZXItZGF0YS1bdmFyaWFudD1pbnNldF06bWwtMCBtZDpwZWVyLWRhdGEtW3ZhcmlhbnQ9aW5zZXRdOnJvdW5kZWQteGwgbWQ6cGVlci1kYXRhLVt2YXJpYW50PWluc2V0XTpzaGFkb3ciLAogICAgICAgIGNsYXNzTmFtZSwKICAgICAgKX0KICAgICAgey4uLnByb3BzfQogICAgLz4KICApOwp9KTsKU2lkZWJhckluc2V0LmRpc3BsYXlOYW1lID0gIlNpZGViYXJJbnNldCI7Cgpjb25zdCBTaWRlYmFySW5wdXQgPSBSZWFjdC5mb3J3YXJkUmVmPFJlYWN0LkVsZW1lbnRSZWY8dHlwZW9mIElucHV0PiwgUmVhY3QuQ29tcG9uZW50UHJvcHM8dHlwZW9mIElucHV0Pj4oCiAgKHsgY2xhc3NOYW1lLCAuLi5wcm9wcyB9LCByZWYpID0+IHsKICAgIHJldHVybiAoCiAgICAgIDxJbnB1dAogICAgICAgIHJlZj17cmVmfQogICAgICAgIGRhdGEtc2lkZWJhcj0iaW5wdXQiCiAgICAgICAgY2xhc3NOYW1lPXtjbigKICAgICAgICAgICJoLTggdy1mdWxsIGJnLWJhY2tncm91bmQgc2hhZG93LW5vbmUgZm9jdXMtdmlzaWJsZTpyaW5nLTIgZm9jdXMtdmlzaWJsZTpyaW5nLXNpZGViYXItcmluZyIsCiAgICAgICAgICBjbGFzc05hbWUsCiAgICAgICAgKX0KICAgICAgICB7Li4ucHJvcHN9CiAgICAgIC8+CiAgICApOwogIH0sCik7ClNpZGViYXJJbnB1dC5kaXNwbGF5TmFtZSA9ICJTaWRlYmFySW5wdXQiOwoKY29uc3QgU2lkZWJhckhlYWRlciA9IFJlYWN0LmZvcndhcmRSZWY8SFRNTERpdkVsZW1lbnQsIFJlYWN0LkNvbXBvbmVudFByb3BzPCJkaXYiPj4oKHsgY2xhc3NOYW1lLCAuLi5wcm9wcyB9LCByZWYpID0+IHsKICByZXR1cm4gPGRpdiByZWY9e3JlZn0gZGF0YS1zaWRlYmFyPSJoZWFkZXIiIGNsYXNzTmFtZT17Y24oImZsZXggZmxleC1jb2wgZ2FwLTIgcC0yIiwgY2xhc3NOYW1lKX0gey4uLnByb3BzfSAvPjsKfSk7ClNpZGViYXJIZWFkZXIuZGlzcGxheU5hbWUgPSAiU2lkZWJhckhlYWRlciI7Cgpjb25zdCBTaWRlYmFyRm9vdGVyID0gUmVhY3QuZm9yd2FyZFJlZjxIVE1MRGl2RWxlbWVudCwgUmVhY3QuQ29tcG9uZW50UHJvcHM8ImRpdiI+PigoeyBjbGFzc05hbWUsIC4uLnByb3BzIH0sIHJlZikgPT4gewogIHJldHVybiA8ZGl2IHJlZj17cmVmfSBkYXRhLXNpZGViYXI9ImZvb3RlciIgY2xhc3NOYW1lPXtjbigiZmxleCBmbGV4LWNvbCBnYXAtMiBwLTIiLCBjbGFzc05hbWUpfSB7Li4ucHJvcHN9IC8+Owp9KTsKU2lkZWJhckZvb3Rlci5kaXNwbGF5TmFtZSA9ICJTaWRlYmFyRm9vdGVyIjsKCmNvbnN0IFNpZGViYXJTZXBhcmF0b3IgPSBSZWFjdC5mb3J3YXJkUmVmPFJlYWN0LkVsZW1lbnRSZWY8dHlwZW9mIFNlcGFyYXRvcj4sIFJlYWN0LkNvbXBvbmVudFByb3BzPHR5cGVvZiBTZXBhcmF0b3I+PigKICAoeyBjbGFzc05hbWUsIC4uLnByb3BzIH0sIHJlZikgPT4gewogICAgcmV0dXJuICgKICAgICAgPFNlcGFyYXRvcgogICAgICAgIHJlZj17cmVmfQogICAgICAgIGRhdGEtc2lkZWJhcj0ic2VwYXJhdG9yIgogICAgICAgIGNsYXNzTmFtZT17Y24oIm14LTIgdy1hdXRvIGJnLXNpZGViYXItYm9yZGVyIiwgY2xhc3NOYW1lKX0KICAgICAgICB7Li4ucHJvcHN9CiAgICAgIC8+CiAgICApOwogIH0sCik7ClNpZGViYXJTZXBhcmF0b3IuZGlzcGxheU5hbWUgPSAiU2lkZWJhclNlcGFyYXRvciI7Cgpjb25zdCBTaWRlYmFyQ29udGVudCA9IFJlYWN0LmZvcndhcmRSZWY8SFRNTERpdkVsZW1lbnQsIFJlYWN0LkNvbXBvbmVudFByb3BzPCJkaXYiPj4oKHsgY2xhc3NOYW1lLCAuLi5wcm9wcyB9LCByZWYpID0+IHsKICByZXR1cm4gKAogICAgPGRpdgogICAgICByZWY9e3JlZn0KICAgICAgZGF0YS1zaWRlYmFyPSJjb250ZW50IgogICAgICBjbGFzc05hbWU9e2NuKAogICAgICAgICJmbGV4IG1pbi1oLTAgZmxleC0xIGZsZXgtY29sIGdhcC0yIG92ZXJmbG93LWF1dG8gZ3JvdXAtZGF0YS1bY29sbGFwc2libGU9aWNvbl06b3ZlcmZsb3ctaGlkZGVuIiwKICAgICAgICBjbGFzc05hbWUsCiAgICAgICl9CiAgICAgIHsuLi5wcm9wc30KICAgIC8+CiAgKTsKfSk7ClNpZGViYXJDb250ZW50LmRpc3BsYXlOYW1lID0gIlNpZGViYXJDb250ZW50IjsKCmNvbnN0IFNpZGViYXJHcm91cCA9IFJlYWN0LmZvcndhcmRSZWY8SFRNTERpdkVsZW1lbnQsIFJlYWN0LkNvbXBvbmVudFByb3BzPCJkaXYiPj4oKHsgY2xhc3NOYW1lLCAuLi5wcm9wcyB9LCByZWYpID0+IHsKICByZXR1cm4gKAogICAgPGRpdgogICAgICByZWY9e3JlZn0KICAgICAgZGF0YS1zaWRlYmFyPSJncm91cCIKICAgICAgY2xhc3NOYW1lPXtjbigicmVsYXRpdmUgZmxleCB3LWZ1bGwgbWluLXctMCBmbGV4LWNvbCBwLTIiLCBjbGFzc05hbWUpfQogICAgICB7Li4ucHJvcHN9CiAgICAvPgogICk7Cn0pOwpTaWRlYmFyR3JvdXAuZGlzcGxheU5hbWUgPSAiU2lkZWJhckdyb3VwIjsKCmNvbnN0IFNpZGViYXJHcm91cExhYmVsID0gUmVhY3QuZm9yd2FyZFJlZjxIVE1MRGl2RWxlbWVudCwgUmVhY3QuQ29tcG9uZW50UHJvcHM8ImRpdiI+ICYgeyBhc0NoaWxkPzogYm9vbGVhbiB9PigKICAoeyBjbGFzc05hbWUsIGFzQ2hpbGQgPSBmYWxzZSwgLi4ucHJvcHMgfSwgcmVmKSA9PiB7CiAgICBjb25zdCBDb21wID0gYXNDaGlsZCA/IFNsb3QgOiAiZGl2IjsKCiAgICByZXR1cm4gKAogICAgICA8Q29tcAogICAgICAgIHJlZj17cmVmfQogICAgICAgIGRhdGEtc2lkZWJhcj0iZ3JvdXAtbGFiZWwiCiAgICAgICAgY2xhc3NOYW1lPXtjbigKICAgICAgICAgICJmbGV4IGgtOCBzaHJpbmstMCBpdGVtcy1jZW50ZXIgcm91bmRlZC1tZCBweC0yIHRleHQteHMgZm9udC1tZWRpdW0gdGV4dC1zaWRlYmFyLWZvcmVncm91bmQvNzAgb3V0bGluZS1ub25lIHJpbmctc2lkZWJhci1yaW5nIHRyYW5zaXRpb24tW21hcmdpbixvcGFdIGR1cmF0aW9uLTIwMCBlYXNlLWxpbmVhciBmb2N1cy12aXNpYmxlOnJpbmctMiBbJj5zdmddOnNpemUtNCBbJj5zdmddOnNocmluay0wIiwKICAgICAgICAgICJncm91cC1kYXRhLVtjb2xsYXBzaWJsZT1pY29uXTotbXQtOCBncm91cC1kYXRhLVtjb2xsYXBzaWJsZT1pY29uXTpvcGFjaXR5LTAiLAogICAgICAgICAgY2xhc3NOYW1lLAogICAgICAgICl9CiAgICAgICAgey4uLnByb3BzfQogICAgICAvPgogICAgKTsKICB9LAopOwpTaWRlYmFyR3JvdXBMYWJlbC5kaXNwbGF5TmFtZSA9ICJTaWRlYmFyR3JvdXBMYWJlbCI7Cgpjb25zdCBTaWRlYmFyR3JvdXBBY3Rpb24gPSBSZWFjdC5mb3J3YXJkUmVmPEhUTUxCdXR0b25FbGVtZW50LCBSZWFjdC5Db21wb25lbnRQcm9wczwiYnV0dG9uIj4gJiB7IGFzQ2hpbGQ/OiBib29sZWFuIH0+KAogICh7IGNsYXNzTmFtZSwgYXNDaGlsZCA9IGZhbHNlLCAuLi5wcm9wcyB9LCByZWYpID0+IHsKICAgIGNvbnN0IENvbXAgPSBhc0NoaWxkID8gU2xvdCA6ICJidXR0b24iOwoKICAgIHJldHVybiAoCiAgICAgIDxDb21wCiAgICAgICAgcmVmPXtyZWZ9CiAgICAgICAgZGF0YS1zaWRlYmFyPSJncm91cC1hY3Rpb24iCiAgICAgICAgY2xhc3NOYW1lPXtjbigKICAgICAgICAgICJhYnNvbHV0ZSByaWdodC0zIHRvcC0zLjUgZmxleCBhc3BlY3Qtc3F1YXJlIHctNSBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcm91bmRlZC1tZCBwLTAgdGV4dC1zaWRlYmFyLWZvcmVncm91bmQgb3V0bGluZS1ub25lIHJpbmctc2lkZWJhci1yaW5nIHRyYW5zaXRpb24tdHJhbnNmb3JtIGhvdmVyOmJnLXNpZGViYXItYWNjZW50IGhvdmVyOnRleHQtc2lkZWJhci1hY2NlbnQtZm9yZWdyb3VuZCBmb2N1cy12aXNpYmxlOnJpbmctMiBbJj5zdmddOnNpemUtNCBbJj5zdmddOnNocmluay0wIiwKICAgICAgICAgIC8vIEluY3JlYXNlcyB0aGUgaGl0IGFyZWEgb2YgdGhlIGJ1dHRvbiBvbiBtb2JpbGUuCiAgICAgICAgICAiYWZ0ZXI6YWJzb2x1dGUgYWZ0ZXI6LWluc2V0LTIgYWZ0ZXI6bWQ6aGlkZGVuIiwKICAgICAgICAgICJncm91cC1kYXRhLVtjb2xsYXBzaWJsZT1pY29uXTpoaWRkZW4iLAogICAgICAgICAgY2xhc3NOYW1lLAogICAgICAgICl9CiAgICAgICAgey4uLnByb3BzfQogICAgICAvPgogICAgKTsKICB9LAopOwpTaWRlYmFyR3JvdXBBY3Rpb24uZGlzcGxheU5hbWUgPSAiU2lkZWJhckdyb3VwQWN0aW9uIjsKCmNvbnN0IFNpZGViYXJHcm91cENvbnRlbnQgPSBSZWFjdC5mb3J3YXJkUmVmPEhUTUxEaXZFbGVtZW50LCBSZWFjdC5Db21wb25lbnRQcm9wczwiZGl2Ij4+KAogICh7IGNsYXNzTmFtZSwgLi4ucHJvcHMgfSwgcmVmKSA9PiAoCiAgICA8ZGl2IHJlZj17cmVmfSBkYXRhLXNpZGViYXI9Imdyb3VwLWNvbnRlbnQiIGNsYXNzTmFtZT17Y24oInctZnVsbCB0ZXh0LXNtIiwgY2xhc3NOYW1lKX0gey4uLnByb3BzfSAvPgogICksCik7ClNpZGViYXJHcm91cENvbnRlbnQuZGlzcGxheU5hbWUgPSAiU2lkZWJhckdyb3VwQ29udGVudCI7Cgpjb25zdCBTaWRlYmFyTWVudSA9IFJlYWN0LmZvcndhcmRSZWY8SFRNTFVMaXN0RWxlbWVudCwgUmVhY3QuQ29tcG9uZW50UHJvcHM8InVsIj4+KCh7IGNsYXNzTmFtZSwgLi4ucHJvcHMgfSwgcmVmKSA9PiAoCiAgPHVsIHJlZj17cmVmfSBkYXRhLXNpZGViYXI9Im1lbnUiIGNsYXNzTmFtZT17Y24oImZsZXggdy1mdWxsIG1pbi13LTAgZmxleC1jb2wgZ2FwLTEiLCBjbGFzc05hbWUpfSB7Li4ucHJvcHN9IC8+CikpOwpTaWRlYmFyTWVudS5kaXNwbGF5TmFtZSA9ICJTaWRlYmFyTWVudSI7Cgpjb25zdCBTaWRlYmFyTWVudUl0ZW0gPSBSZWFjdC5mb3J3YXJkUmVmPEhUTUxMSUVsZW1lbnQsIFJlYWN0LkNvbXBvbmVudFByb3BzPCJsaSI+PigoeyBjbGFzc05hbWUsIC4uLnByb3BzIH0sIHJlZikgPT4gKAogIDxsaSByZWY9e3JlZn0gZGF0YS1zaWRlYmFyPSJtZW51LWl0ZW0iIGNsYXNzTmFtZT17Y24oImdyb3VwL21lbnUtaXRlbSByZWxhdGl2ZSIsIGNsYXNzTmFtZSl9IHsuLi5wcm9wc30gLz4KKSk7ClNpZGViYXJNZW51SXRlbS5kaXNwbGF5TmFtZSA9ICJTaWRlYmFyTWVudUl0ZW0iOwoKY29uc3Qgc2lkZWJhck1lbnVCdXR0b25WYXJpYW50cyA9IGN2YSgKICAicGVlci9tZW51LWJ1dHRvbiBmbGV4IHctZnVsbCBpdGVtcy1jZW50ZXIgZ2FwLTIgb3ZlcmZsb3ctaGlkZGVuIHJvdW5kZWQtbWQgcC0yIHRleHQtbGVmdCB0ZXh0LXNtIG91dGxpbmUtbm9uZSByaW5nLXNpZGViYXItcmluZyB0cmFuc2l0aW9uLVt3aWR0aCxoZWlnaHQscGFkZGluZ10gaG92ZXI6Ymctc2lkZWJhci1hY2NlbnQgaG92ZXI6dGV4dC1zaWRlYmFyLWFjY2VudC1mb3JlZ3JvdW5kIGZvY3VzLXZpc2libGU6cmluZy0yIGFjdGl2ZTpiZy1zaWRlYmFyLWFjY2VudCBhY3RpdmU6dGV4dC1zaWRlYmFyLWFjY2VudC1mb3JlZ3JvdW5kIGRpc2FibGVkOnBvaW50ZXItZXZlbnRzLW5vbmUgZGlzYWJsZWQ6b3BhY2l0eS01MCBncm91cC1oYXMtW1tkYXRhLXNpZGViYXI9bWVudS1hY3Rpb25dXS9tZW51LWl0ZW06cHItOCBhcmlhLWRpc2FibGVkOnBvaW50ZXItZXZlbnRzLW5vbmUgYXJpYS1kaXNhYmxlZDpvcGFjaXR5LTUwIGRhdGEtW2FjdGl2ZT10cnVlXTpiZy1zaWRlYmFyLWFjY2VudCBkYXRhLVthY3RpdmU9dHJ1ZV06Zm9udC1tZWRpdW0gZGF0YS1bYWN0aXZlPXRydWVdOnRleHQtc2lkZWJhci1hY2NlbnQtZm9yZWdyb3VuZCBkYXRhLVtzdGF0ZT1vcGVuXTpob3ZlcjpiZy1zaWRlYmFyLWFjY2VudCBkYXRhLVtzdGF0ZT1vcGVuXTpob3Zlcjp0ZXh0LXNpZGViYXItYWNjZW50LWZvcmVncm91bmQgZ3JvdXAtZGF0YS1bY29sbGFwc2libGU9aWNvbl06IXNpemUtOCBncm91cC1kYXRhLVtjb2xsYXBzaWJsZT1pY29uXTohcC0yIFsmPnNwYW46bGFzdC1jaGlsZF06dHJ1bmNhdGUgWyY+c3ZnXTpzaXplLTQgWyY+c3ZnXTpzaHJpbmstMCIsCiAgewogICAgdmFyaWFudHM6IHsKICAgICAgdmFyaWFudDogewogICAgICAgIGRlZmF1bHQ6ICJob3ZlcjpiZy1zaWRlYmFyLWFjY2VudCBob3Zlcjp0ZXh0LXNpZGViYXItYWNjZW50LWZvcmVncm91bmQiLAogICAgICAgIG91dGxpbmU6CiAgICAgICAgICAiYmctYmFja2dyb3VuZCBzaGFkb3ctWzBfMF8wXzFweF9oc2wodmFyKC0tc2lkZWJhci1ib3JkZXIpKV0gaG92ZXI6Ymctc2lkZWJhci1hY2NlbnQgaG92ZXI6dGV4dC1zaWRlYmFyLWFjY2VudC1mb3JlZ3JvdW5kIGhvdmVyOnNoYWRvdy1bMF8wXzBfMXB4X2hzbCh2YXIoLS1zaWRlYmFyLWFjY2VudCkpXSIsCiAgICAgIH0sCiAgICAgIHNpemU6IHsKICAgICAgICBkZWZhdWx0OiAiaC04IHRleHQtc20iLAogICAgICAgIHNtOiAiaC03IHRleHQteHMiLAogICAgICAgIGxnOiAiaC0xMiB0ZXh0LXNtIGdyb3VwLWRhdGEtW2NvbGxhcHNpYmxlPWljb25dOiFwLTAiLAogICAgICB9LAogICAgfSwKICAgIGRlZmF1bHRWYXJpYW50czogewogICAgICB2YXJpYW50OiAiZGVmYXVsdCIsCiAgICAgIHNpemU6ICJkZWZhdWx0IiwKICAgIH0sCiAgfSwKKTsKCmNvbnN0IFNpZGViYXJNZW51QnV0dG9uID0gUmVhY3QuZm9yd2FyZFJlZjwKICBIVE1MQnV0dG9uRWxlbWVudCwKICBSZWFjdC5Db21wb25lbnRQcm9wczwiYnV0dG9uIj4gJiB7CiAgICBhc0NoaWxkPzogYm9vbGVhbjsKICAgIGlzQWN0aXZlPzogYm9vbGVhbjsKICAgIHRvb2x0aXA/OiBzdHJpbmcgfCBSZWFjdC5Db21wb25lbnRQcm9wczx0eXBlb2YgVG9vbHRpcENvbnRlbnQ+OwogIH0gJiBWYXJpYW50UHJvcHM8dHlwZW9mIHNpZGViYXJNZW51QnV0dG9uVmFyaWFudHM+Cj4oKHsgYXNDaGlsZCA9IGZhbHNlLCBpc0FjdGl2ZSA9IGZhbHNlLCB2YXJpYW50ID0gImRlZmF1bHQiLCBzaXplID0gImRlZmF1bHQiLCB0b29sdGlwLCBjbGFzc05hbWUsIC4uLnByb3BzIH0sIHJlZikgPT4gewogIGNvbnN0IENvbXAgPSBhc0NoaWxkID8gU2xvdCA6ICJidXR0b24iOwogIGNvbnN0IHsgaXNNb2JpbGUsIHN0YXRlIH0gPSB1c2VTaWRlYmFyKCk7CgogIGNvbnN0IGJ1dHRvbiA9ICgKICAgIDxDb21wCiAgICAgIHJlZj17cmVmfQogICAgICBkYXRhLXNpZGViYXI9Im1lbnUtYnV0dG9uIgogICAgICBkYXRhLXNpemU9e3NpemV9CiAgICAgIGRhdGEtYWN0aXZlPXtpc0FjdGl2ZX0KICAgICAgY2xhc3NOYW1lPXtjbihzaWRlYmFyTWVudUJ1dHRvblZhcmlhbnRzKHsgdmFyaWFudCwgc2l6ZSB9KSwgY2xhc3NOYW1lKX0KICAgICAgey4uLnByb3BzfQogICAgLz4KICApOwoKICBpZiAoIXRvb2x0aXApIHsKICAgIHJldHVybiBidXR0b247CiAgfQoKICBpZiAodHlwZW9mIHRvb2x0aXAgPT09ICJzdHJpbmciKSB7CiAgICB0b29sdGlwID0gewogICAgICBjaGlsZHJlbjogdG9vbHRpcCwKICAgIH07CiAgfQoKICByZXR1cm4gKAogICAgPFRvb2x0aXA+CiAgICAgIDxUb29sdGlwVHJpZ2dlciBhc0NoaWxkPntidXR0b259PC9Ub29sdGlwVHJpZ2dlcj4KICAgICAgPFRvb2x0aXBDb250ZW50IHNpZGU9InJpZ2h0IiBhbGlnbj0iY2VudGVyIiBoaWRkZW49e3N0YXRlICE9PSAiY29sbGFwc2VkIiB8fCBpc01vYmlsZX0gey4uLnRvb2x0aXB9IC8+CiAgICA8L1Rvb2x0aXA+CiAgKTsKfSk7ClNpZGViYXJNZW51QnV0dG9uLmRpc3BsYXlOYW1lID0gIlNpZGViYXJNZW51QnV0dG9uIjsKCmNvbnN0IFNpZGViYXJNZW51QWN0aW9uID0gUmVhY3QuZm9yd2FyZFJlZjwKICBIVE1MQnV0dG9uRWxlbWVudCwKICBSZWFjdC5Db21wb25lbnRQcm9wczwiYnV0dG9uIj4gJiB7CiAgICBhc0NoaWxkPzogYm9vbGVhbjsKICAgIHNob3dPbkhvdmVyPzogYm9vbGVhbjsKICB9Cj4oKHsgY2xhc3NOYW1lLCBhc0NoaWxkID0gZmFsc2UsIHNob3dPbkhvdmVyID0gZmFsc2UsIC4uLnByb3BzIH0sIHJlZikgPT4gewogIGNvbnN0IENvbXAgPSBhc0NoaWxkID8gU2xvdCA6ICJidXR0b24iOwoKICByZXR1cm4gKAogICAgPENvbXAKICAgICAgcmVmPXtyZWZ9CiAgICAgIGRhdGEtc2lkZWJhcj0ibWVudS1hY3Rpb24iCiAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgImFic29sdXRlIHJpZ2h0LTEgdG9wLTEuNSBmbGV4IGFzcGVjdC1zcXVhcmUgdy01IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciByb3VuZGVkLW1kIHAtMCB0ZXh0LXNpZGViYXItZm9yZWdyb3VuZCBvdXRsaW5lLW5vbmUgcmluZy1zaWRlYmFyLXJpbmcgdHJhbnNpdGlvbi10cmFuc2Zvcm0gcGVlci1ob3Zlci9tZW51LWJ1dHRvbjp0ZXh0LXNpZGViYXItYWNjZW50LWZvcmVncm91bmQgaG92ZXI6Ymctc2lkZWJhci1hY2NlbnQgaG92ZXI6dGV4dC1zaWRlYmFyLWFjY2VudC1mb3JlZ3JvdW5kIGZvY3VzLXZpc2libGU6cmluZy0yIFsmPnN2Z106c2l6ZS00IFsmPnN2Z106c2hyaW5rLTAiLAogICAgICAgIC8vIEluY3JlYXNlcyB0aGUgaGl0IGFyZWEgb2YgdGhlIGJ1dHRvbiBvbiBtb2JpbGUuCiAgICAgICAgImFmdGVyOmFic29sdXRlIGFmdGVyOi1pbnNldC0yIGFmdGVyOm1kOmhpZGRlbiIsCiAgICAgICAgInBlZXItZGF0YS1bc2l6ZT1zbV0vbWVudS1idXR0b246dG9wLTEiLAogICAgICAgICJwZWVyLWRhdGEtW3NpemU9ZGVmYXVsdF0vbWVudS1idXR0b246dG9wLTEuNSIsCiAgICAgICAgInBlZXItZGF0YS1bc2l6ZT1sZ10vbWVudS1idXR0b246dG9wLTIuNSIsCiAgICAgICAgImdyb3VwLWRhdGEtW2NvbGxhcHNpYmxlPWljb25dOmhpZGRlbiIsCiAgICAgICAgc2hvd09uSG92ZXIgJiYKICAgICAgICAgICJncm91cC1mb2N1cy13aXRoaW4vbWVudS1pdGVtOm9wYWNpdHktMTAwIGdyb3VwLWhvdmVyL21lbnUtaXRlbTpvcGFjaXR5LTEwMCBkYXRhLVtzdGF0ZT1vcGVuXTpvcGFjaXR5LTEwMCBwZWVyLWRhdGEtW2FjdGl2ZT10cnVlXS9tZW51LWJ1dHRvbjp0ZXh0LXNpZGViYXItYWNjZW50LWZvcmVncm91bmQgbWQ6b3BhY2l0eS0wIiwKICAgICAgICBjbGFzc05hbWUsCiAgICAgICl9CiAgICAgIHsuLi5wcm9wc30KICAgIC8+CiAgKTsKfSk7ClNpZGViYXJNZW51QWN0aW9uLmRpc3BsYXlOYW1lID0gIlNpZGViYXJNZW51QWN0aW9uIjsKCmNvbnN0IFNpZGViYXJNZW51QmFkZ2UgPSBSZWFjdC5mb3J3YXJkUmVmPEhUTUxEaXZFbGVtZW50LCBSZWFjdC5Db21wb25lbnRQcm9wczwiZGl2Ij4+KAogICh7IGNsYXNzTmFtZSwgLi4ucHJvcHMgfSwgcmVmKSA9PiAoCiAgICA8ZGl2CiAgICAgIHJlZj17cmVmfQogICAgICBkYXRhLXNpZGViYXI9Im1lbnUtYmFkZ2UiCiAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgInBvaW50ZXItZXZlbnRzLW5vbmUgYWJzb2x1dGUgcmlnaHQtMSBmbGV4IGgtNSBtaW4tdy01IHNlbGVjdC1ub25lIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciByb3VuZGVkLW1kIHB4LTEgdGV4dC14cyBmb250LW1lZGl1bSB0YWJ1bGFyLW51bXMgdGV4dC1zaWRlYmFyLWZvcmVncm91bmQiLAogICAgICAgICJwZWVyLWhvdmVyL21lbnUtYnV0dG9uOnRleHQtc2lkZWJhci1hY2NlbnQtZm9yZWdyb3VuZCBwZWVyLWRhdGEtW2FjdGl2ZT10cnVlXS9tZW51LWJ1dHRvbjp0ZXh0LXNpZGViYXItYWNjZW50LWZvcmVncm91bmQiLAogICAgICAgICJwZWVyLWRhdGEtW3NpemU9c21dL21lbnUtYnV0dG9uOnRvcC0xIiwKICAgICAgICAicGVlci1kYXRhLVtzaXplPWRlZmF1bHRdL21lbnUtYnV0dG9uOnRvcC0xLjUiLAogICAgICAgICJwZWVyLWRhdGEtW3NpemU9bGddL21lbnUtYnV0dG9uOnRvcC0yLjUiLAogICAgICAgICJncm91cC1kYXRhLVtjb2xsYXBzaWJsZT1pY29uXTpoaWRkZW4iLAogICAgICAgIGNsYXNzTmFtZSwKICAgICAgKX0KICAgICAgey4uLnByb3BzfQogICAgLz4KICApLAopOwpTaWRlYmFyTWVudUJhZGdlLmRpc3BsYXlOYW1lID0gIlNpZGViYXJNZW51QmFkZ2UiOwoKY29uc3QgU2lkZWJhck1lbnVTa2VsZXRvbiA9IFJlYWN0LmZvcndhcmRSZWY8CiAgSFRNTERpdkVsZW1lbnQsCiAgUmVhY3QuQ29tcG9uZW50UHJvcHM8ImRpdiI+ICYgewogICAgc2hvd0ljb24/OiBib29sZWFuOwogIH0KPigoeyBjbGFzc05hbWUsIHNob3dJY29uID0gZmFsc2UsIC4uLnByb3BzIH0sIHJlZikgPT4gewogIC8vIFJhbmRvbSB3aWR0aCBiZXR3ZWVuIDUwIHRvIDkwJS4KICBjb25zdCB3aWR0aCA9IFJlYWN0LnVzZU1lbW8oKCkgPT4gewogICAgcmV0dXJuIGAke01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDQwKSArIDUwfSVgOwogIH0sIFtdKTsKCiAgcmV0dXJuICgKICAgIDxkaXYKICAgICAgcmVmPXtyZWZ9CiAgICAgIGRhdGEtc2lkZWJhcj0ibWVudS1za2VsZXRvbiIKICAgICAgY2xhc3NOYW1lPXtjbigiZmxleCBoLTggaXRlbXMtY2VudGVyIGdhcC0yIHJvdW5kZWQtbWQgcHgtMiIsIGNsYXNzTmFtZSl9CiAgICAgIHsuLi5wcm9wc30KICAgID4KICAgICAge3Nob3dJY29uICYmIDxTa2VsZXRvbiBjbGFzc05hbWU9InNpemUtNCByb3VuZGVkLW1kIiBkYXRhLXNpZGViYXI9Im1lbnUtc2tlbGV0b24taWNvbiIgLz59CiAgICAgIDxTa2VsZXRvbgogICAgICAgIGNsYXNzTmFtZT0iaC00IG1heC13LVstLXNrZWxldG9uLXdpZHRoXSBmbGV4LTEiCiAgICAgICAgZGF0YS1zaWRlYmFyPSJtZW51LXNrZWxldG9uLXRleHQiCiAgICAgICAgc3R5bGU9ewogICAgICAgICAgewogICAgICAgICAgICAiLS1za2VsZXRvbi13aWR0aCI6IHdpZHRoLAogICAgICAgICAgfSBhcyBSZWFjdC5DU1NQcm9wZXJ0aWVzCiAgICAgICAgfQogICAgICAvPgogICAgPC9kaXY+CiAgKTsKfSk7ClNpZGViYXJNZW51U2tlbGV0b24uZGlzcGxheU5hbWUgPSAiU2lkZWJhck1lbnVTa2VsZXRvbiI7Cgpjb25zdCBTaWRlYmFyTWVudVN1YiA9IFJlYWN0LmZvcndhcmRSZWY8SFRNTFVMaXN0RWxlbWVudCwgUmVhY3QuQ29tcG9uZW50UHJvcHM8InVsIj4+KAogICh7IGNsYXNzTmFtZSwgLi4ucHJvcHMgfSwgcmVmKSA9PiAoCiAgICA8dWwKICAgICAgcmVmPXtyZWZ9CiAgICAgIGRhdGEtc2lkZWJhcj0ibWVudS1zdWIiCiAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgIm14LTMuNSBmbGV4IG1pbi13LTAgdHJhbnNsYXRlLXgtcHggZmxleC1jb2wgZ2FwLTEgYm9yZGVyLWwgYm9yZGVyLXNpZGViYXItYm9yZGVyIHB4LTIuNSBweS0wLjUiLAogICAgICAgICJncm91cC1kYXRhLVtjb2xsYXBzaWJsZT1pY29uXTpoaWRkZW4iLAogICAgICAgIGNsYXNzTmFtZSwKICAgICAgKX0KICAgICAgey4uLnByb3BzfQogICAgLz4KICApLAopOwpTaWRlYmFyTWVudVN1Yi5kaXNwbGF5TmFtZSA9ICJTaWRlYmFyTWVudVN1YiI7Cgpjb25zdCBTaWRlYmFyTWVudVN1Ykl0ZW0gPSBSZWFjdC5mb3J3YXJkUmVmPEhUTUxMSUVsZW1lbnQsIFJlYWN0LkNvbXBvbmVudFByb3BzPCJsaSI+PigoeyAuLi5wcm9wcyB9LCByZWYpID0+ICgKICA8bGkgcmVmPXtyZWZ9IHsuLi5wcm9wc30gLz4KKSk7ClNpZGViYXJNZW51U3ViSXRlbS5kaXNwbGF5TmFtZSA9ICJTaWRlYmFyTWVudVN1Ykl0ZW0iOwoKY29uc3QgU2lkZWJhck1lbnVTdWJCdXR0b24gPSBSZWFjdC5mb3J3YXJkUmVmPAogIEhUTUxBbmNob3JFbGVtZW50LAogIFJlYWN0LkNvbXBvbmVudFByb3BzPCJhIj4gJiB7CiAgICBhc0NoaWxkPzogYm9vbGVhbjsKICAgIHNpemU/OiAic20iIHwgIm1kIjsKICAgIGlzQWN0aXZlPzogYm9vbGVhbjsKICB9Cj4oKHsgYXNDaGlsZCA9IGZhbHNlLCBzaXplID0gIm1kIiwgaXNBY3RpdmUsIGNsYXNzTmFtZSwgLi4ucHJvcHMgfSwgcmVmKSA9PiB7CiAgY29uc3QgQ29tcCA9IGFzQ2hpbGQgPyBTbG90IDogImEiOwoKICByZXR1cm4gKAogICAgPENvbXAKICAgICAgcmVmPXtyZWZ9CiAgICAgIGRhdGEtc2lkZWJhcj0ibWVudS1zdWItYnV0dG9uIgogICAgICBkYXRhLXNpemU9e3NpemV9CiAgICAgIGRhdGEtYWN0aXZlPXtpc0FjdGl2ZX0KICAgICAgY2xhc3NOYW1lPXtjbigKICAgICAgICAiZmxleCBoLTcgbWluLXctMCAtdHJhbnNsYXRlLXgtcHggaXRlbXMtY2VudGVyIGdhcC0yIG92ZXJmbG93LWhpZGRlbiByb3VuZGVkLW1kIHB4LTIgdGV4dC1zaWRlYmFyLWZvcmVncm91bmQgb3V0bGluZS1ub25lIHJpbmctc2lkZWJhci1yaW5nIGFyaWEtZGlzYWJsZWQ6cG9pbnRlci1ldmVudHMtbm9uZSBhcmlhLWRpc2FibGVkOm9wYWNpdHktNTAgaG92ZXI6Ymctc2lkZWJhci1hY2NlbnQgaG92ZXI6dGV4dC1zaWRlYmFyLWFjY2VudC1mb3JlZ3JvdW5kIGZvY3VzLXZpc2libGU6cmluZy0yIGFjdGl2ZTpiZy1zaWRlYmFyLWFjY2VudCBhY3RpdmU6dGV4dC1zaWRlYmFyLWFjY2VudC1mb3JlZ3JvdW5kIGRpc2FibGVkOnBvaW50ZXItZXZlbnRzLW5vbmUgZGlzYWJsZWQ6b3BhY2l0eS01MCBbJj5zcGFuOmxhc3QtY2hpbGRdOnRydW5jYXRlIFsmPnN2Z106c2l6ZS00IFsmPnN2Z106c2hyaW5rLTAgWyY+c3ZnXTp0ZXh0LXNpZGViYXItYWNjZW50LWZvcmVncm91bmQiLAogICAgICAgICJkYXRhLVthY3RpdmU9dHJ1ZV06Ymctc2lkZWJhci1hY2NlbnQgZGF0YS1bYWN0aXZlPXRydWVdOnRleHQtc2lkZWJhci1hY2NlbnQtZm9yZWdyb3VuZCIsCiAgICAgICAgc2l6ZSA9PT0gInNtIiAmJiAidGV4dC14cyIsCiAgICAgICAgc2l6ZSA9PT0gIm1kIiAmJiAidGV4dC1zbSIsCiAgICAgICAgImdyb3VwLWRhdGEtW2NvbGxhcHNpYmxlPWljb25dOmhpZGRlbiIsCiAgICAgICAgY2xhc3NOYW1lLAogICAgICApfQogICAgICB7Li4ucHJvcHN9CiAgICAvPgogICk7Cn0pOwpTaWRlYmFyTWVudVN1YkJ1dHRvbi5kaXNwbGF5TmFtZSA9ICJTaWRlYmFyTWVudVN1YkJ1dHRvbiI7CgpleHBvcnQgewogIFNpZGViYXIsCiAgU2lkZWJhckNvbnRlbnQsCiAgU2lkZWJhckZvb3RlciwKICBTaWRlYmFyR3JvdXAsCiAgU2lkZWJhckdyb3VwQWN0aW9uLAogIFNpZGViYXJHcm91cENvbnRlbnQsCiAgU2lkZWJhckdyb3VwTGFiZWwsCiAgU2lkZWJhckhlYWRlciwKICBTaWRlYmFySW5wdXQsCiAgU2lkZWJhckluc2V0LAogIFNpZGViYXJNZW51LAogIFNpZGViYXJNZW51QWN0aW9uLAogIFNpZGViYXJNZW51QmFkZ2UsCiAgU2lkZWJhck1lbnVCdXR0b24sCiAgU2lkZWJhck1lbnVJdGVtLAogIFNpZGViYXJNZW51U2tlbGV0b24sCiAgU2lkZWJhck1lbnVTdWIsCiAgU2lkZWJhck1lbnVTdWJCdXR0b24sCiAgU2lkZWJhck1lbnVTdWJJdGVtLAogIFNpZGViYXJQcm92aWRlciwKICBTaWRlYmFyUmFpbCwKICBTaWRlYmFyU2VwYXJhdG9yLAogIFNpZGViYXJUcmlnZ2VyLAogIHVzZVNpZGViYXIsCn07Cg=="}