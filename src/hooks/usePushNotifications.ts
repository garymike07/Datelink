{"data":"aW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7CmltcG9ydCB7IHVzZU11dGF0aW9uLCB1c2VRdWVyeSB9IGZyb20gJ2NvbnZleC9yZWFjdCc7CmltcG9ydCB7IGFwaSB9IGZyb20gJy4uLy4uL2NvbnZleC9fZ2VuZXJhdGVkL2FwaSc7CmltcG9ydCB7IHRvYXN0IH0gZnJvbSAnc29ubmVyJzsKCi8vIFZBUElEIHB1YmxpYyBrZXkgLSBJbiBwcm9kdWN0aW9uLCB0aGlzIHNob3VsZCBjb21lIGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzCi8vIEZvciBub3csIHRoaXMgaXMgYSBwbGFjZWhvbGRlci4gWW91J2xsIG5lZWQgdG8gZ2VuZXJhdGUgVkFQSUQga2V5cyB1c2luZzoKLy8gbnB4IHdlYi1wdXNoIGdlbmVyYXRlLXZhcGlkLWtleXMKY29uc3QgVkFQSURfUFVCTElDX0tFWSA9IGltcG9ydC5tZXRhLmVudi5WSVRFX1ZBUElEX1BVQkxJQ19LRVkgfHwgJ1BMQUNFSE9MREVSX1ZBUElEX0tFWSc7CgovKioKICogQ29udmVydCBiYXNlNjQgc3RyaW5nIHRvIFVpbnQ4QXJyYXkgZm9yIFZBUElEIGtleQogKi8KZnVuY3Rpb24gdXJsQmFzZTY0VG9VaW50OEFycmF5KGJhc2U2NFN0cmluZzogc3RyaW5nKTogVWludDhBcnJheSB7CiAgY29uc3QgcGFkZGluZyA9ICc9Jy5yZXBlYXQoKDQgLSAoYmFzZTY0U3RyaW5nLmxlbmd0aCAlIDQpKSAlIDQpOwogIGNvbnN0IGJhc2U2NCA9IChiYXNlNjRTdHJpbmcgKyBwYWRkaW5nKQogICAgLnJlcGxhY2UoLy0vZywgJysnKQogICAgLnJlcGxhY2UoL18vZywgJy8nKTsKCiAgY29uc3QgcmF3RGF0YSA9IHdpbmRvdy5hdG9iKGJhc2U2NCk7CiAgY29uc3Qgb3V0cHV0QXJyYXkgPSBuZXcgVWludDhBcnJheShyYXdEYXRhLmxlbmd0aCk7CgogIGZvciAobGV0IGkgPSAwOyBpIDwgcmF3RGF0YS5sZW5ndGg7ICsraSkgewogICAgb3V0cHV0QXJyYXlbaV0gPSByYXdEYXRhLmNoYXJDb2RlQXQoaSk7CiAgfQogIHJldHVybiBvdXRwdXRBcnJheTsKfQoKZXhwb3J0IGludGVyZmFjZSBQdXNoTm90aWZpY2F0aW9uUGVybWlzc2lvbiB7CiAgcGVybWlzc2lvbjogTm90aWZpY2F0aW9uUGVybWlzc2lvbjsKICBpc1N1cHBvcnRlZDogYm9vbGVhbjsKICBpc1N1YnNjcmliZWQ6IGJvb2xlYW47Cn0KCmV4cG9ydCBmdW5jdGlvbiB1c2VQdXNoTm90aWZpY2F0aW9ucygpIHsKICBjb25zdCBbcGVybWlzc2lvbiwgc2V0UGVybWlzc2lvbl0gPSB1c2VTdGF0ZTxOb3RpZmljYXRpb25QZXJtaXNzaW9uPignZGVmYXVsdCcpOwogIGNvbnN0IFtpc1N1cHBvcnRlZCwgc2V0SXNTdXBwb3J0ZWRdID0gdXNlU3RhdGUoZmFsc2UpOwogIGNvbnN0IFtpc1N1YnNjcmliZWQsIHNldElzU3Vic2NyaWJlZF0gPSB1c2VTdGF0ZShmYWxzZSk7CiAgY29uc3QgW2lzTG9hZGluZywgc2V0SXNMb2FkaW5nXSA9IHVzZVN0YXRlKGZhbHNlKTsKCiAgY29uc3Qgc2F2ZVB1c2hTdWJzY3JpcHRpb24gPSB1c2VNdXRhdGlvbihhcGkucHVzaE5vdGlmaWNhdGlvbnMuc2F2ZVB1c2hTdWJzY3JpcHRpb24pOwogIGNvbnN0IHJlbW92ZVB1c2hTdWJzY3JpcHRpb24gPSB1c2VNdXRhdGlvbihhcGkucHVzaE5vdGlmaWNhdGlvbnMucmVtb3ZlUHVzaFN1YnNjcmlwdGlvbik7CiAgY29uc3QgdXNlclN1YnNjcmlwdGlvbnMgPSB1c2VRdWVyeShhcGkucHVzaE5vdGlmaWNhdGlvbnMuZ2V0VXNlclB1c2hTdWJzY3JpcHRpb25zKTsKCiAgLy8gQ2hlY2sgaWYgcHVzaCBub3RpZmljYXRpb25zIGFyZSBzdXBwb3J0ZWQKICB1c2VFZmZlY3QoKCkgPT4gewogICAgY29uc3QgY2hlY2tTdXBwb3J0ID0gKCkgPT4gewogICAgICBjb25zdCBzdXBwb3J0ZWQgPQogICAgICAgICdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IgJiYKICAgICAgICAnUHVzaE1hbmFnZXInIGluIHdpbmRvdyAmJgogICAgICAgICdOb3RpZmljYXRpb24nIGluIHdpbmRvdzsKICAgICAgCiAgICAgIHNldElzU3VwcG9ydGVkKHN1cHBvcnRlZCk7CiAgICAgIAogICAgICBpZiAoc3VwcG9ydGVkICYmICdOb3RpZmljYXRpb24nIGluIHdpbmRvdykgewogICAgICAgIHNldFBlcm1pc3Npb24oTm90aWZpY2F0aW9uLnBlcm1pc3Npb24pOwogICAgICB9CiAgICB9OwoKICAgIGNoZWNrU3VwcG9ydCgpOwogIH0sIFtdKTsKCiAgLy8gQ2hlY2sgaWYgYWxyZWFkeSBzdWJzY3JpYmVkCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIGNvbnN0IGNoZWNrU3Vic2NyaXB0aW9uID0gYXN5bmMgKCkgPT4gewogICAgICBpZiAoIWlzU3VwcG9ydGVkKSByZXR1cm47CgogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlZ2lzdHJhdGlvbiA9IGF3YWl0IG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlYWR5OwogICAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IGF3YWl0IHJlZ2lzdHJhdGlvbi5wdXNoTWFuYWdlci5nZXRTdWJzY3JpcHRpb24oKTsKICAgICAgICBzZXRJc1N1YnNjcmliZWQoISFzdWJzY3JpcHRpb24pOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNoZWNraW5nIHN1YnNjcmlwdGlvbjonLCBlcnJvcik7CiAgICAgIH0KICAgIH07CgogICAgY2hlY2tTdWJzY3JpcHRpb24oKTsKICB9LCBbaXNTdXBwb3J0ZWQsIHVzZXJTdWJzY3JpcHRpb25zXSk7CgogIC8qKgogICAqIFJlZ2lzdGVyIHNlcnZpY2Ugd29ya2VyCiAgICovCiAgY29uc3QgcmVnaXN0ZXJTZXJ2aWNlV29ya2VyID0gdXNlQ2FsbGJhY2soYXN5bmMgKCk6IFByb21pc2U8U2VydmljZVdvcmtlclJlZ2lzdHJhdGlvbj4gPT4gewogICAgdHJ5IHsKICAgICAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIHJlZ2lzdHJhdGlvbiBmaXJzdAogICAgICBjb25zdCBleGlzdGluZ1JlZ2lzdHJhdGlvbiA9IGF3YWl0IG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmdldFJlZ2lzdHJhdGlvbignLycpOwogICAgICAKICAgICAgaWYgKGV4aXN0aW5nUmVnaXN0cmF0aW9uKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1VzaW5nIGV4aXN0aW5nIFNlcnZpY2UgV29ya2VyIHJlZ2lzdHJhdGlvbicpOwogICAgICAgIGF3YWl0IG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlYWR5OwogICAgICAgIHJldHVybiBleGlzdGluZ1JlZ2lzdHJhdGlvbjsKICAgICAgfQoKICAgICAgLy8gUmVnaXN0ZXIgbmV3IHNlcnZpY2Ugd29ya2VyCiAgICAgIGNvbnN0IHJlZ2lzdHJhdGlvbiA9IGF3YWl0IG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc3cuanMnLCB7CiAgICAgICAgc2NvcGU6ICcvJywKICAgICAgICB1cGRhdGVWaWFDYWNoZTogJ25vbmUnLCAvLyBEb24ndCBjYWNoZSB0aGUgc2VydmljZSB3b3JrZXIgZmlsZQogICAgICB9KTsKCiAgICAgIC8vIFdhaXQgZm9yIHRoZSBzZXJ2aWNlIHdvcmtlciB0byBiZSByZWFkeQogICAgICBhd2FpdCBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWFkeTsKCiAgICAgIGNvbnNvbGUubG9nKCdTZXJ2aWNlIFdvcmtlciByZWdpc3RlcmVkIHN1Y2Nlc3NmdWxseScpOwogICAgICByZXR1cm4gcmVnaXN0cmF0aW9uOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgY29uc29sZS5lcnJvcignU2VydmljZSBXb3JrZXIgcmVnaXN0cmF0aW9uIGZhaWxlZDonLCBlcnJvcik7CiAgICAgIHRocm93IGVycm9yOwogICAgfQogIH0sIFtdKTsKCiAgLyoqCiAgICogUmVxdWVzdCBub3RpZmljYXRpb24gcGVybWlzc2lvbgogICAqIE5vdGU6IFRoaXMgbXVzdCBiZSBjYWxsZWQgaW4gcmVzcG9uc2UgdG8gYSB1c2VyIGdlc3R1cmUgKGUuZy4sIGJ1dHRvbiBjbGljaykKICAgKi8KICBjb25zdCByZXF1ZXN0UGVybWlzc2lvbiA9IHVzZUNhbGxiYWNrKGFzeW5jICgpOiBQcm9taXNlPE5vdGlmaWNhdGlvblBlcm1pc3Npb24+ID0+IHsKICAgIGlmICghaXNTdXBwb3J0ZWQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdQdXNoIG5vdGlmaWNhdGlvbnMgYXJlIG5vdCBzdXBwb3J0ZWQnKTsKICAgIH0KCiAgICAvLyBDaGVjayBpZiBhbHJlYWR5IGdyYW50ZWQgdG8gYXZvaWQgdW5uZWNlc3NhcnkgcHJvbXB0cwogICAgaWYgKE5vdGlmaWNhdGlvbi5wZXJtaXNzaW9uID09PSAnZ3JhbnRlZCcpIHsKICAgICAgcmV0dXJuICdncmFudGVkJzsKICAgIH0KCiAgICB0cnkgewogICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBOb3RpZmljYXRpb24ucmVxdWVzdFBlcm1pc3Npb24oKTsKICAgICAgc2V0UGVybWlzc2lvbihyZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcmVxdWVzdGluZyBub3RpZmljYXRpb24gcGVybWlzc2lvbjonLCBlcnJvcik7CiAgICAgIHRocm93IGVycm9yOwogICAgfQogIH0sIFtpc1N1cHBvcnRlZF0pOwoKICAvKioKICAgKiBTdWJzY3JpYmUgdG8gcHVzaCBub3RpZmljYXRpb25zCiAgICovCiAgY29uc3Qgc3Vic2NyaWJlID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT4gewogICAgaWYgKCFpc1N1cHBvcnRlZCkgewogICAgICB0b2FzdC5lcnJvcignUHVzaCBub3RpZmljYXRpb25zIGFyZSBub3Qgc3VwcG9ydGVkIGluIHlvdXIgYnJvd3NlcicpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgc2V0SXNMb2FkaW5nKHRydWUpOwoKICAgIHRyeSB7CiAgICAgIC8vIFJlcXVlc3QgcGVybWlzc2lvbgogICAgICBjb25zdCBwZXJtaXNzaW9uUmVzdWx0ID0gYXdhaXQgcmVxdWVzdFBlcm1pc3Npb24oKTsKICAgICAgCiAgICAgIGlmIChwZXJtaXNzaW9uUmVzdWx0ICE9PSAnZ3JhbnRlZCcpIHsKICAgICAgICB0b2FzdC5lcnJvcignTm90aWZpY2F0aW9uIHBlcm1pc3Npb24gZGVuaWVkJyk7CiAgICAgICAgc2V0SXNMb2FkaW5nKGZhbHNlKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIC8vIFJlZ2lzdGVyIHNlcnZpY2Ugd29ya2VyCiAgICAgIGNvbnN0IHJlZ2lzdHJhdGlvbiA9IGF3YWl0IHJlZ2lzdGVyU2VydmljZVdvcmtlcigpOwoKICAgICAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIHN1YnNjcmlwdGlvbgogICAgICBsZXQgc3Vic2NyaXB0aW9uID0gYXdhaXQgcmVnaXN0cmF0aW9uLnB1c2hNYW5hZ2VyLmdldFN1YnNjcmlwdGlvbigpOwoKICAgICAgaWYgKCFzdWJzY3JpcHRpb24pIHsKICAgICAgICAvLyBDcmVhdGUgbmV3IHN1YnNjcmlwdGlvbgogICAgICAgIGlmIChWQVBJRF9QVUJMSUNfS0VZID09PSAnUExBQ0VIT0xERVJfVkFQSURfS0VZJykgewogICAgICAgICAgY29uc29sZS53YXJuKCdWQVBJRCBrZXkgbm90IGNvbmZpZ3VyZWQuIFB1c2ggbm90aWZpY2F0aW9ucyB3aWxsIG5vdCB3b3JrIGluIHByb2R1Y3Rpb24uJyk7CiAgICAgICAgICB0b2FzdC5lcnJvcignUHVzaCBub3RpZmljYXRpb25zIGFyZSBub3QgY29uZmlndXJlZCcpOwogICAgICAgICAgc2V0SXNMb2FkaW5nKGZhbHNlKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICBzdWJzY3JpcHRpb24gPSBhd2FpdCByZWdpc3RyYXRpb24ucHVzaE1hbmFnZXIuc3Vic2NyaWJlKHsKICAgICAgICAgICAgdXNlclZpc2libGVPbmx5OiB0cnVlLAogICAgICAgICAgICBhcHBsaWNhdGlvblNlcnZlcktleTogdXJsQmFzZTY0VG9VaW50OEFycmF5KFZBUElEX1BVQkxJQ19LRVkpLAogICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRjaCAoc3Vic2NyaWJlRXJyb3I6IGFueSkgewogICAgICAgICAgY29uc29sZS5lcnJvcignUHVzaCBzdWJzY3JpcHRpb24gZXJyb3I6Jywgc3Vic2NyaWJlRXJyb3IpOwogICAgICAgICAgCiAgICAgICAgICAvLyBIYW5kbGUgc3BlY2lmaWMgZXJyb3IgdHlwZXMKICAgICAgICAgIGlmIChzdWJzY3JpYmVFcnJvci5uYW1lID09PSAnQWJvcnRFcnJvcicpIHsKICAgICAgICAgICAgdG9hc3QuZXJyb3IoJ1B1c2ggc2VydmljZSB0ZW1wb3JhcmlseSB1bmF2YWlsYWJsZS4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4nKTsKICAgICAgICAgICAgY29uc29sZS53YXJuKCdQdXNoIHNlcnZpY2UgZXJyb3IgLSB0aGlzIGNhbiBoYXBwZW4gaWYgdGhlIGJyb3dzZXIgcHVzaCBzZXJ2aWNlIGlzIGRvd24gb3IgbmV0d29yayBpcyB1bnN0YWJsZScpOwogICAgICAgICAgfSBlbHNlIGlmIChzdWJzY3JpYmVFcnJvci5uYW1lID09PSAnTm90QWxsb3dlZEVycm9yJykgewogICAgICAgICAgICB0b2FzdC5lcnJvcignUHVzaCBub3RpZmljYXRpb24gcGVybWlzc2lvbiB3YXMgZGVuaWVkJyk7CiAgICAgICAgICB9IGVsc2UgaWYgKHN1YnNjcmliZUVycm9yLm5hbWUgPT09ICdOb3RTdXBwb3J0ZWRFcnJvcicpIHsKICAgICAgICAgICAgdG9hc3QuZXJyb3IoJ1B1c2ggbm90aWZpY2F0aW9ucyBhcmUgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGJyb3dzZXInKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRvYXN0LmVycm9yKCdGYWlsZWQgdG8gc3Vic2NyaWJlIHRvIHB1c2ggbm90aWZpY2F0aW9ucycpOwogICAgICAgICAgfQogICAgICAgICAgCiAgICAgICAgICBzZXRJc0xvYWRpbmcoZmFsc2UpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gU2F2ZSBzdWJzY3JpcHRpb24gdG8gYmFja2VuZAogICAgICBjb25zdCBzdWJzY3JpcHRpb25KU09OID0gc3Vic2NyaXB0aW9uLnRvSlNPTigpOwogICAgICAKICAgICAgYXdhaXQgc2F2ZVB1c2hTdWJzY3JpcHRpb24oewogICAgICAgIGVuZHBvaW50OiBzdWJzY3JpcHRpb24uZW5kcG9pbnQsCiAgICAgICAga2V5czogewogICAgICAgICAgcDI1NmRoOiBzdWJzY3JpcHRpb25KU09OLmtleXM/LnAyNTZkaCB8fCAnJywKICAgICAgICAgIGF1dGg6IHN1YnNjcmlwdGlvbkpTT04ua2V5cz8uYXV0aCB8fCAnJywKICAgICAgICB9LAogICAgICAgIHBsYXRmb3JtOiAnd2ViJywKICAgICAgICBicm93c2VyOiBuYXZpZ2F0b3IudXNlckFnZW50LmluY2x1ZGVzKCdDaHJvbWUnKSA/ICdDaHJvbWUnIDoKICAgICAgICAgICAgICAgICBuYXZpZ2F0b3IudXNlckFnZW50LmluY2x1ZGVzKCdGaXJlZm94JykgPyAnRmlyZWZveCcgOgogICAgICAgICAgICAgICAgIG5hdmlnYXRvci51c2VyQWdlbnQuaW5jbHVkZXMoJ1NhZmFyaScpID8gJ1NhZmFyaScgOiAnT3RoZXInLAogICAgICB9KTsKCiAgICAgIHNldElzU3Vic2NyaWJlZCh0cnVlKTsKICAgICAgdG9hc3Quc3VjY2VzcygnUHVzaCBub3RpZmljYXRpb25zIGVuYWJsZWQhJyk7CiAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSBjYXRjaCAoZXJyb3I6IGFueSkgewogICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzdWJzY3JpYmluZyB0byBwdXNoIG5vdGlmaWNhdGlvbnM6JywgZXJyb3IpOwogICAgICAKICAgICAgLy8gTW9yZSBzcGVjaWZpYyBlcnJvciBtZXNzYWdlCiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGVycm9yPy5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJzsKICAgICAgdG9hc3QuZXJyb3IoYEZhaWxlZCB0byBlbmFibGUgcHVzaCBub3RpZmljYXRpb25zOiAke2Vycm9yTWVzc2FnZX1gKTsKICAgICAgCiAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9LCBbaXNTdXBwb3J0ZWQsIHJlcXVlc3RQZXJtaXNzaW9uLCByZWdpc3RlclNlcnZpY2VXb3JrZXIsIHNhdmVQdXNoU3Vic2NyaXB0aW9uXSk7CgogIC8qKgogICAqIFVuc3Vic2NyaWJlIGZyb20gcHVzaCBub3RpZmljYXRpb25zCiAgICovCiAgY29uc3QgdW5zdWJzY3JpYmUgPSB1c2VDYWxsYmFjayhhc3luYyAoKSA9PiB7CiAgICBpZiAoIWlzU3VwcG9ydGVkKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBzZXRJc0xvYWRpbmcodHJ1ZSk7CgogICAgdHJ5IHsKICAgICAgY29uc3QgcmVnaXN0cmF0aW9uID0gYXdhaXQgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHk7CiAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IGF3YWl0IHJlZ2lzdHJhdGlvbi5wdXNoTWFuYWdlci5nZXRTdWJzY3JpcHRpb24oKTsKCiAgICAgIGlmIChzdWJzY3JpcHRpb24pIHsKICAgICAgICAvLyBVbnN1YnNjcmliZSBmcm9tIHB1c2ggbWFuYWdlcgogICAgICAgIGF3YWl0IHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpOwoKICAgICAgICAvLyBSZW1vdmUgZnJvbSBiYWNrZW5kCiAgICAgICAgYXdhaXQgcmVtb3ZlUHVzaFN1YnNjcmlwdGlvbih7CiAgICAgICAgICBlbmRwb2ludDogc3Vic2NyaXB0aW9uLmVuZHBvaW50LAogICAgICAgIH0pOwoKICAgICAgICBzZXRJc1N1YnNjcmliZWQoZmFsc2UpOwogICAgICAgIHRvYXN0LnN1Y2Nlc3MoJ1B1c2ggbm90aWZpY2F0aW9ucyBkaXNhYmxlZCcpOwogICAgICB9CgogICAgICBzZXRJc0xvYWRpbmcoZmFsc2UpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVuc3Vic2NyaWJpbmcgZnJvbSBwdXNoIG5vdGlmaWNhdGlvbnM6JywgZXJyb3IpOwogICAgICB0b2FzdC5lcnJvcignRmFpbGVkIHRvIGRpc2FibGUgcHVzaCBub3RpZmljYXRpb25zJyk7CiAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9LCBbaXNTdXBwb3J0ZWQsIHJlbW92ZVB1c2hTdWJzY3JpcHRpb25dKTsKCiAgLyoqCiAgICogVGVzdCBwdXNoIG5vdGlmaWNhdGlvbiAoc2hvd3MgYSBsb2NhbCBub3RpZmljYXRpb24pCiAgICovCiAgY29uc3QgdGVzdE5vdGlmaWNhdGlvbiA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHsKICAgIGlmICghaXNTdXBwb3J0ZWQpIHsKICAgICAgdG9hc3QuZXJyb3IoJ05vdGlmaWNhdGlvbnMgYXJlIG5vdCBzdXBwb3J0ZWQnKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmIChwZXJtaXNzaW9uICE9PSAnZ3JhbnRlZCcpIHsKICAgICAgdG9hc3QuZXJyb3IoJ05vdGlmaWNhdGlvbiBwZXJtaXNzaW9uIG5vdCBncmFudGVkJyk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB0cnkgewogICAgICBjb25zdCByZWdpc3RyYXRpb24gPSBhd2FpdCBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWFkeTsKICAgICAgCiAgICAgIGF3YWl0IHJlZ2lzdHJhdGlvbi5zaG93Tm90aWZpY2F0aW9uKCdUZXN0IE5vdGlmaWNhdGlvbicsIHsKICAgICAgICBib2R5OiAnVGhpcyBpcyBhIHRlc3Qgbm90aWZpY2F0aW9uIGZyb20gRGF0ZUxpbmsnLAogICAgICAgIGljb246ICcvbG9nby5zdmcnLAogICAgICAgIGJhZGdlOiAnL2Zhdmljb24uc3ZnJywKICAgICAgICB0YWc6ICd0ZXN0LW5vdGlmaWNhdGlvbicsCiAgICAgICAgdmlicmF0ZTogWzIwMCwgMTAwLCAyMDBdLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIHVybDogJy8nLAogICAgICAgIH0sCiAgICAgIH0pOwoKICAgICAgdG9hc3Quc3VjY2VzcygnVGVzdCBub3RpZmljYXRpb24gc2VudCEnKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNob3dpbmcgdGVzdCBub3RpZmljYXRpb246JywgZXJyb3IpOwogICAgICB0b2FzdC5lcnJvcignRmFpbGVkIHRvIHNob3cgdGVzdCBub3RpZmljYXRpb24nKTsKICAgIH0KICB9LCBbaXNTdXBwb3J0ZWQsIHBlcm1pc3Npb25dKTsKCiAgcmV0dXJuIHsKICAgIHBlcm1pc3Npb24sCiAgICBpc1N1cHBvcnRlZCwKICAgIGlzU3Vic2NyaWJlZCwKICAgIGlzTG9hZGluZywKICAgIHN1YnNjcmliZSwKICAgIHVuc3Vic2NyaWJlLAogICAgcmVxdWVzdFBlcm1pc3Npb24sCiAgICB0ZXN0Tm90aWZpY2F0aW9uLAogIH07Cn0K"}