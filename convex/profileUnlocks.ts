{"data":"aW1wb3J0IHsgdiB9IGZyb20gImNvbnZleC92YWx1ZXMiOwppbXBvcnQgeyBtdXRhdGlvbiwgcXVlcnkgfSBmcm9tICIuL19nZW5lcmF0ZWQvc2VydmVyIjsKaW1wb3J0IHsgaXNVc2VyUHJlbWl1bSB9IGZyb20gIi4vc3Vic2NyaXB0aW9ucyI7CgovKioKICogQ2hlY2sgaWYgdXNlciBjYW4gdmlldyBhIHByb2ZpbGUKICovCmV4cG9ydCBjb25zdCBjYW5WaWV3UHJvZmlsZSA9IHF1ZXJ5KHsKICBhcmdzOiB7CiAgICB1c2VySWQ6IHYuaWQoInVzZXJzIiksCiAgICB0YXJnZXRVc2VySWQ6IHYuaWQoInVzZXJzIiksCiAgfSwKICBoYW5kbGVyOiBhc3luYyAoY3R4LCBhcmdzKSA9PiB7CiAgICAvLyBQcmVtaXVtIHVzZXJzIGNhbiB2aWV3IGFueSBwcm9maWxlCiAgICBjb25zdCBpc1ByZW1pdW0gPSBhd2FpdCBpc1VzZXJQcmVtaXVtKGN0eCwgYXJncy51c2VySWQpOwogICAgaWYgKGlzUHJlbWl1bSkgewogICAgICByZXR1cm4gewogICAgICAgIGNhblZpZXc6IHRydWUsCiAgICAgICAgcmVhc29uOiAicHJlbWl1bSIsCiAgICAgICAgbmVlZHNVbmxvY2s6IGZhbHNlLAogICAgICB9OwogICAgfQoKICAgIC8vIENoZWNrIGlmIGFscmVhZHkgdW5sb2NrZWQKICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgY3R4LmRiCiAgICAgIC5xdWVyeSgicHJvZmlsZVVubG9ja3MiKQogICAgICAud2l0aEluZGV4KCJ1c2VyVW5sb2NrZWQiLCAocSkgPT4KICAgICAgICBxLmVxKCJ1c2VySWQiLCBhcmdzLnVzZXJJZCkuZXEoInVubG9ja2VkVXNlcklkIiwgYXJncy50YXJnZXRVc2VySWQpCiAgICAgICkKICAgICAgLmZpcnN0KCk7CgogICAgaWYgKGV4aXN0aW5nKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgY2FuVmlldzogdHJ1ZSwKICAgICAgICByZWFzb246ICJhbHJlYWR5X3VubG9ja2VkIiwKICAgICAgICBuZWVkc1VubG9jazogZmFsc2UsCiAgICAgIH07CiAgICB9CgogICAgLy8gQ2hlY2sgZnJlZSB0cmlhbCBzdGF0dXMKICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBjdHguZGIuZ2V0KGFyZ3MudXNlcklkKTsKICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7CiAgICBjb25zdCBpblRyaWFsID0KICAgICAgdXNlcj8uZnJlZVRyaWFsU3RhcnRlZEF0ICYmCiAgICAgIHVzZXI/LmZyZWVUcmlhbEVuZHNBdCAmJgogICAgICB1c2VyLmZyZWVUcmlhbEVuZHNBdCA+IG5vdzsKCiAgICBpZiAoaW5UcmlhbCkgewogICAgICAvLyBDb3VudCB0cmlhbCB1bmxvY2tzCiAgICAgIGNvbnN0IHVubG9ja3MgPSBhd2FpdCBjdHguZGIKICAgICAgICAucXVlcnkoInByb2ZpbGVVbmxvY2tzIikKICAgICAgICAud2l0aEluZGV4KCJ1c2VySWQiLCAocSkgPT4gcS5lcSgidXNlcklkIiwgYXJncy51c2VySWQpKQogICAgICAgIC5maWx0ZXIoKHEpID0+IHEuZXEocS5maWVsZCgidW5sb2NrTWV0aG9kIiksICJmcmVlX3RyaWFsIikpCiAgICAgICAgLmNvbGxlY3QoKTsKCiAgICAgIGlmICh1bmxvY2tzLmxlbmd0aCA8IDUpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgY2FuVmlldzogZmFsc2UsCiAgICAgICAgICBuZWVkc1VubG9jazogdHJ1ZSwKICAgICAgICAgIHJlYXNvbjogImZyZWVfdHJpYWxfYXZhaWxhYmxlIiwKICAgICAgICAgIHVubG9ja3NSZW1haW5pbmc6IDUgLSB1bmxvY2tzLmxlbmd0aCwKICAgICAgICB9OwogICAgICB9CiAgICB9CgogICAgLy8gVXNlciBuZWVkcyB0byBwYXkKICAgIHJldHVybiB7CiAgICAgIGNhblZpZXc6IGZhbHNlLAogICAgICBuZWVkc1VubG9jazogdHJ1ZSwKICAgICAgcmVhc29uOiAicGF5bWVudF9yZXF1aXJlZCIsCiAgICAgIG9wdGlvbnM6IHsKICAgICAgICBzdWJzY3JpYmVXZWVrbHk6IDEwMCwKICAgICAgICBzdWJzY3JpYmVNb250aGx5OiAzNTAsCiAgICAgICAgdW5sb2NrT25jZTogMTAsCiAgICAgIH0sCiAgICB9OwogIH0sCn0pOwoKLyoqCiAqIFVubG9jayBhIHByb2ZpbGUKICovCmV4cG9ydCBjb25zdCB1bmxvY2tQcm9maWxlID0gbXV0YXRpb24oewogIGFyZ3M6IHsKICAgIHVzZXJJZDogdi5pZCgidXNlcnMiKSwKICAgIHRhcmdldFVzZXJJZDogdi5pZCgidXNlcnMiKSwKICAgIG1ldGhvZDogdi5vcHRpb25hbCh2LnN0cmluZygpKSwgLy8gImZyZWVfdHJpYWwiIHwgInByZW1pdW0iIHwgInBhaWQiCiAgICBwYXltZW50SWQ6IHYub3B0aW9uYWwodi5pZCgicGF5bWVudHMiKSksCiAgfSwKICBoYW5kbGVyOiBhc3luYyAoY3R4LCBhcmdzKSA9PiB7CiAgICAvLyBDaGVjayBpZiBhbHJlYWR5IHVubG9ja2VkCiAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IGN0eC5kYgogICAgICAucXVlcnkoInByb2ZpbGVVbmxvY2tzIikKICAgICAgLndpdGhJbmRleCgidXNlclVubG9ja2VkIiwgKHEpID0+CiAgICAgICAgcS5lcSgidXNlcklkIiwgYXJncy51c2VySWQpLmVxKCJ1bmxvY2tlZFVzZXJJZCIsIGFyZ3MudGFyZ2V0VXNlcklkKQogICAgICApCiAgICAgIC5maXJzdCgpOwoKICAgIGlmIChleGlzdGluZykgewogICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhbHJlYWR5VW5sb2NrZWQ6IHRydWUgfTsKICAgIH0KCiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwogICAgbGV0IHVubG9ja01ldGhvZCA9IGFyZ3MubWV0aG9kIHx8ICJmcmVlX3RyaWFsIjsKICAgIGxldCBjb3N0ID0gMDsKCiAgICAvLyBEZXRlcm1pbmUgdW5sb2NrIG1ldGhvZAogICAgY29uc3QgaXNQcmVtaXVtID0gYXdhaXQgaXNVc2VyUHJlbWl1bShjdHgsIGFyZ3MudXNlcklkKTsKICAgIGlmIChpc1ByZW1pdW0pIHsKICAgICAgdW5sb2NrTWV0aG9kID0gInByZW1pdW1fc3Vic2NyaXB0aW9uIjsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBjdHguZGIuZ2V0KGFyZ3MudXNlcklkKTsKICAgICAgY29uc3QgaW5UcmlhbCA9CiAgICAgICAgdXNlcj8uZnJlZVRyaWFsU3RhcnRlZEF0ICYmCiAgICAgICAgdXNlcj8uZnJlZVRyaWFsRW5kc0F0ICYmCiAgICAgICAgdXNlci5mcmVlVHJpYWxFbmRzQXQgPiBub3c7CgogICAgICBpZiAoaW5UcmlhbCkgewogICAgICAgIC8vIENoZWNrIHRyaWFsIGxpbWl0CiAgICAgICAgY29uc3QgdHJpYWxVbmxvY2tzID0gYXdhaXQgY3R4LmRiCiAgICAgICAgICAucXVlcnkoInByb2ZpbGVVbmxvY2tzIikKICAgICAgICAgIC53aXRoSW5kZXgoInVzZXJJZCIsIChxKSA9PiBxLmVxKCJ1c2VySWQiLCBhcmdzLnVzZXJJZCkpCiAgICAgICAgICAuZmlsdGVyKChxKSA9PiBxLmVxKHEuZmllbGQoInVubG9ja01ldGhvZCIpLCAiZnJlZV90cmlhbCIpKQogICAgICAgICAgLmNvbGxlY3QoKTsKCiAgICAgICAgaWYgKHRyaWFsVW5sb2Nrcy5sZW5ndGggPj0gNSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICAgICAiRnJlZSB0cmlhbCB1bmxvY2sgbGltaXQgcmVhY2hlZC4gVXBncmFkZSB0byBQcmVtaXVtIG9yIHBheSBLRVMgMTAgdG8gdW5sb2NrIHRoaXMgcHJvZmlsZS4iCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICB1bmxvY2tNZXRob2QgPSAiZnJlZV90cmlhbCI7CiAgICAgIH0gZWxzZSBpZiAoYXJncy5wYXltZW50SWQpIHsKICAgICAgICB1bmxvY2tNZXRob2QgPSAicGFpZF91bmxvY2siOwogICAgICAgIGNvc3QgPSAxMDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgICAiQ2Fubm90IHVubG9jayBwcm9maWxlLiBQbGVhc2UgdXBncmFkZSB0byBQcmVtaXVtIG9yIHB1cmNoYXNlIGFuIHVubG9jay4iCiAgICAgICAgKTsKICAgICAgfQogICAgfQoKICAgIC8vIENyZWF0ZSB1bmxvY2sgcmVjb3JkCiAgICBhd2FpdCBjdHguZGIuaW5zZXJ0KCJwcm9maWxlVW5sb2NrcyIsIHsKICAgICAgdXNlcklkOiBhcmdzLnVzZXJJZCwKICAgICAgdW5sb2NrZWRVc2VySWQ6IGFyZ3MudGFyZ2V0VXNlcklkLAogICAgICB1bmxvY2tlZEF0OiBub3csCiAgICAgIHVubG9ja01ldGhvZCwKICAgICAgY29zdDogY29zdCA+IDAgPyBjb3N0IDogdW5kZWZpbmVkLAogICAgICBwYXltZW50SWQ6IGFyZ3MucGF5bWVudElkLAogICAgfSk7CgogICAgcmV0dXJuIHsKICAgICAgc3VjY2VzczogdHJ1ZSwKICAgICAgdW5sb2NrTWV0aG9kLAogICAgICBjb3N0LAogICAgfTsKICB9LAp9KTsKCi8qKgogKiBHZXQgYWxsIHVubG9ja2VkIHByb2ZpbGVzIGZvciBhIHVzZXIKICovCmV4cG9ydCBjb25zdCBnZXRVbmxvY2tlZFByb2ZpbGVzID0gcXVlcnkoewogIGFyZ3M6IHsgdXNlcklkOiB2LmlkKCJ1c2VycyIpIH0sCiAgaGFuZGxlcjogYXN5bmMgKGN0eCwgYXJncykgPT4gewogICAgY29uc3QgdW5sb2NrcyA9IGF3YWl0IGN0eC5kYgogICAgICAucXVlcnkoInByb2ZpbGVVbmxvY2tzIikKICAgICAgLndpdGhJbmRleCgidXNlcklkIiwgKHEpID0+IHEuZXEoInVzZXJJZCIsIGFyZ3MudXNlcklkKSkKICAgICAgLmNvbGxlY3QoKTsKCiAgICByZXR1cm4gdW5sb2Nrcy5tYXAoKHUpID0+ICh7CiAgICAgIHVzZXJJZDogdS51bmxvY2tlZFVzZXJJZCwKICAgICAgdW5sb2NrZWRBdDogdS51bmxvY2tlZEF0LAogICAgICBtZXRob2Q6IHUudW5sb2NrTWV0aG9kLAogICAgICBjb3N0OiB1LmNvc3QsCiAgICB9KSk7CiAgfSwKfSk7CgovKioKICogR2V0IHVubG9jayBzdGF0aXN0aWNzCiAqLwpleHBvcnQgY29uc3QgZ2V0VW5sb2NrU3RhdHMgPSBxdWVyeSh7CiAgYXJnczogeyB1c2VySWQ6IHYuaWQoInVzZXJzIikgfSwKICBoYW5kbGVyOiBhc3luYyAoY3R4LCBhcmdzKSA9PiB7CiAgICBjb25zdCB1bmxvY2tzID0gYXdhaXQgY3R4LmRiCiAgICAgIC5xdWVyeSgicHJvZmlsZVVubG9ja3MiKQogICAgICAud2l0aEluZGV4KCJ1c2VySWQiLCAocSkgPT4gcS5lcSgidXNlcklkIiwgYXJncy51c2VySWQpKQogICAgICAuY29sbGVjdCgpOwoKICAgIGNvbnN0IGZyZWVUcmlhbFVubG9ja3MgPSB1bmxvY2tzLmZpbHRlcigodSkgPT4gdS51bmxvY2tNZXRob2QgPT09ICJmcmVlX3RyaWFsIikubGVuZ3RoOwogICAgY29uc3QgcHJlbWl1bVVubG9ja3MgPSB1bmxvY2tzLmZpbHRlcigodSkgPT4gdS51bmxvY2tNZXRob2QgPT09ICJwcmVtaXVtX3N1YnNjcmlwdGlvbiIpLmxlbmd0aDsKICAgIGNvbnN0IHBhaWRVbmxvY2tzID0gdW5sb2Nrcy5maWx0ZXIoKHUpID0+IHUudW5sb2NrTWV0aG9kID09PSAicGFpZF91bmxvY2siKS5sZW5ndGg7CiAgICBjb25zdCB0b3RhbFNwZW50ID0gdW5sb2Nrcy5yZWR1Y2UoKHN1bSwgdSkgPT4gc3VtICsgKHUuY29zdCB8fCAwKSwgMCk7CgogICAgcmV0dXJuIHsKICAgICAgdG90YWw6IHVubG9ja3MubGVuZ3RoLAogICAgICBmcmVlVHJpYWxVbmxvY2tzLAogICAgICBwcmVtaXVtVW5sb2NrcywKICAgICAgcGFpZFVubG9ja3MsCiAgICAgIHRvdGFsU3BlbnQsCiAgICB9OwogIH0sCn0pOwo="}