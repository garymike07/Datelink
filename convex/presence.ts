{"data":"aW1wb3J0IHsgbXV0YXRpb24sIHF1ZXJ5IH0gZnJvbSAiLi9fZ2VuZXJhdGVkL3NlcnZlciI7CmltcG9ydCB7IHYgfSBmcm9tICJjb252ZXgvdmFsdWVzIjsKCmNvbnN0IHByZXNlbmNlU3RhdHVzID0gdi51bmlvbih2LmxpdGVyYWwoIm9ubGluZSIpLCB2LmxpdGVyYWwoImF3YXkiKSwgdi5saXRlcmFsKCJvZmZsaW5lIikpOwoKZXhwb3J0IGNvbnN0IHVwZGF0ZVByZXNlbmNlID0gbXV0YXRpb24oewogIGFyZ3M6IHsKICAgIHVzZXJJZDogdi5pZCgidXNlcnMiKSwKICAgIHN0YXR1czogcHJlc2VuY2VTdGF0dXMsCiAgfSwKICBoYW5kbGVyOiBhc3luYyAoY3R4LCBhcmdzKSA9PiB7CiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwogICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBjdHguZGIKICAgICAgLnF1ZXJ5KCJwcmVzZW5jZSIpCiAgICAgIC53aXRoSW5kZXgoInVzZXJJZCIsIChxOiBhbnkpID0+IHEuZXEoInVzZXJJZCIsIGFyZ3MudXNlcklkKSkKICAgICAgLmZpcnN0KCk7CgogICAgaWYgKGV4aXN0aW5nKSB7CiAgICAgIGF3YWl0IGN0eC5kYi5wYXRjaChleGlzdGluZy5faWQsIHsgc3RhdHVzOiBhcmdzLnN0YXR1cywgbGFzdEFjdGl2ZUF0OiBub3csIHVwZGF0ZWRBdDogbm93IH0pOwogICAgfSBlbHNlIHsKICAgICAgYXdhaXQgY3R4LmRiLmluc2VydCgicHJlc2VuY2UiLCB7CiAgICAgICAgdXNlcklkOiBhcmdzLnVzZXJJZCwKICAgICAgICBzdGF0dXM6IGFyZ3Muc3RhdHVzLAogICAgICAgIGxhc3RBY3RpdmVBdDogbm93LAogICAgICAgIHVwZGF0ZWRBdDogbm93LAogICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07CiAgfSwKfSk7CgpleHBvcnQgY29uc3QgZ2V0UHJlc2VuY2VTdGF0dXMgPSBxdWVyeSh7CiAgYXJnczogewogICAgdGFyZ2V0VXNlcklkOiB2LmlkKCJ1c2VycyIpLAogICAgdmlld2VyVXNlcklkOiB2Lm9wdGlvbmFsKHYuaWQoInVzZXJzIikpLAogIH0sCiAgaGFuZGxlcjogYXN5bmMgKGN0eCwgYXJncykgPT4gewogICAgY29uc3Qgdmlld2VySXNUYXJnZXQgPSBhcmdzLnZpZXdlclVzZXJJZCAmJiBhcmdzLnZpZXdlclVzZXJJZCA9PT0gYXJncy50YXJnZXRVc2VySWQ7CgogICAgY29uc3Qgc2V0dGluZ3MgPSBhd2FpdCBjdHguZGIKICAgICAgLnF1ZXJ5KCJ1c2VyU2V0dGluZ3MiKQogICAgICAud2l0aEluZGV4KCJ1c2VySWQiLCAocTogYW55KSA9PiBxLmVxKCJ1c2VySWQiLCBhcmdzLnRhcmdldFVzZXJJZCkpCiAgICAgIC5maXJzdCgpOwoKICAgIGlmICghdmlld2VySXNUYXJnZXQgJiYgc2V0dGluZ3MgJiYgc2V0dGluZ3Muc2hvd09ubGluZVN0YXR1cyA9PT0gZmFsc2UpIHsKICAgICAgcmV0dXJuIHsgc3RhdHVzOiAiaGlkZGVuIiBhcyBjb25zdCwgbGFzdEFjdGl2ZUF0OiBudWxsIGFzIG51bWJlciB8IG51bGwgfTsKICAgIH0KCiAgICBjb25zdCBwcmVzZW5jZSA9IGF3YWl0IGN0eC5kYgogICAgICAucXVlcnkoInByZXNlbmNlIikKICAgICAgLndpdGhJbmRleCgidXNlcklkIiwgKHE6IGFueSkgPT4gcS5lcSgidXNlcklkIiwgYXJncy50YXJnZXRVc2VySWQpKQogICAgICAuZmlyc3QoKTsKCiAgICBjb25zdCBsYXN0QWN0aXZlQXQgPSBwcmVzZW5jZT8ubGFzdEFjdGl2ZUF0ID8/IG51bGw7CiAgICBpZiAoIWxhc3RBY3RpdmVBdCkgcmV0dXJuIHsgc3RhdHVzOiAib2ZmbGluZSIgYXMgY29uc3QsIGxhc3RBY3RpdmVBdCB9OwoKICAgIGNvbnN0IHNlY29uZHNTaW5jZUFjdGl2ZSA9IChEYXRlLm5vdygpIC0gbGFzdEFjdGl2ZUF0KSAvIDEwMDA7CiAgICBpZiAoc2Vjb25kc1NpbmNlQWN0aXZlIDwgNDUpIHJldHVybiB7IHN0YXR1czogIm9ubGluZSIgYXMgY29uc3QsIGxhc3RBY3RpdmVBdCB9OwogICAgaWYgKHNlY29uZHNTaW5jZUFjdGl2ZSA8IDUgKiA2MCkgcmV0dXJuIHsgc3RhdHVzOiAiYXdheSIgYXMgY29uc3QsIGxhc3RBY3RpdmVBdCB9OwogICAgcmV0dXJuIHsgc3RhdHVzOiAib2ZmbGluZSIgYXMgY29uc3QsIGxhc3RBY3RpdmVBdCB9OwogIH0sCn0pOwo="}