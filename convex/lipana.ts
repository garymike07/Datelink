{"data":"aW1wb3J0IHsgYWN0aW9uIH0gZnJvbSAiLi9fZ2VuZXJhdGVkL3NlcnZlciI7CmltcG9ydCB7IHYgfSBmcm9tICJjb252ZXgvdmFsdWVzIjsKCmNvbnN0IExJUEFOQV9CQVNFX1VSTCA9ICJodHRwczovL2FwaS5saXBhbmEuZGV2L3YxIjsKCmZ1bmN0aW9uIGdldExpcGFuYVNlY3JldEtleSgpIHsKICBjb25zdCByYXcgPSBwcm9jZXNzLmVudi5MSVBBTkFfU0VDUkVUX0tFWTsKICBsZXQga2V5ID0gdHlwZW9mIHJhdyA9PT0gInN0cmluZyIgPyByYXcgOiAiIjsKICAvLyBSZW1vdmUgbmV3bGluZXMgdGhhdCBzb21ldGltZXMgc25lYWsgaW4gdmlhIGNvcHkvcGFzdGUgb3IgZW52IHRvb2xpbmcKICBrZXkgPSBrZXkucmVwbGFjZSgvW1xyXG5dL2csICIiKS50cmltKCk7CiAgaWYgKCFrZXkpIHsKICAgIHRocm93IG5ldyBFcnJvcigiTWlzc2luZyBMSVBBTkFfU0VDUkVUX0tFWSBlbnYgdmFyIik7CiAgfQogIGlmICgvXlsnIl0vLnRlc3Qoa2V5KSB8fCAvWyciXSQvLnRlc3Qoa2V5KSkgeyAgLy8gZGlzYWxsb3cgc3Vycm91bmRpbmcgcXVvdGVzCgogICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIExJUEFOQV9TRUNSRVRfS0VZIChyZW1vdmUgc3Vycm91bmRpbmcgcXVvdGVzKSIpOwogIH0KICByZXR1cm4ga2V5Owp9Cgphc3luYyBmdW5jdGlvbiBsaXBhbmFGZXRjaChwYXRoOiBzdHJpbmcsIGluaXQ6IFJlcXVlc3RJbml0KSB7CiAgY29uc3QgdXJsID0gYCR7TElQQU5BX0JBU0VfVVJMfSR7cGF0aC5zdGFydHNXaXRoKCIvIikgPyAiIiA6ICIvIn0ke3BhdGh9YDsKICBjb25zdCBhcGlLZXkgPSBnZXRMaXBhbmFTZWNyZXRLZXkoKTsKICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwsIHsKICAgIC4uLmluaXQsCiAgICBoZWFkZXJzOiB7CiAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgIC8vIFByaW1hcnkgYXV0aCBtZXRob2QgKHBlciBkb2NzKQogICAgICAieC1hcGkta2V5IjogYXBpS2V5LAogICAgICAvLyBTZWNvbmRhcnkgYXV0aCBtZXRob2QgKHNvbWUgZW5kcG9pbnRzIG1heSByZXF1aXJlIGl0KQogICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YXBpS2V5fWAsCiAgICAgIC4uLihpbml0LmhlYWRlcnMgPz8ge30pLAogICAgfSwKICB9KTsKCiAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7CiAgbGV0IGpzb246IGFueSA9IG51bGw7CiAgdHJ5IHsKICAgIGpzb24gPSB0ZXh0ID8gSlNPTi5wYXJzZSh0ZXh0KSA6IG51bGw7CiAgfSBjYXRjaCB7CiAgICAvLyBub24tanNvbiByZXNwb25zZQogIH0KCiAgaWYgKCFyZXMub2spIHsKICAgIGNvbnN0IG1lc3NhZ2UgPSBqc29uPy5tZXNzYWdlID8/IGpzb24/LmVycm9yID8/IHRleHQgPz8gYExpcGFuYSByZXF1ZXN0IGZhaWxlZCAoJHtyZXMuc3RhdHVzfSlgOwogICAgdGhyb3cgbmV3IEVycm9yKGBMaXBhbmEgcmVxdWVzdCBmYWlsZWQgKCR7cmVzLnN0YXR1c30pICR7cmVzLnN0YXR1c1RleHR9OiAke21lc3NhZ2V9YCk7CiAgfQoKICByZXR1cm4ganNvbjsKfQoKZXhwb3J0IGNvbnN0IGNyZWF0ZVBheW1lbnRMaW5rID0gYWN0aW9uKHsKICBhcmdzOiB7CiAgICB0aXRsZTogdi5zdHJpbmcoKSwKICAgIGFtb3VudDogdi5udW1iZXIoKSwKICAgIGN1cnJlbmN5OiB2Lm9wdGlvbmFsKHYuc3RyaW5nKCkpLAogICAgbWV0YWRhdGE6IHYub3B0aW9uYWwodi5hbnkoKSksCiAgfSwKICBoYW5kbGVyOiBhc3luYyAoX2N0eCwgYXJncykgPT4gewogICAgY29uc3QgcGF5bG9hZDogYW55ID0gewogICAgICB0aXRsZTogYXJncy50aXRsZSwKICAgICAgYW1vdW50OiBhcmdzLmFtb3VudCwKICAgICAgY3VycmVuY3k6IGFyZ3MuY3VycmVuY3kgPz8gIktFUyIsCiAgICB9OwoKICAgIC8vIElmIExpcGFuYSBzdXBwb3J0cyBtZXRhZGF0YSwgaW5jbHVkZSBpdC4gKEhhcm1sZXNzIGlmIGlnbm9yZWQuKQogICAgaWYgKGFyZ3MubWV0YWRhdGEgIT09IHVuZGVmaW5lZCkgcGF5bG9hZC5tZXRhZGF0YSA9IGFyZ3MubWV0YWRhdGE7CgogICAgY29uc3QgZGF0YSA9IGF3YWl0IGxpcGFuYUZldGNoKCIvcGF5bWVudC1saW5rcyIsIHsKICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHBheWxvYWQpLAogICAgfSk7CgogICAgLy8gV2UgaW50ZW50aW9uYWxseSBhY2NlcHQgbXVsdGlwbGUgc2hhcGVzIHRvIGJlIHJvYnVzdCBhZ2FpbnN0IEFQSSBjaGFuZ2VzLgogICAgY29uc3QgaWQgPQogICAgICBkYXRhPy5pZCA/PwogICAgICBkYXRhPy5kYXRhPy5faWQgPz8KICAgICAgZGF0YT8uZGF0YT8uaWQgPz8KICAgICAgZGF0YT8ucGF5bWVudF9saW5rPy5faWQgPz8KICAgICAgZGF0YT8ucGF5bWVudF9saW5rPy5pZCA/PwogICAgICBkYXRhPy5wYXltZW50TGluaz8uX2lkID8/CiAgICAgIGRhdGE/LnBheW1lbnRMaW5rPy5pZCA/PwogICAgICBkYXRhPy5wYXltZW50TGlua0lkID8/CiAgICAgIGRhdGE/LnJlZmVyZW5jZSA/PwogICAgICBkYXRhPy5jaGVja291dD8uaWQ7CgogICAgY29uc3Qgc2x1ZyA9CiAgICAgIGRhdGE/LnNsdWcgPz8KICAgICAgZGF0YT8uZGF0YT8uc2x1ZyA/PwogICAgICBkYXRhPy5wYXltZW50X2xpbms/LnNsdWcgPz8KICAgICAgZGF0YT8ucGF5bWVudExpbms/LnNsdWc7CgogICAgbGV0IHVybCA9CiAgICAgIGRhdGE/LnVybCA/PwogICAgICBkYXRhPy5kYXRhPy51cmwgPz8KICAgICAgZGF0YT8ucGF5bWVudF9saW5rPy51cmwgPz8KICAgICAgZGF0YT8uY2hlY2tvdXRfdXJsID8/CiAgICAgIGRhdGE/LmNoZWNrb3V0VXJsID8/CiAgICAgIGRhdGE/LnBheW1lbnRMaW5rPy51cmwgPz8KICAgICAgZGF0YT8ucGF5bWVudF9saW5rX3VybCA/PwogICAgICBkYXRhPy5jaGVja291dD8udXJsOwoKICAgIC8vIElmIExpcGFuYSBkb2Vzbid0IHJldHVybiBhbiBleHBsaWNpdCBVUkwgYnV0IHdlIGhhdmUgYSBzbHVnLCBnZW5lcmF0ZSBhIGhvc3RlZCBjaGVja291dCBVUkwuCiAgICBpZiAoIXVybCAmJiBzbHVnKSB7CiAgICAgIHVybCA9IGBodHRwczovL2xpcGFuYS5kZXYvcGF5LyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhzbHVnKSl9YDsKICAgIH0KCiAgICAvLyBTb21lIExpcGFuYSByZXNwb25zZXMgcmV0dXJuIHRoZSBpZCBidXQgbm90IHRoZSBmaW5hbCBjaGVja291dCBVUkwgb24gY3JlYXRlLgogICAgLy8gSW4gdGhhdCBjYXNlLCBkbyBhIGZvbGxvdy11cCBHRVQgdG8gZmV0Y2ggdGhlIGZ1bGwgcmVzb3VyY2UgYW5kIHRyeSBhZ2Fpbi4KICAgIGlmIChpZCAmJiAhdXJsKSB7CiAgICAgIGNvbnN0IGRldGFpbHMgPSBhd2FpdCBsaXBhbmFGZXRjaChgL3BheW1lbnQtbGlua3MvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKGlkKSl9YCwgewogICAgICAgIG1ldGhvZDogIkdFVCIsCiAgICAgIH0pOwoKICAgICAgdXJsID0KICAgICAgICBkZXRhaWxzPy51cmwgPz8KICAgICAgICBkZXRhaWxzPy5kYXRhPy51cmwgPz8KICAgICAgICBkZXRhaWxzPy5wYXltZW50X2xpbms/LnVybCA/PwogICAgICAgIGRldGFpbHM/LmNoZWNrb3V0X3VybCA/PwogICAgICAgIGRldGFpbHM/LmNoZWNrb3V0VXJsID8/CiAgICAgICAgZGV0YWlscz8ucGF5bWVudExpbms/LnVybCA/PwogICAgICAgIGRldGFpbHM/LnBheW1lbnRfbGlua191cmwgPz8KICAgICAgICBkZXRhaWxzPy5jaGVja291dD8udXJsOwoKICAgICAgY29uc3QgZGV0YWlsc1NsdWcgPSBkZXRhaWxzPy5zbHVnID8/IGRldGFpbHM/LmRhdGE/LnNsdWcgPz8gZGV0YWlscz8ucGF5bWVudF9saW5rPy5zbHVnOwogICAgICBpZiAoIXVybCAmJiAoZGV0YWlsc1NsdWcgPz8gc2x1ZykpIHsKICAgICAgICB1cmwgPSBgaHR0cHM6Ly9saXBhbmEuZGV2L3BheS8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoZGV0YWlsc1NsdWcgPz8gc2x1ZykpfWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB7IGlkOiBTdHJpbmcoaWQpLCB1cmw6IFN0cmluZyh1cmwgPz8gIiIpLCByYXc6IGRhdGEsIGRldGFpbHNSYXc6IGRldGFpbHMgfTsKICAgIH0KCiAgICBpZiAoIWlkIHx8ICF1cmwpIHsKICAgICAgY29uc3Qgc2FmZSA9ICgoKSA9PiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShkYXRhKTsKICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgIHJldHVybiBTdHJpbmcoZGF0YSk7CiAgICAgICAgfQogICAgICB9KSgpOwogICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuZXhwZWN0ZWQgTGlwYW5hIHJlc3BvbnNlOiBtaXNzaW5nIHBheW1lbnQgbGluayBpZC91cmwuIFJhdz0ke3NhZmV9YCk7CiAgICB9CgogICAgcmV0dXJuIHsgaWQ6IFN0cmluZyhpZCksIHVybDogU3RyaW5nKHVybCksIHJhdzogZGF0YSB9OwogIH0sCn0pOwoKZXhwb3J0IGNvbnN0IGluaXRpYXRlU3RrUHVzaCA9IGFjdGlvbih7CiAgYXJnczogeyBwaG9uZTogdi5zdHJpbmcoKSwgYW1vdW50OiB2Lm51bWJlcigpIH0sCiAgaGFuZGxlcjogYXN5bmMgKF9jdHgsIGFyZ3MpID0+IHsKICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBsaXBhbmFGZXRjaCgiL3RyYW5zYWN0aW9ucy9wdXNoLXN0ayIsIHsKICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgcGhvbmU6IGFyZ3MucGhvbmUsIGFtb3VudDogYXJncy5hbW91bnQgfSksCiAgICB9KTsKCiAgICBjb25zdCB0cmFuc2FjdGlvbklkID0gZGF0YT8uZGF0YT8udHJhbnNhY3Rpb25JZCA/PyBkYXRhPy50cmFuc2FjdGlvbklkID8/IGRhdGE/LmlkOwogICAgY29uc3QgY2hlY2tvdXRSZXF1ZXN0SUQgPSBkYXRhPy5kYXRhPy5jaGVja291dFJlcXVlc3RJRCA/PyBkYXRhPy5kYXRhPy5jaGVja291dFJlcXVlc3RJZDsKICAgIGNvbnN0IHN0YXR1cyA9IGRhdGE/LmRhdGE/LnN0YXR1cyA/PyBkYXRhPy5zdGF0dXM7CgogICAgaWYgKCF0cmFuc2FjdGlvbklkKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5leHBlY3RlZCBMaXBhbmEgU1RLIHJlc3BvbnNlOiAke0pTT04uc3RyaW5naWZ5KGRhdGEpfWApOwogICAgfQoKICAgIHJldHVybiB7IHRyYW5zYWN0aW9uSWQ6IFN0cmluZyh0cmFuc2FjdGlvbklkKSwgY2hlY2tvdXRSZXF1ZXN0SUQsIHN0YXR1cywgcmF3OiBkYXRhIH07CiAgfSwKfSk7CgpleHBvcnQgY29uc3QgZ2V0VHJhbnNhY3Rpb24gPSBhY3Rpb24oewogIGFyZ3M6IHsgdHJhbnNhY3Rpb25JZDogdi5zdHJpbmcoKSB9LAogIGhhbmRsZXI6IGFzeW5jIChfY3R4LCBhcmdzKSA9PiB7CiAgICAvLyBQcmltYXJ5OiBHRVQgL3RyYW5zYWN0aW9ucy86aWQKICAgIHRyeSB7CiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBsaXBhbmFGZXRjaChgL3RyYW5zYWN0aW9ucy8ke2VuY29kZVVSSUNvbXBvbmVudChhcmdzLnRyYW5zYWN0aW9uSWQpfWAsIHsKICAgICAgICBtZXRob2Q6ICJHRVQiLAogICAgICB9KTsKICAgICAgcmV0dXJuIHsgcmF3OiBkYXRhIH07CiAgICB9IGNhdGNoIChlOiBhbnkpIHsKICAgICAgLy8gRmFsbGJhY2s6IHNvbWUgQVBJcyBvbmx5IHN1cHBvcnQgbGlzdGluZyBhbmQgZmlsdGVyaW5nLgogICAgICBjb25zdCBsaXN0ID0gYXdhaXQgbGlwYW5hRmV0Y2goYC90cmFuc2FjdGlvbnM/bGltaXQ9NTBgLCB7CiAgICAgICAgbWV0aG9kOiAiR0VUIiwKICAgICAgfSk7CiAgICAgIHJldHVybiB7IHJhdzogbGlzdCwgbG9va3VwRmFpbGVkOiBlPy5tZXNzYWdlID8/IFN0cmluZyhlKSB9OwogICAgfQogIH0sCn0pOwoKZXhwb3J0IGNvbnN0IGdldFBheW1lbnRMaW5rID0gYWN0aW9uKHsKICBhcmdzOiB7CiAgICBwYXltZW50TGlua0lkOiB2LnN0cmluZygpLAogIH0sCiAgaGFuZGxlcjogYXN5bmMgKF9jdHgsIGFyZ3MpID0+IHsKICAgIC8vIE1hbnkgcHJvdmlkZXJzIGV4cG9zZSBHRVQgL3BheW1lbnQtbGlua3MvOmlkOyBpbXBsZW1lbnQgdGhhdCBmaXJzdC4KICAgIC8vIElmIExpcGFuYSB1c2VzIGEgZGlmZmVyZW50IGVuZHBvaW50LCB3ZSBjYW4gYWRqdXN0IG9uY2UgeW91IHNoYXJlIHRoZSBleGFjdCBkb2NzLgogICAgY29uc3QgZGF0YSA9IGF3YWl0IGxpcGFuYUZldGNoKGAvcGF5bWVudC1saW5rcy8ke2VuY29kZVVSSUNvbXBvbmVudChhcmdzLnBheW1lbnRMaW5rSWQpfWAsIHsKICAgICAgbWV0aG9kOiAiR0VUIiwKICAgIH0pOwoKICAgIHJldHVybiB7IHJhdzogZGF0YSB9OwogIH0sCn0pOwo="}