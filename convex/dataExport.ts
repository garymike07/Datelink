{"data":"aW1wb3J0IHsgdiB9IGZyb20gImNvbnZleC92YWx1ZXMiOwppbXBvcnQgeyBtdXRhdGlvbiwgcXVlcnksIGludGVybmFsTXV0YXRpb24gfSBmcm9tICIuL19nZW5lcmF0ZWQvc2VydmVyIjsKCi8qKgogKiBSZXF1ZXN0IGRhdGEgZXhwb3J0IGZvciBHRFBSIGNvbXBsaWFuY2UKICovCmV4cG9ydCBjb25zdCByZXF1ZXN0RGF0YUV4cG9ydCA9IG11dGF0aW9uKHsKICBhcmdzOiB7IHRva2VuOiB2Lm9wdGlvbmFsKHYuc3RyaW5nKCkpIH0sCiAgaGFuZGxlcjogYXN5bmMgKGN0eCwgYXJncykgPT4gewogICAgY29uc3QgaWRlbnRpdHkgPSBhd2FpdCBjdHguYXV0aC5nZXRVc2VySWRlbnRpdHkoKTsKCiAgICBjb25zdCB1c2VyID0gaWRlbnRpdHkKICAgICAgPyBhd2FpdCBjdHguZGIKICAgICAgICAgIC5xdWVyeSgidXNlcnMiKQogICAgICAgICAgLndpdGhJbmRleCgiZW1haWwiLCAocSkgPT4gcS5lcSgiZW1haWwiLCBpZGVudGl0eS5lbWFpbCEpKQogICAgICAgICAgLmZpcnN0KCkKICAgICAgOiBhcmdzLnRva2VuCiAgICAgICAgPyBhd2FpdCAoYXN5bmMgKCkgPT4gewogICAgICAgICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgY3R4LmRiCiAgICAgICAgICAgICAgLnF1ZXJ5KCJzZXNzaW9ucyIpCiAgICAgICAgICAgICAgLndpdGhJbmRleCgidG9rZW4iLCAocSkgPT4gcS5lcSgidG9rZW4iLCBhcmdzLnRva2VuISkpCiAgICAgICAgICAgICAgLmZpcnN0KCk7CiAgICAgICAgICAgIGlmICghc2Vzc2lvbikgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGlmIChzZXNzaW9uLmV4cGlyZXNBdCA8IERhdGUubm93KCkpIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1cm4gYXdhaXQgY3R4LmRiLmdldChzZXNzaW9uLnVzZXJJZCk7CiAgICAgICAgICB9KSgpCiAgICAgICAgOiBudWxsOwoKICAgIGlmICghdXNlcikgdGhyb3cgbmV3IEVycm9yKCJOb3QgYXV0aGVudGljYXRlZCIpOwoKICAgIC8vIENoZWNrIGlmIHRoZXJlJ3MgYWxyZWFkeSBhIHJlY2VudCBleHBvcnQKICAgIGNvbnN0IHJlY2VudEV4cG9ydCA9IGF3YWl0IGN0eC5kYgogICAgICAucXVlcnkoImRhdGFFeHBvcnRzIikKICAgICAgLndpdGhJbmRleCgidXNlcklkIiwgKHEpID0+IHEuZXEoInVzZXJJZCIsIHVzZXIuX2lkKSkKICAgICAgLm9yZGVyKCJkZXNjIikKICAgICAgLmZpcnN0KCk7CgogICAgaWYgKAogICAgICByZWNlbnRFeHBvcnQgJiYKICAgICAgcmVjZW50RXhwb3J0LnN0YXR1cyA9PT0gInByb2Nlc3NpbmciICYmCiAgICAgIERhdGUubm93KCkgLSByZWNlbnRFeHBvcnQucmVxdWVzdGVkQXQgPCA1ICogNjAgKiAxMDAwIC8vIDUgbWludXRlcwogICAgKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbWVzc2FnZTogIkV4cG9ydCBhbHJlYWR5IGluIHByb2dyZXNzIiwKICAgICAgICBleHBvcnRJZDogcmVjZW50RXhwb3J0Ll9pZCwKICAgICAgfTsKICAgIH0KCiAgICAvLyBDb2xsZWN0IGFsbCB1c2VyIGRhdGEKICAgIGNvbnN0IHByb2ZpbGUgPSBhd2FpdCBjdHguZGIKICAgICAgLnF1ZXJ5KCJwcm9maWxlcyIpCiAgICAgIC53aXRoSW5kZXgoInVzZXJJZCIsIChxKSA9PiBxLmVxKCJ1c2VySWQiLCB1c2VyLl9pZCkpCiAgICAgIC5maXJzdCgpOwoKICAgIGNvbnN0IHBob3RvcyA9IGF3YWl0IGN0eC5kYgogICAgICAucXVlcnkoInBob3RvcyIpCiAgICAgIC53aXRoSW5kZXgoInVzZXJJZCIsIChxKSA9PiBxLmVxKCJ1c2VySWQiLCB1c2VyLl9pZCkpCiAgICAgIC5jb2xsZWN0KCk7CgogICAgY29uc3QgbWF0Y2hlcyA9IGF3YWl0IGN0eC5kYgogICAgICAucXVlcnkoIm1hdGNoZXMiKQogICAgICAuY29sbGVjdCgpOwogICAgY29uc3QgdXNlck1hdGNoZXMgPSBtYXRjaGVzLmZpbHRlcigKICAgICAgKG0pID0+IG0udXNlcjFJZCA9PT0gdXNlci5faWQgfHwgbS51c2VyMklkID09PSB1c2VyLl9pZAogICAgKTsKCiAgICBjb25zdCBtZXNzYWdlcyA9IGF3YWl0IGN0eC5kYgogICAgICAucXVlcnkoIm1lc3NhZ2VzIikKICAgICAgLmNvbGxlY3QoKTsKICAgIGNvbnN0IHVzZXJNZXNzYWdlcyA9IG1lc3NhZ2VzLmZpbHRlcigKICAgICAgKG0pID0+IG0uc2VuZGVySWQgPT09IHVzZXIuX2lkIHx8IG0ucmVjZWl2ZXJJZCA9PT0gdXNlci5faWQKICAgICk7CgogICAgY29uc3QgbGlrZXMgPSBhd2FpdCBjdHguZGIKICAgICAgLnF1ZXJ5KCJsaWtlcyIpCiAgICAgIC5jb2xsZWN0KCk7CiAgICBjb25zdCBzZW50TGlrZXMgPSBsaWtlcy5maWx0ZXIoKGwpID0+IGwudXNlcklkID09PSB1c2VyLl9pZCk7CiAgICBjb25zdCByZWNlaXZlZExpa2VzID0gbGlrZXMuZmlsdGVyKChsKSA9PiBsLmxpa2VkVXNlcklkID09PSB1c2VyLl9pZCk7CgogICAgY29uc3Qgc2V0dGluZ3MgPSBhd2FpdCBjdHguZGIKICAgICAgLnF1ZXJ5KCJ1c2VyU2V0dGluZ3MiKQogICAgICAud2l0aEluZGV4KCJ1c2VySWQiLCAocSkgPT4gcS5lcSgidXNlcklkIiwgdXNlci5faWQpKQogICAgICAuZmlyc3QoKTsKCiAgICBjb25zdCBzdWJzY3JpcHRpb25zID0gYXdhaXQgY3R4LmRiCiAgICAgIC5xdWVyeSgic3Vic2NyaXB0aW9ucyIpCiAgICAgIC53aXRoSW5kZXgoInVzZXJJZCIsIChxKSA9PiBxLmVxKCJ1c2VySWQiLCB1c2VyLl9pZCkpCiAgICAgIC5jb2xsZWN0KCk7CgogICAgY29uc3QgcGF5bWVudHMgPSBhd2FpdCBjdHguZGIKICAgICAgLnF1ZXJ5KCJwYXltZW50cyIpCiAgICAgIC53aXRoSW5kZXgoInVzZXJJZCIsIChxKSA9PiBxLmVxKCJ1c2VySWQiLCB1c2VyLl9pZCkpCiAgICAgIC5jb2xsZWN0KCk7CgogICAgY29uc3Qgbm90aWZpY2F0aW9ucyA9IGF3YWl0IGN0eC5kYgogICAgICAucXVlcnkoIm5vdGlmaWNhdGlvbnMiKQogICAgICAud2l0aEluZGV4KCJ1c2VySWQiLCAocSkgPT4gcS5lcSgidXNlcklkIiwgdXNlci5faWQpKQogICAgICAuY29sbGVjdCgpOwoKICAgIGNvbnN0IGFjdGl2aXR5TG9nID0gYXdhaXQgY3R4LmRiCiAgICAgIC5xdWVyeSgiYWN0aXZpdHlMb2ciKQogICAgICAud2l0aEluZGV4KCJ1c2VySWQiLCAocSkgPT4gcS5lcSgidXNlcklkIiwgdXNlci5faWQpKQogICAgICAuY29sbGVjdCgpOwoKICAgIGNvbnN0IHVzZXJQcm9ncmVzcyA9IGF3YWl0IGN0eC5kYgogICAgICAucXVlcnkoInVzZXJQcm9ncmVzcyIpCiAgICAgIC53aXRoSW5kZXgoInVzZXJJZCIsIChxKSA9PiBxLmVxKCJ1c2VySWQiLCB1c2VyLl9pZCkpCiAgICAgIC5maXJzdCgpOwoKICAgIGNvbnN0IGNhbGxzID0gYXdhaXQgY3R4LmRiCiAgICAgIC5xdWVyeSgiY2FsbHMiKQogICAgICAuY29sbGVjdCgpOwogICAgY29uc3QgdXNlckNhbGxzID0gY2FsbHMuZmlsdGVyKAogICAgICAoYykgPT4gYy5jYWxsZXJJZCA9PT0gdXNlci5faWQgfHwgYy5yZWNlaXZlcklkID09PSB1c2VyLl9pZAogICAgKTsKCiAgICBjb25zdCBxdWVzdHMgPSBhd2FpdCBjdHguZGIKICAgICAgLnF1ZXJ5KCJxdWVzdHMiKQogICAgICAud2l0aEluZGV4KCJ1c2VySWQiLCAocSkgPT4gcS5lcSgidXNlcklkIiwgdXNlci5faWQpKS5jb2xsZWN0KCk7CiAgICAvLyBDcmVhdGUgc2FuaXRpemVkIGV4cG9ydCBkYXRhCiAgICBjb25zdCBleHBvcnREYXRhID0gewogICAgICBleHBvcnREYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgIGV4cG9ydEZvcm1hdDogIkpTT04iLAogICAgICBwcml2YWN5Tm90aWNlOgogICAgICAgICJUaGlzIGV4cG9ydCBjb250YWlucyBhbGwgcGVyc29uYWwgZGF0YSB3ZSBoYXZlIGNvbGxlY3RlZCBhYm91dCB5b3UuIiwKCiAgICAgIGFjY291bnQ6IHsKICAgICAgICBlbWFpbDogdXNlci5lbWFpbCwKICAgICAgICBuYW1lOiB1c2VyLm5hbWUsCiAgICAgICAgcGhvbmU6IHVzZXIucGhvbmUsCiAgICAgICAgaXNWZXJpZmllZDogdXNlci5pc1ZlcmlmaWVkLAogICAgICAgIGVtYWlsVmVyaWZpZWQ6IHVzZXIuZW1haWxWZXJpZmllZCwKICAgICAgICB2ZXJpZmljYXRpb25TdGF0dXM6IHVzZXIudmVyaWZpY2F0aW9uU3RhdHVzLAogICAgICAgIGFjY291bnRTdGF0dXM6IHVzZXIuYWNjb3VudFN0YXR1cyB8fCAiYWN0aXZlIiwKICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKHVzZXIuY3JlYXRlZEF0KS50b0lTT1N0cmluZygpLAogICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUodXNlci51cGRhdGVkQXQpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgbGFzdFNlZW5BdDogdXNlci5sYXN0U2VlbkF0CiAgICAgICAgICA/IG5ldyBEYXRlKHVzZXIubGFzdFNlZW5BdCkudG9JU09TdHJpbmcoKQogICAgICAgICAgOiBudWxsLAogICAgICB9LAoKICAgICAgcHJvZmlsZTogcHJvZmlsZQogICAgICAgID8gewogICAgICAgICAgICBhZ2U6IHByb2ZpbGUuYWdlLAogICAgICAgICAgICBnZW5kZXI6IHByb2ZpbGUuZ2VuZGVyLAogICAgICAgICAgICBiaW86IHByb2ZpbGUuYmlvLAogICAgICAgICAgICBsb2NhdGlvbjogcHJvZmlsZS5sb2NhdGlvbiwKICAgICAgICAgICAgaGVpZ2h0OiBwcm9maWxlLmhlaWdodCwKICAgICAgICAgICAgZWR1Y2F0aW9uOiBwcm9maWxlLmVkdWNhdGlvbiwKICAgICAgICAgICAgam9iVGl0bGU6IHByb2ZpbGUuam9iVGl0bGUsCiAgICAgICAgICAgIGNvbXBhbnk6IHByb2ZpbGUuY29tcGFueSwKICAgICAgICAgICAgcmVsYXRpb25zaGlwR29hbDogcHJvZmlsZS5yZWxhdGlvbnNoaXBHb2FsLAogICAgICAgICAgICByZWxpZ2lvbjogcHJvZmlsZS5yZWxpZ2lvbiwKICAgICAgICAgICAgZHJpbmtpbmc6IHByb2ZpbGUuZHJpbmtpbmcsCiAgICAgICAgICAgIHNtb2tpbmc6IHByb2ZpbGUuc21va2luZywKICAgICAgICAgICAgZXhlcmNpc2U6IHByb2ZpbGUuZXhlcmNpc2UsCiAgICAgICAgICAgIGRpZXQ6IHByb2ZpbGUuZGlldCwKICAgICAgICAgICAgaGFzS2lkczogcHJvZmlsZS5oYXNLaWRzLAogICAgICAgICAgICB3YW50c0tpZHM6IHByb2ZpbGUud2FudHNLaWRzLAogICAgICAgICAgICBsYW5ndWFnZXM6IHByb2ZpbGUubGFuZ3VhZ2VzLAogICAgICAgICAgICBwZXRzOiBwcm9maWxlLnBldHMsCiAgICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUocHJvZmlsZS5jcmVhdGVkQXQpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUocHJvZmlsZS51cGRhdGVkQXQpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICB9CiAgICAgICAgOiBudWxsLAoKICAgICAgcGhvdG9zOiBwaG90b3MubWFwKChwKSA9PiAoewogICAgICAgIHVybDogcC51cmwsCiAgICAgICAgb3JkZXI6IHAub3JkZXIsCiAgICAgICAgaXNQcmltYXJ5OiBwLmlzUHJpbWFyeSwKICAgICAgICB1cGxvYWRlZEF0OiBuZXcgRGF0ZShwLmNyZWF0ZWRBdCkudG9JU09TdHJpbmcoKSwKICAgICAgfSkpLAoKICAgICAgc3RhdGlzdGljczogewogICAgICAgIHRvdGFsTWF0Y2hlczogdXNlck1hdGNoZXMubGVuZ3RoLAogICAgICAgIHRvdGFsTWVzc2FnZXM6IHVzZXJNZXNzYWdlcy5sZW5ndGgsCiAgICAgICAgbGlrZXNTZW50OiBzZW50TGlrZXMubGVuZ3RoLAogICAgICAgIGxpa2VzUmVjZWl2ZWQ6IHJlY2VpdmVkTGlrZXMubGVuZ3RoLAogICAgICAgIHRvdGFsQ2FsbHM6IHVzZXJDYWxscy5sZW5ndGgsCiAgICAgIH0sCgogICAgICBtYXRjaGVzOiB1c2VyTWF0Y2hlcy5tYXAoKG0pID0+ICh7CiAgICAgICAgbWF0Y2hlZEF0OiBuZXcgRGF0ZShtLm1hdGNoZWRBdCkudG9JU09TdHJpbmcoKSwKICAgICAgICBsYXN0TWVzc2FnZUF0OiBtLmxhc3RNZXNzYWdlQXQgPyBuZXcgRGF0ZShtLmxhc3RNZXNzYWdlQXQpLnRvSVNPU3RyaW5nKCkgOiBudWxsLAogICAgICB9KSksCgogICAgICBtZXNzYWdlczogdXNlck1lc3NhZ2VzLm1hcCgobSkgPT4gKHsKICAgICAgICB0eXBlOiBtLnR5cGUgfHwgInRleHQiLAogICAgICAgIHNlbnRBdDogbmV3IERhdGUobS5jcmVhdGVkQXQpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgd2FzSWFtU2VuZGVyOiBtLnNlbmRlcklkID09PSB1c2VyLl9pZCwKICAgICAgICBib2R5OiBtLmJvZHksCiAgICAgICAgaXNSZWFkOiBtLmlzUmVhZCwKICAgICAgfSkpLAoKICAgICAgbGlrZXM6IHsKICAgICAgICBzZW50OiBzZW50TGlrZXMubWFwKChsKSA9PiAoewogICAgICAgICAgbGlrZWRBdDogbmV3IERhdGUobC5jcmVhdGVkQXQpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgfSkpLAogICAgICAgIHJlY2VpdmVkOiByZWNlaXZlZExpa2VzLm1hcCgobCkgPT4gKHsKICAgICAgICAgIHJlY2VpdmVkQXQ6IG5ldyBEYXRlKGwuY3JlYXRlZEF0KS50b0lTT1N0cmluZygpLAogICAgICAgIH0pKSwKICAgICAgfSwKCiAgICAgIHNldHRpbmdzOiBzZXR0aW5ncwogICAgICAgID8gewogICAgICAgICAgICBzaG93T25saW5lU3RhdHVzOiBzZXR0aW5ncy5zaG93T25saW5lU3RhdHVzLAogICAgICAgICAgICByZWFkUmVjZWlwdHM6IHNldHRpbmdzLnJlYWRSZWNlaXB0cywKICAgICAgICAgICAgZW1haWxOb3RpZmljYXRpb25zOiBzZXR0aW5ncy5lbWFpbE5vdGlmaWNhdGlvbnMsCiAgICAgICAgICAgIG1hdGNoTm90aWZpY2F0aW9uczogc2V0dGluZ3MubWF0Y2hOb3RpZmljYXRpb25zLAogICAgICAgICAgICBtZXNzYWdlTm90aWZpY2F0aW9uczogc2V0dGluZ3MubWVzc2FnZU5vdGlmaWNhdGlvbnMsCiAgICAgICAgICB9CiAgICAgICAgOiBudWxsLAoKICAgICAgc3Vic2NyaXB0aW9uczogc3Vic2NyaXB0aW9ucy5tYXAoKHMpID0+ICh7CiAgICAgICAgcGxhbjogcy5wbGFuLAogICAgICAgIHN0YXR1czogcy5zdGF0dXMsCiAgICAgICAgYW1vdW50OiBzLmFtb3VudCwKICAgICAgICBjdXJyZW5jeTogcy5jdXJyZW5jeSwKICAgICAgICBiaWxsaW5nQ3ljbGU6IHMuYmlsbGluZ0N5Y2xlLAogICAgICAgIHN0YXJ0ZWRBdDogbmV3IERhdGUocy5zdGFydGVkQXQpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgZW5kc0F0OiBzLmVuZHNBdCA/IG5ldyBEYXRlKHMuZW5kc0F0KS50b0lTT1N0cmluZygpIDogbnVsbCwKICAgICAgfSkpLAoKICAgICAgcGF5bWVudHM6IHBheW1lbnRzLm1hcCgocCkgPT4gKHsKICAgICAgICBhbW91bnQ6IHAuYW1vdW50LAogICAgICAgIGN1cnJlbmN5OiBwLmN1cnJlbmN5LAogICAgICAgIHBheW1lbnRNZXRob2Q6IHAucGF5bWVudE1ldGhvZCwKICAgICAgICBzdGF0dXM6IHAuc3RhdHVzLAogICAgICAgIHByb2R1Y3RUeXBlOiBwLnByb2R1Y3RUeXBlLAogICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUocC5jcmVhdGVkQXQpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgY29tcGxldGVkQXQ6IHAuY29tcGxldGVkQXQKICAgICAgICAgID8gbmV3IERhdGUocC5jb21wbGV0ZWRBdCkudG9JU09TdHJpbmcoKQogICAgICAgICAgOiBudWxsLAogICAgICB9KSksCgogICAgICBub3RpZmljYXRpb25zOiBub3RpZmljYXRpb25zLm1hcCgobikgPT4gKHsKICAgICAgICB0eXBlOiBuLnR5cGUsCiAgICAgICAgdGl0bGU6IG4udGl0bGUsCiAgICAgICAgYm9keTogbi5ib2R5LAogICAgICAgIGlzUmVhZDogbi5pc1JlYWQsCiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZShuLmNyZWF0ZWRBdCkudG9JU09TdHJpbmcoKSwKICAgICAgfSkpLAoKICAgICAgYWN0aXZpdHlMb2c6IGFjdGl2aXR5TG9nLm1hcCgoYSkgPT4gKHsKICAgICAgICBhY3Rpdml0eVR5cGU6IGEuYWN0aXZpdHlUeXBlLAogICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoYS50aW1lc3RhbXApLnRvSVNPU3RyaW5nKCksCiAgICAgIH0pKSwKCiAgICAgIGdhbWlmaWNhdGlvbjogdXNlclByb2dyZXNzCiAgICAgICAgPyB7CiAgICAgICAgICAgIGxldmVsOiB1c2VyUHJvZ3Jlc3MubGV2ZWwsCiAgICAgICAgICAgIHhwOiB1c2VyUHJvZ3Jlc3MueHAsCiAgICAgICAgICAgIGJhZGdlczogdXNlclByb2dyZXNzLmJhZGdlcywKICAgICAgICAgIH0KICAgICAgICA6IG51bGwsCgogICAgICBxdWVzdHM6IHF1ZXN0cy5tYXAoKHEpID0+ICh7CiAgICAgICAgcXVlc3RUeXBlOiBxLnF1ZXN0VHlwZSwKICAgICAgICBwcm9ncmVzczogcS5wcm9ncmVzcywKICAgICAgICB0YXJnZXQ6IHEudGFyZ2V0LAogICAgICAgIGNvbXBsZXRlZEF0OiBxLmNvbXBsZXRlZEF0CiAgICAgICAgICA/IG5ldyBEYXRlKHEuY29tcGxldGVkQXQpLnRvSVNPU3RyaW5nKCkKICAgICAgICAgIDogbnVsbCwKICAgICAgfSkpLAogICAgfTsKCiAgICAvLyBDb252ZXJ0IHRvIEpTT04gc3RyaW5nCiAgICBjb25zdCBqc29uU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoZXhwb3J0RGF0YSwgbnVsbCwgMik7CiAgICBjb25zdCBmaWxlU2l6ZSA9IG5ldyBCbG9iKFtqc29uU3RyaW5nXSkuc2l6ZTsKCiAgICAvLyBDcmVhdGUgZXhwb3J0IHJlY29yZAogICAgY29uc3QgZXhwb3J0SWQgPSBhd2FpdCBjdHguZGIuaW5zZXJ0KCJkYXRhRXhwb3J0cyIsIHsKICAgICAgdXNlcklkOiB1c2VyLl9pZCwKICAgICAgc3RhdHVzOiAiY29tcGxldGVkIiwKICAgICAgZmlsZVVybDogYGRhdGE6YXBwbGljYXRpb24vanNvbjtiYXNlNjQsJHtCdWZmZXIuZnJvbShqc29uU3RyaW5nKS50b1N0cmluZygiYmFzZTY0Iil9YCwKICAgICAgZmlsZVNpemUsCiAgICAgIHJlcXVlc3RlZEF0OiBEYXRlLm5vdygpLAogICAgICBjb21wbGV0ZWRBdDogRGF0ZS5ub3coKSwKICAgICAgZXhwaXJlc0F0OiBEYXRlLm5vdygpICsgNyAqIDI0ICogNjAgKiA2MCAqIDEwMDAsIC8vIDcgZGF5cwogICAgfSk7CgogICAgLy8gU2VuZCBub3RpZmljYXRpb24KICAgIGF3YWl0IGN0eC5kYi5pbnNlcnQoIm5vdGlmaWNhdGlvbnMiLCB7CiAgICAgIHVzZXJJZDogdXNlci5faWQsCiAgICAgIHR5cGU6ICJwcm9maWxlX2NyZWF0ZWQiLAogICAgICB0aXRsZTogIkRhdGEgRXhwb3J0IFJlYWR5IiwKICAgICAgYm9keToKICAgICAgICAiWW91ciBwZXJzb25hbCBkYXRhIGV4cG9ydCBpcyByZWFkeSBmb3IgZG93bmxvYWQuIEl0IHdpbGwgYmUgYXZhaWxhYmxlIGZvciA3IGRheXMuIiwKICAgICAgaXNSZWFkOiBmYWxzZSwKICAgICAgY3JlYXRlZEF0OiBEYXRlLm5vdygpLAogICAgfSk7CgogICAgcmV0dXJuIHsKICAgICAgZXhwb3J0SWQsCiAgICAgIG1lc3NhZ2U6ICJEYXRhIGV4cG9ydCBjb21wbGV0ZWQiLAogICAgICBmaWxlU2l6ZSwKICAgICAgZXhwaXJlc0F0OiBEYXRlLm5vdygpICsgNyAqIDI0ICogNjAgKiA2MCAqIDEwMDAsCiAgICB9OwogIH0sCn0pOwoKLyoqCiAqIEdldCBkYXRhIGV4cG9ydCBzdGF0dXMgYW5kIGRvd25sb2FkIFVSTAogKi8KZXhwb3J0IGNvbnN0IGdldERhdGFFeHBvcnQgPSBxdWVyeSh7CiAgYXJnczogeyB0b2tlbjogdi5vcHRpb25hbCh2LnN0cmluZygpKSB9LAogIGhhbmRsZXI6IGFzeW5jIChjdHgsIGFyZ3MpID0+IHsKICAgIGNvbnN0IGlkZW50aXR5ID0gYXdhaXQgY3R4LmF1dGguZ2V0VXNlcklkZW50aXR5KCk7CgogICAgY29uc3QgdXNlciA9IGlkZW50aXR5CiAgICAgID8gYXdhaXQgY3R4LmRiCiAgICAgICAgICAucXVlcnkoInVzZXJzIikKICAgICAgICAgIC53aXRoSW5kZXgoImVtYWlsIiwgKHEpID0+IHEuZXEoImVtYWlsIiwgaWRlbnRpdHkuZW1haWwhKSkKICAgICAgICAgIC5maXJzdCgpCiAgICAgIDogYXJncy50b2tlbgogICAgICAgID8gYXdhaXQgKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGN0eC5kYgogICAgICAgICAgICAgIC5xdWVyeSgic2Vzc2lvbnMiKQogICAgICAgICAgICAgIC53aXRoSW5kZXgoInRva2VuIiwgKHEpID0+IHEuZXEoInRva2VuIiwgYXJncy50b2tlbiEpKQogICAgICAgICAgICAgIC5maXJzdCgpOwogICAgICAgICAgICBpZiAoIXNlc3Npb24pIHJldHVybiBudWxsOwogICAgICAgICAgICBpZiAoc2Vzc2lvbi5leHBpcmVzQXQgPCBEYXRlLm5vdygpKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGN0eC5kYi5nZXQoc2Vzc2lvbi51c2VySWQpOwogICAgICAgICAgfSkoKQogICAgICAgIDogbnVsbDsKCiAgICBpZiAoIXVzZXIpIHJldHVybiBudWxsOwoKICAgIGNvbnN0IGRhdGFFeHBvcnQgPSBhd2FpdCBjdHguZGIKICAgICAgLnF1ZXJ5KCJkYXRhRXhwb3J0cyIpCiAgICAgIC53aXRoSW5kZXgoInVzZXJJZCIsIChxKSA9PiBxLmVxKCJ1c2VySWQiLCB1c2VyLl9pZCkpCiAgICAgIC5vcmRlcigiZGVzYyIpCiAgICAgIC5maXJzdCgpOwoKICAgIGlmICghZGF0YUV4cG9ydCkgcmV0dXJuIG51bGw7CgogICAgLy8gQ2hlY2sgaWYgZXhwb3J0IGhhcyBleHBpcmVkIChub3RlOiBjYW5ub3QgcGF0Y2ggaW4gcXVlcnksIGp1c3QgcmV0dXJuIHN0YXR1cykKICAgIGlmICgKICAgICAgZGF0YUV4cG9ydC5leHBpcmVzQXQgJiYKICAgICAgZGF0YUV4cG9ydC5leHBpcmVzQXQgPCBEYXRlLm5vdygpICYmCiAgICAgIGRhdGFFeHBvcnQuc3RhdHVzICE9PSAiZXhwaXJlZCIKICAgICkgewogICAgICByZXR1cm4geyAuLi5kYXRhRXhwb3J0LCBzdGF0dXM6ICJleHBpcmVkIiBhcyBjb25zdCB9OwogICAgfQoKICAgIHJldHVybiBkYXRhRXhwb3J0OwogIH0sCn0pOwoKLyoqCiAqIE1hcmsgZXhwb3J0IGFzIGRvd25sb2FkZWQKICovCmV4cG9ydCBjb25zdCBtYXJrRXhwb3J0RG93bmxvYWRlZCA9IG11dGF0aW9uKHsKICBhcmdzOiB7IGV4cG9ydElkOiB2LmlkKCJkYXRhRXhwb3J0cyIpLCB0b2tlbjogdi5vcHRpb25hbCh2LnN0cmluZygpKSB9LAogIGhhbmRsZXI6IGFzeW5jIChjdHgsIGFyZ3MpID0+IHsKICAgIGNvbnN0IGlkZW50aXR5ID0gYXdhaXQgY3R4LmF1dGguZ2V0VXNlcklkZW50aXR5KCk7CgogICAgY29uc3QgdXNlciA9IGlkZW50aXR5CiAgICAgID8gYXdhaXQgY3R4LmRiCiAgICAgICAgICAucXVlcnkoInVzZXJzIikKICAgICAgICAgIC53aXRoSW5kZXgoImVtYWlsIiwgKHEpID0+IHEuZXEoImVtYWlsIiwgaWRlbnRpdHkuZW1haWwhKSkKICAgICAgICAgIC5maXJzdCgpCiAgICAgIDogYXJncy50b2tlbgogICAgICAgID8gYXdhaXQgKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGN0eC5kYgogICAgICAgICAgICAgIC5xdWVyeSgic2Vzc2lvbnMiKQogICAgICAgICAgICAgIC53aXRoSW5kZXgoInRva2VuIiwgKHEpID0+IHEuZXEoInRva2VuIiwgYXJncy50b2tlbiEpKQogICAgICAgICAgICAgIC5maXJzdCgpOwogICAgICAgICAgICBpZiAoIXNlc3Npb24pIHJldHVybiBudWxsOwogICAgICAgICAgICBpZiAoc2Vzc2lvbi5leHBpcmVzQXQgPCBEYXRlLm5vdygpKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGN0eC5kYi5nZXQoc2Vzc2lvbi51c2VySWQpOwogICAgICAgICAgfSkoKQogICAgICAgIDogbnVsbDsKCiAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBFcnJvcigiTm90IGF1dGhlbnRpY2F0ZWQiKTsKCiAgICBjb25zdCBkYXRhRXhwb3J0ID0gYXdhaXQgY3R4LmRiLmdldChhcmdzLmV4cG9ydElkKTsKICAgIGlmICghZGF0YUV4cG9ydCkgdGhyb3cgbmV3IEVycm9yKCJFeHBvcnQgbm90IGZvdW5kIik7CgogICAgaWYgKGRhdGFFeHBvcnQudXNlcklkICE9PSB1c2VyLl9pZCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlVuYXV0aG9yaXplZCIpOwogICAgfQoKICAgIGF3YWl0IGN0eC5kYi5wYXRjaChhcmdzLmV4cG9ydElkLCB7CiAgICAgIGRvd25sb2FkZWRBdDogRGF0ZS5ub3coKSwKICAgIH0pOwoKICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTsKICB9LAp9KTsKCi8qKgogKiBEZWxldGUgb2xkIGV4cG9ydHMgKGNhbiBiZSBjYWxsZWQgYnkgY3JvbikKICovCmV4cG9ydCBjb25zdCBjbGVhbnVwRXhwaXJlZEV4cG9ydHMgPSBpbnRlcm5hbE11dGF0aW9uKHsKICBoYW5kbGVyOiBhc3luYyAoY3R4KSA9PiB7CiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwogICAgY29uc3QgYWxsRXhwb3J0cyA9IGF3YWl0IGN0eC5kYi5xdWVyeSgiZGF0YUV4cG9ydHMiKS5jb2xsZWN0KCk7CgogICAgbGV0IGRlbGV0ZWQgPSAwOwogICAgZm9yIChjb25zdCBleHAgb2YgYWxsRXhwb3J0cykgewogICAgICBpZiAoZXhwLmV4cGlyZXNBdCAmJiBleHAuZXhwaXJlc0F0IDwgbm93ICYmIGV4cC5zdGF0dXMgIT09ICJleHBpcmVkIikgewogICAgICAgIGF3YWl0IGN0eC5kYi5wYXRjaChleHAuX2lkLCB7IHN0YXR1czogImV4cGlyZWQiLCBmaWxlVXJsOiB1bmRlZmluZWQgfSk7CiAgICAgICAgZGVsZXRlZCsrOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHsgZXhwaXJlZDogZGVsZXRlZCB9OwogIH0sCn0pOwo="}