{"data":"aW1wb3J0IHsgdiB9IGZyb20gImNvbnZleC92YWx1ZXMiOwppbXBvcnQgeyBxdWVyeSB9IGZyb20gIi4vX2dlbmVyYXRlZC9zZXJ2ZXIiOwppbXBvcnQgdHlwZSB7IERvYyB9IGZyb20gIi4vX2dlbmVyYXRlZC9kYXRhTW9kZWwiOwoKLyoqCiAqIFByb2ZpbGUgQ29tcGxldGlvbiBTY29yZSBTeXN0ZW0KICogQ2FsY3VsYXRlcyBwcm9maWxlIHF1YWxpdHkgYW5kIGNvbXBsZXRpb24gcGVyY2VudGFnZQogKi8KCmludGVyZmFjZSBQcm9maWxlU2NvcmVCcmVha2Rvd24gewogIHRvdGFsU2NvcmU6IG51bWJlcjsKICBtYXhTY29yZTogbnVtYmVyOwogIHBlcmNlbnRhZ2U6IG51bWJlcjsKICBjb21wbGV0ZWRJdGVtczogc3RyaW5nW107CiAgbWlzc2luZ0l0ZW1zOiBBcnJheTx7CiAgICBpdGVtOiBzdHJpbmc7CiAgICBwb2ludHM6IG51bWJlcjsKICAgIHN1Z2dlc3Rpb246IHN0cmluZzsKICB9PjsKfQoKLy8gU2NvcmluZyBjcml0ZXJpYSAodG90YWw6IDEwMCBwb2ludHMpCmNvbnN0IFNDT1JFX0NSSVRFUklBID0gewogIGJhc2ljSW5mbzogewogICAgbmFtZTogNSwKICAgIGFnZTogNSwKICAgIGdlbmRlcjogNSwKICAgIGxvY2F0aW9uOiA1LAogIH0sCiAgcGhvdG9zOiB7CiAgICBwcmltYXJ5UGhvdG86IDE1LAogICAgdGhyZWVQaG90b3M6IDEwLAogICAgZml2ZVBob3RvczogMTAsCiAgfSwKICBhYm91dDogewogICAgYmlvOiAxNSwKICAgIGJpb0xlbmd0aDogNSwgLy8gQm9udXMgZm9yIGJpbyA+IDEwMCBjaGFycwogIH0sCiAgcHJlZmVyZW5jZXM6IHsKICAgIGFnZVJhbmdlOiAzLAogICAgZGlzdGFuY2U6IDMsCiAgICBsb29raW5nRm9yOiA0LAogIH0sCiAgcHJvbXB0czogewogICAgb25lUHJvbXB0OiA1LAogICAgdGhyZWVQcm9tcHRzOiA1LAogICAgZml2ZVByb21wdHM6IDUsCiAgfSwKICB2ZXJpZmljYXRpb246IHsKICAgIHBob25lVmVyaWZpZWQ6IDMsCiAgICBwaG90b1ZlcmlmaWVkOiA3LAogIH0sCn07CgpleHBvcnQgY29uc3QgY2FsY3VsYXRlUHJvZmlsZVNjb3JlID0gcXVlcnkoewogIGFyZ3M6IHsKICAgIHVzZXJJZDogdi5pZCgidXNlcnMiKSwKICB9LAogIGhhbmRsZXI6IGFzeW5jIChjdHgsIGFyZ3MpOiBQcm9taXNlPFByb2ZpbGVTY29yZUJyZWFrZG93bj4gPT4gewogICAgY29uc3QgdXNlciA9IGF3YWl0IGN0eC5kYi5nZXQoYXJncy51c2VySWQpOwogICAgaWYgKCF1c2VyKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiVXNlciBub3QgZm91bmQiKTsKICAgIH0KCiAgICBjb25zdCBwcm9maWxlID0gYXdhaXQgY3R4LmRiCiAgICAgIC5xdWVyeSgicHJvZmlsZXMiKQogICAgICAud2l0aEluZGV4KCJ1c2VySWQiLCAocSkgPT4gcS5lcSgidXNlcklkIiwgYXJncy51c2VySWQpKQogICAgICAuZmlyc3QoKTsKCiAgICBsZXQgdG90YWxTY29yZSA9IDA7CiAgICBjb25zdCBjb21wbGV0ZWRJdGVtczogc3RyaW5nW10gPSBbXTsKICAgIGNvbnN0IG1pc3NpbmdJdGVtczogQXJyYXk8ewogICAgICBpdGVtOiBzdHJpbmc7CiAgICAgIHBvaW50czogbnVtYmVyOwogICAgICBzdWdnZXN0aW9uOiBzdHJpbmc7CiAgICB9PiA9IFtdOwoKICAgIC8vIEJhc2ljIEluZm8KICAgIGlmICh1c2VyLm5hbWUpIHsKICAgICAgdG90YWxTY29yZSArPSBTQ09SRV9DUklURVJJQS5iYXNpY0luZm8ubmFtZTsKICAgICAgY29tcGxldGVkSXRlbXMucHVzaCgibmFtZSIpOwogICAgfSBlbHNlIHsKICAgICAgbWlzc2luZ0l0ZW1zLnB1c2goewogICAgICAgIGl0ZW06ICJOYW1lIiwKICAgICAgICBwb2ludHM6IFNDT1JFX0NSSVRFUklBLmJhc2ljSW5mby5uYW1lLAogICAgICAgIHN1Z2dlc3Rpb246ICJBZGQgeW91ciBuYW1lIHRvIGhlbHAgbWF0Y2hlcyBrbm93IHdobyB5b3UgYXJlIiwKICAgICAgfSk7CiAgICB9CgogICAgaWYgKHByb2ZpbGU/LmFnZSkgewogICAgICB0b3RhbFNjb3JlICs9IFNDT1JFX0NSSVRFUklBLmJhc2ljSW5mby5hZ2U7CiAgICAgIGNvbXBsZXRlZEl0ZW1zLnB1c2goImFnZSIpOwogICAgfSBlbHNlIHsKICAgICAgbWlzc2luZ0l0ZW1zLnB1c2goewogICAgICAgIGl0ZW06ICJBZ2UiLAogICAgICAgIHBvaW50czogU0NPUkVfQ1JJVEVSSUEuYmFzaWNJbmZvLmFnZSwKICAgICAgICBzdWdnZXN0aW9uOiAiQWRkIHlvdXIgYWdlIHRvIGZpbmQgY29tcGF0aWJsZSBtYXRjaGVzIiwKICAgICAgfSk7CiAgICB9CgogICAgaWYgKHByb2ZpbGU/LmdlbmRlcikgewogICAgICB0b3RhbFNjb3JlICs9IFNDT1JFX0NSSVRFUklBLmJhc2ljSW5mby5nZW5kZXI7CiAgICAgIGNvbXBsZXRlZEl0ZW1zLnB1c2goImdlbmRlciIpOwogICAgfSBlbHNlIHsKICAgICAgbWlzc2luZ0l0ZW1zLnB1c2goewogICAgICAgIGl0ZW06ICJHZW5kZXIiLAogICAgICAgIHBvaW50czogU0NPUkVfQ1JJVEVSSUEuYmFzaWNJbmZvLmdlbmRlciwKICAgICAgICBzdWdnZXN0aW9uOiAiU3BlY2lmeSB5b3VyIGdlbmRlciIsCiAgICAgIH0pOwogICAgfQoKICAgIGlmIChwcm9maWxlPy5sb2NhdGlvbikgewogICAgICB0b3RhbFNjb3JlICs9IFNDT1JFX0NSSVRFUklBLmJhc2ljSW5mby5sb2NhdGlvbjsKICAgICAgY29tcGxldGVkSXRlbXMucHVzaCgibG9jYXRpb24iKTsKICAgIH0gZWxzZSB7CiAgICAgIG1pc3NpbmdJdGVtcy5wdXNoKHsKICAgICAgICBpdGVtOiAiTG9jYXRpb24iLAogICAgICAgIHBvaW50czogU0NPUkVfQ1JJVEVSSUEuYmFzaWNJbmZvLmxvY2F0aW9uLAogICAgICAgIHN1Z2dlc3Rpb246ICJBZGQgeW91ciBsb2NhdGlvbiB0byBmaW5kIG5lYXJieSBtYXRjaGVzIiwKICAgICAgfSk7CiAgICB9CgogICAgLy8gUGhvdG9zIC0gUXVlcnkgZnJvbSBwaG90b3MgdGFibGUKICAgIGNvbnN0IHBob3RvcyA9IGF3YWl0IGN0eC5kYgogICAgICAucXVlcnkoInBob3RvcyIpCiAgICAgIC53aXRoSW5kZXgoInVzZXJJZCIsIChxKSA9PiBxLmVxKCJ1c2VySWQiLCBhcmdzLnVzZXJJZCkpCiAgICAgIC5jb2xsZWN0KCk7CiAgICAKICAgIGNvbnN0IHBob3RvQ291bnQgPSBwaG90b3MubGVuZ3RoOwogICAgaWYgKHBob3RvQ291bnQgPiAwKSB7CiAgICAgIHRvdGFsU2NvcmUgKz0gU0NPUkVfQ1JJVEVSSUEucGhvdG9zLnByaW1hcnlQaG90bzsKICAgICAgY29tcGxldGVkSXRlbXMucHVzaCgicHJpbWFyeVBob3RvIik7CiAgICB9IGVsc2UgewogICAgICBtaXNzaW5nSXRlbXMucHVzaCh7CiAgICAgICAgaXRlbTogIlByb2ZpbGUgUGhvdG8iLAogICAgICAgIHBvaW50czogU0NPUkVfQ1JJVEVSSUEucGhvdG9zLnByaW1hcnlQaG90bywKICAgICAgICBzdWdnZXN0aW9uOiAiQWRkIGF0IGxlYXN0IG9uZSBwaG90byB0byBnZXQgMTB4IG1vcmUgbWF0Y2hlcyIsCiAgICAgIH0pOwogICAgfQoKICAgIGlmIChwaG90b0NvdW50ID49IDMpIHsKICAgICAgdG90YWxTY29yZSArPSBTQ09SRV9DUklURVJJQS5waG90b3MudGhyZWVQaG90b3M7CiAgICAgIGNvbXBsZXRlZEl0ZW1zLnB1c2goInRocmVlUGhvdG9zIik7CiAgICB9IGVsc2UgaWYgKHBob3RvQ291bnQgPiAwKSB7CiAgICAgIG1pc3NpbmdJdGVtcy5wdXNoKHsKICAgICAgICBpdGVtOiAiTW9yZSBQaG90b3MiLAogICAgICAgIHBvaW50czogU0NPUkVfQ1JJVEVSSUEucGhvdG9zLnRocmVlUGhvdG9zLAogICAgICAgIHN1Z2dlc3Rpb246IGBBZGQgJHszIC0gcGhvdG9Db3VudH0gbW9yZSBwaG90byR7MyAtIHBob3RvQ291bnQgPiAxID8gInMiIDogIiJ9IGZvciBiZXR0ZXIgdmlzaWJpbGl0eWAsCiAgICAgIH0pOwogICAgfQoKICAgIGlmIChwaG90b0NvdW50ID49IDUpIHsKICAgICAgdG90YWxTY29yZSArPSBTQ09SRV9DUklURVJJQS5waG90b3MuZml2ZVBob3RvczsKICAgICAgY29tcGxldGVkSXRlbXMucHVzaCgiZml2ZVBob3RvcyIpOwogICAgfSBlbHNlIGlmIChwaG90b0NvdW50ID49IDMpIHsKICAgICAgbWlzc2luZ0l0ZW1zLnB1c2goewogICAgICAgIGl0ZW06ICJGdWxsIFBob3RvIEdhbGxlcnkiLAogICAgICAgIHBvaW50czogU0NPUkVfQ1JJVEVSSUEucGhvdG9zLmZpdmVQaG90b3MsCiAgICAgICAgc3VnZ2VzdGlvbjogYEFkZCAkezUgLSBwaG90b0NvdW50fSBtb3JlIHBob3RvJHs1IC0gcGhvdG9Db3VudCA+IDEgPyAicyIgOiAiIn0gdG8gbWF4aW1pemUgeW91ciBwcm9maWxlYCwKICAgICAgfSk7CiAgICB9CgogICAgLy8gQWJvdXQvQmlvCiAgICBpZiAocHJvZmlsZT8uYmlvKSB7CiAgICAgIHRvdGFsU2NvcmUgKz0gU0NPUkVfQ1JJVEVSSUEuYWJvdXQuYmlvOwogICAgICBjb21wbGV0ZWRJdGVtcy5wdXNoKCJiaW8iKTsKCiAgICAgIGlmIChwcm9maWxlLmJpby5sZW5ndGggPj0gMTAwKSB7CiAgICAgICAgdG90YWxTY29yZSArPSBTQ09SRV9DUklURVJJQS5hYm91dC5iaW9MZW5ndGg7CiAgICAgICAgY29tcGxldGVkSXRlbXMucHVzaCgiYmlvTGVuZ3RoIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbWlzc2luZ0l0ZW1zLnB1c2goewogICAgICAgICAgaXRlbTogIkRldGFpbGVkIEJpbyIsCiAgICAgICAgICBwb2ludHM6IFNDT1JFX0NSSVRFUklBLmFib3V0LmJpb0xlbmd0aCwKICAgICAgICAgIHN1Z2dlc3Rpb246ICJXcml0ZSBhdCBsZWFzdCAxMDAgY2hhcmFjdGVycyB0byBzaG93IHlvdXIgcGVyc29uYWxpdHkiLAogICAgICAgIH0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBtaXNzaW5nSXRlbXMucHVzaCh7CiAgICAgICAgaXRlbTogIkJpbyIsCiAgICAgICAgcG9pbnRzOiBTQ09SRV9DUklURVJJQS5hYm91dC5iaW8gKyBTQ09SRV9DUklURVJJQS5hYm91dC5iaW9MZW5ndGgsCiAgICAgICAgc3VnZ2VzdGlvbjogIldyaXRlIGEgYmlvIHRvIHRlbGwgbWF0Y2hlcyBhYm91dCB5b3Vyc2VsZiIsCiAgICAgIH0pOwogICAgfQoKICAgIC8vIFByZWZlcmVuY2VzIC0gUXVlcnkgZnJvbSBwcmVmZXJlbmNlcyB0YWJsZQogICAgY29uc3QgcHJlZmVyZW5jZXMgPSBhd2FpdCBjdHguZGIKICAgICAgLnF1ZXJ5KCJwcmVmZXJlbmNlcyIpCiAgICAgIC53aXRoSW5kZXgoInVzZXJJZCIsIChxKSA9PiBxLmVxKCJ1c2VySWQiLCBhcmdzLnVzZXJJZCkpCiAgICAgIC5maXJzdCgpOwoKICAgIGlmIChwcmVmZXJlbmNlcz8ubWluQWdlICYmIHByZWZlcmVuY2VzPy5tYXhBZ2UpIHsKICAgICAgdG90YWxTY29yZSArPSBTQ09SRV9DUklURVJJQS5wcmVmZXJlbmNlcy5hZ2VSYW5nZTsKICAgICAgY29tcGxldGVkSXRlbXMucHVzaCgiYWdlUmFuZ2UiKTsKICAgIH0gZWxzZSB7CiAgICAgIG1pc3NpbmdJdGVtcy5wdXNoKHsKICAgICAgICBpdGVtOiAiQWdlIFByZWZlcmVuY2UiLAogICAgICAgIHBvaW50czogU0NPUkVfQ1JJVEVSSUEucHJlZmVyZW5jZXMuYWdlUmFuZ2UsCiAgICAgICAgc3VnZ2VzdGlvbjogIlNldCB5b3VyIHByZWZlcnJlZCBhZ2UgcmFuZ2UiLAogICAgICB9KTsKICAgIH0KCiAgICBpZiAocHJlZmVyZW5jZXM/Lm1heERpc3RhbmNlKSB7CiAgICAgIHRvdGFsU2NvcmUgKz0gU0NPUkVfQ1JJVEVSSUEucHJlZmVyZW5jZXMuZGlzdGFuY2U7CiAgICAgIGNvbXBsZXRlZEl0ZW1zLnB1c2goImRpc3RhbmNlIik7CiAgICB9IGVsc2UgewogICAgICBtaXNzaW5nSXRlbXMucHVzaCh7CiAgICAgICAgaXRlbTogIkRpc3RhbmNlIFByZWZlcmVuY2UiLAogICAgICAgIHBvaW50czogU0NPUkVfQ1JJVEVSSUEucHJlZmVyZW5jZXMuZGlzdGFuY2UsCiAgICAgICAgc3VnZ2VzdGlvbjogIlNldCB5b3VyIHByZWZlcnJlZCBkaXN0YW5jZSByYW5nZSIsCiAgICAgIH0pOwogICAgfQoKICAgIGlmIChwcm9maWxlPy5yZWxhdGlvbnNoaXBHb2FsKSB7CiAgICAgIHRvdGFsU2NvcmUgKz0gU0NPUkVfQ1JJVEVSSUEucHJlZmVyZW5jZXMubG9va2luZ0ZvcjsKICAgICAgY29tcGxldGVkSXRlbXMucHVzaCgibG9va2luZ0ZvciIpOwogICAgfSBlbHNlIHsKICAgICAgbWlzc2luZ0l0ZW1zLnB1c2goewogICAgICAgIGl0ZW06ICJSZWxhdGlvbnNoaXAgR29hbHMiLAogICAgICAgIHBvaW50czogU0NPUkVfQ1JJVEVSSUEucHJlZmVyZW5jZXMubG9va2luZ0ZvciwKICAgICAgICBzdWdnZXN0aW9uOiAiU2hhcmUgd2hhdCB5b3UncmUgbG9va2luZyBmb3IiLAogICAgICB9KTsKICAgIH0KCiAgICAvLyBQcm9tcHRzIC0gUXVlcnkgZnJvbSBwcm9tcHRBbnN3ZXJzIHRhYmxlCiAgICBjb25zdCBwcm9tcHRBbnN3ZXJzID0gYXdhaXQgY3R4LmRiCiAgICAgIC5xdWVyeSgicHJvbXB0QW5zd2VycyIpCiAgICAgIC53aXRoSW5kZXgoInVzZXJJZCIsIChxKSA9PiBxLmVxKCJ1c2VySWQiLCBhcmdzLnVzZXJJZCkpCiAgICAgIC5jb2xsZWN0KCk7CiAgICAKICAgIGNvbnN0IHByb21wdENvdW50ID0gcHJvbXB0QW5zd2Vycy5sZW5ndGg7CiAgICBpZiAocHJvbXB0Q291bnQgPj0gMSkgewogICAgICB0b3RhbFNjb3JlICs9IFNDT1JFX0NSSVRFUklBLnByb21wdHMub25lUHJvbXB0OwogICAgICBjb21wbGV0ZWRJdGVtcy5wdXNoKCJvbmVQcm9tcHQiKTsKICAgIH0gZWxzZSB7CiAgICAgIG1pc3NpbmdJdGVtcy5wdXNoKHsKICAgICAgICBpdGVtOiAiRmlyc3QgUHJvbXB0IiwKICAgICAgICBwb2ludHM6IFNDT1JFX0NSSVRFUklBLnByb21wdHMub25lUHJvbXB0LAogICAgICAgIHN1Z2dlc3Rpb246ICJBbnN3ZXIgYSBwcm9tcHQgdG8gc3RhcnQgY29udmVyc2F0aW9ucyIsCiAgICAgIH0pOwogICAgfQoKICAgIGlmIChwcm9tcHRDb3VudCA+PSAzKSB7CiAgICAgIHRvdGFsU2NvcmUgKz0gU0NPUkVfQ1JJVEVSSUEucHJvbXB0cy50aHJlZVByb21wdHM7CiAgICAgIGNvbXBsZXRlZEl0ZW1zLnB1c2goInRocmVlUHJvbXB0cyIpOwogICAgfSBlbHNlIGlmIChwcm9tcHRDb3VudCA+PSAxKSB7CiAgICAgIG1pc3NpbmdJdGVtcy5wdXNoKHsKICAgICAgICBpdGVtOiAiTW9yZSBQcm9tcHRzIiwKICAgICAgICBwb2ludHM6IFNDT1JFX0NSSVRFUklBLnByb21wdHMudGhyZWVQcm9tcHRzLAogICAgICAgIHN1Z2dlc3Rpb246IGBBbnN3ZXIgJHszIC0gcHJvbXB0Q291bnR9IG1vcmUgcHJvbXB0JHszIC0gcHJvbXB0Q291bnQgPiAxID8gInMiIDogIiJ9YCwKICAgICAgfSk7CiAgICB9CgogICAgaWYgKHByb21wdENvdW50ID49IDUpIHsKICAgICAgdG90YWxTY29yZSArPSBTQ09SRV9DUklURVJJQS5wcm9tcHRzLmZpdmVQcm9tcHRzOwogICAgICBjb21wbGV0ZWRJdGVtcy5wdXNoKCJmaXZlUHJvbXB0cyIpOwogICAgfSBlbHNlIGlmIChwcm9tcHRDb3VudCA+PSAzKSB7CiAgICAgIG1pc3NpbmdJdGVtcy5wdXNoKHsKICAgICAgICBpdGVtOiAiRnVsbCBQcm9tcHQgU2V0IiwKICAgICAgICBwb2ludHM6IFNDT1JFX0NSSVRFUklBLnByb21wdHMuZml2ZVByb21wdHMsCiAgICAgICAgc3VnZ2VzdGlvbjogYEFuc3dlciAkezUgLSBwcm9tcHRDb3VudH0gbW9yZSBwcm9tcHQkezUgLSBwcm9tcHRDb3VudCA+IDEgPyAicyIgOiAiIn1gLAogICAgICB9KTsKICAgIH0KCiAgICAvLyBWZXJpZmljYXRpb24KICAgIGlmICh1c2VyLnBob25lTnVtYmVyKSB7CiAgICAgIHRvdGFsU2NvcmUgKz0gU0NPUkVfQ1JJVEVSSUEudmVyaWZpY2F0aW9uLnBob25lVmVyaWZpZWQ7CiAgICAgIGNvbXBsZXRlZEl0ZW1zLnB1c2goInBob25lVmVyaWZpZWQiKTsKICAgIH0gZWxzZSB7CiAgICAgIG1pc3NpbmdJdGVtcy5wdXNoKHsKICAgICAgICBpdGVtOiAiUGhvbmUgVmVyaWZpY2F0aW9uIiwKICAgICAgICBwb2ludHM6IFNDT1JFX0NSSVRFUklBLnZlcmlmaWNhdGlvbi5waG9uZVZlcmlmaWVkLAogICAgICAgIHN1Z2dlc3Rpb246ICJWZXJpZnkgeW91ciBwaG9uZSBudW1iZXIgZm9yIHNlY3VyaXR5IiwKICAgICAgfSk7CiAgICB9CgogICAgLy8gQ2hlY2sgcGhvdG8gdmVyaWZpY2F0aW9uCiAgICBjb25zdCB2ZXJpZmljYXRpb24gPSBhd2FpdCBjdHguZGIKICAgICAgLnF1ZXJ5KCJ2ZXJpZmljYXRpb25zIikKICAgICAgLndpdGhJbmRleCgidXNlcklkIiwgKHEpID0+IHEuZXEoInVzZXJJZCIsIGFyZ3MudXNlcklkKSkKICAgICAgLmZpbHRlcigocSkgPT4gcS5lcShxLmZpZWxkKCJzdGF0dXMiKSwgImFwcHJvdmVkIikpCiAgICAgIC5maXJzdCgpOwoKICAgIGlmICh2ZXJpZmljYXRpb24pIHsKICAgICAgdG90YWxTY29yZSArPSBTQ09SRV9DUklURVJJQS52ZXJpZmljYXRpb24ucGhvdG9WZXJpZmllZDsKICAgICAgY29tcGxldGVkSXRlbXMucHVzaCgicGhvdG9WZXJpZmllZCIpOwogICAgfSBlbHNlIHsKICAgICAgbWlzc2luZ0l0ZW1zLnB1c2goewogICAgICAgIGl0ZW06ICJQaG90byBWZXJpZmljYXRpb24iLAogICAgICAgIHBvaW50czogU0NPUkVfQ1JJVEVSSUEudmVyaWZpY2F0aW9uLnBob3RvVmVyaWZpZWQsCiAgICAgICAgc3VnZ2VzdGlvbjogIkdldCB2ZXJpZmllZCBmb3IgYSBiYWRnZSBhbmQgMnggdmlzaWJpbGl0eSIsCiAgICAgIH0pOwogICAgfQoKICAgIGNvbnN0IG1heFNjb3JlID0gMTAwOwogICAgY29uc3QgcGVyY2VudGFnZSA9IE1hdGgucm91bmQoKHRvdGFsU2NvcmUgLyBtYXhTY29yZSkgKiAxMDApOwoKICAgIHJldHVybiB7CiAgICAgIHRvdGFsU2NvcmUsCiAgICAgIG1heFNjb3JlLAogICAgICBwZXJjZW50YWdlLAogICAgICBjb21wbGV0ZWRJdGVtcywKICAgICAgbWlzc2luZ0l0ZW1zLAogICAgfTsKICB9LAp9KTsKCmV4cG9ydCBjb25zdCBnZXRQcm9maWxlVGllciA9IHF1ZXJ5KHsKICBhcmdzOiB7CiAgICB1c2VySWQ6IHYuaWQoInVzZXJzIiksCiAgfSwKICBoYW5kbGVyOiBhc3luYyAoY3R4LCBhcmdzKSA9PiB7CiAgICAvLyBJbmxpbmUgdGhlIGNhbGN1bGF0aW9uIHNpbmNlIHdlIGNhbid0IGNhbGwgcXVlcmllcyBmcm9tIHF1ZXJpZXMKICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBjdHguZGIuZ2V0KGFyZ3MudXNlcklkKTsKICAgIGlmICghdXNlcikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlVzZXIgbm90IGZvdW5kIik7CiAgICB9CgogICAgY29uc3QgcHJvZmlsZSA9IGF3YWl0IGN0eC5kYgogICAgICAucXVlcnkoInByb2ZpbGVzIikKICAgICAgLndpdGhJbmRleCgidXNlcklkIiwgKHEpID0+IHEuZXEoInVzZXJJZCIsIGFyZ3MudXNlcklkKSkKICAgICAgLmZpcnN0KCk7CgogICAgbGV0IHRvdGFsU2NvcmUgPSAwOwogICAgY29uc3QgY29tcGxldGVkSXRlbXM6IHN0cmluZ1tdID0gW107CiAgICBjb25zdCBtaXNzaW5nSXRlbXM6IEFycmF5PHsKICAgICAgaXRlbTogc3RyaW5nOwogICAgICBwb2ludHM6IG51bWJlcjsKICAgICAgc3VnZ2VzdGlvbjogc3RyaW5nOwogICAgfT4gPSBbXTsKCiAgICAvLyBDYWxjdWxhdGUgYWxsIHRoZSBzY29yaW5nIGhlcmUgKGFiYnJldmlhdGVkIGZvciBicmV2aXR5IC0gY29weSBsb2dpYyBmcm9tIGNhbGN1bGF0ZVByb2ZpbGVTY29yZSkKICAgIC8vIEZvciBub3csIHVzZSBhIHNpbXBsaWZpZWQgdmVyc2lvbgogICAgaWYgKHByb2ZpbGUpIHsKICAgICAgdG90YWxTY29yZSA9IHByb2ZpbGUuY29tcGxldGVuZXNzIHx8IDA7CiAgICB9CiAgICAKICAgIGNvbnN0IHNjb3JlID0gewogICAgICB0b3RhbFNjb3JlLAogICAgICBtYXhTY29yZTogMTAwLAogICAgICBwZXJjZW50YWdlOiB0b3RhbFNjb3JlLAogICAgICBjb21wbGV0ZWRJdGVtcywKICAgICAgbWlzc2luZ0l0ZW1zLAogICAgfTsKICAgIAogICAgbGV0IHRpZXI6ICJpbmNvbXBsZXRlIiB8ICJiYXNpYyIgfCAiZ29vZCIgfCAiZ3JlYXQiIHwgImV4Y2VsbGVudCI7CiAgICBsZXQgdGllckNvbG9yOiBzdHJpbmc7CiAgICBsZXQgdGllck1lc3NhZ2U6IHN0cmluZzsKCiAgICBpZiAoc2NvcmUucGVyY2VudGFnZSA8IDMwKSB7CiAgICAgIHRpZXIgPSAiaW5jb21wbGV0ZSI7CiAgICAgIHRpZXJDb2xvciA9ICJ0ZXh0LXJlZC01MDAiOwogICAgICB0aWVyTWVzc2FnZSA9ICJDb21wbGV0ZSB5b3VyIHByb2ZpbGUgdG8gZ2V0IG1hdGNoZXMiOwogICAgfSBlbHNlIGlmIChzY29yZS5wZXJjZW50YWdlIDwgNTApIHsKICAgICAgdGllciA9ICJiYXNpYyI7CiAgICAgIHRpZXJDb2xvciA9ICJ0ZXh0LW9yYW5nZS01MDAiOwogICAgICB0aWVyTWVzc2FnZSA9ICJBZGQgbW9yZSBkZXRhaWxzIHRvIHN0YW5kIG91dCI7CiAgICB9IGVsc2UgaWYgKHNjb3JlLnBlcmNlbnRhZ2UgPCA3MCkgewogICAgICB0aWVyID0gImdvb2QiOwogICAgICB0aWVyQ29sb3IgPSAidGV4dC15ZWxsb3ctNTAwIjsKICAgICAgdGllck1lc3NhZ2UgPSAiTG9va2luZyBnb29kISBLZWVwIGltcHJvdmluZyI7CiAgICB9IGVsc2UgaWYgKHNjb3JlLnBlcmNlbnRhZ2UgPCA5MCkgewogICAgICB0aWVyID0gImdyZWF0IjsKICAgICAgdGllckNvbG9yID0gInRleHQtYmx1ZS01MDAiOwogICAgICB0aWVyTWVzc2FnZSA9ICJHcmVhdCBwcm9maWxlISBBbG1vc3QgcGVyZmVjdCI7CiAgICB9IGVsc2UgewogICAgICB0aWVyID0gImV4Y2VsbGVudCI7CiAgICAgIHRpZXJDb2xvciA9ICJ0ZXh0LWdyZWVuLTUwMCI7CiAgICAgIHRpZXJNZXNzYWdlID0gIkV4Y2VsbGVudCBwcm9maWxlISBZb3UncmUgYWxsIHNldCI7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgLi4uc2NvcmUsCiAgICAgIHRpZXIsCiAgICAgIHRpZXJDb2xvciwKICAgICAgdGllck1lc3NhZ2UsCiAgICB9OwogIH0sCn0pOwo="}