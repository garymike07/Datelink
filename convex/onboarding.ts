{"data":"aW1wb3J0IHsgdiB9IGZyb20gImNvbnZleC92YWx1ZXMiOwppbXBvcnQgeyBtdXRhdGlvbiwgcXVlcnkgfSBmcm9tICIuL19nZW5lcmF0ZWQvc2VydmVyIjsKaW1wb3J0IHsgRG9jLCBJZCB9IGZyb20gIi4vX2dlbmVyYXRlZC9kYXRhTW9kZWwiOwoKLy8gR2V0IG9uYm9hcmRpbmcgcHJvZ3Jlc3MgZm9yIGEgdXNlcgpleHBvcnQgY29uc3QgZ2V0UHJvZ3Jlc3MgPSBxdWVyeSh7CiAgYXJnczogeyB1c2VySWQ6IHYuaWQoInVzZXJzIikgfSwKICBoYW5kbGVyOiBhc3luYyAoY3R4LCBhcmdzKSA9PiB7CiAgICBjb25zdCBwcm9ncmVzcyA9IGF3YWl0IGN0eC5kYgogICAgICAucXVlcnkoIm9uYm9hcmRpbmdQcm9ncmVzcyIpCiAgICAgIC53aXRoSW5kZXgoInVzZXJJZCIsIChxKSA9PiBxLmVxKCJ1c2VySWQiLCBhcmdzLnVzZXJJZCkpCiAgICAgIC5maXJzdCgpOwoKICAgIHJldHVybiBwcm9ncmVzczsKICB9LAp9KTsKCi8vIEluaXRpYWxpemUgb3IgdXBkYXRlIG9uYm9hcmRpbmcgcHJvZ3Jlc3MKZXhwb3J0IGNvbnN0IHVwZGF0ZVByb2dyZXNzID0gbXV0YXRpb24oewogIGFyZ3M6IHsKICAgIHVzZXJJZDogdi5pZCgidXNlcnMiKSwKICAgIGN1cnJlbnRTdGVwOiB2Lm51bWJlcigpLAogICAgY29tcGxldGVkU3RlcHM6IHYub3B0aW9uYWwodi5hcnJheSh2Lm51bWJlcigpKSksCiAgICBza2lwcGVkU3RlcHM6IHYub3B0aW9uYWwodi5hcnJheSh2Lm51bWJlcigpKSksCiAgfSwKICBoYW5kbGVyOiBhc3luYyAoY3R4LCBhcmdzKSA9PiB7CiAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IGN0eC5kYgogICAgICAucXVlcnkoIm9uYm9hcmRpbmdQcm9ncmVzcyIpCiAgICAgIC53aXRoSW5kZXgoInVzZXJJZCIsIChxKSA9PiBxLmVxKCJ1c2VySWQiLCBhcmdzLnVzZXJJZCkpCiAgICAgIC5maXJzdCgpOwoKICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7CgogICAgaWYgKGV4aXN0aW5nKSB7CiAgICAgIC8vIFVwZGF0ZSBleGlzdGluZyBwcm9ncmVzcwogICAgICBhd2FpdCBjdHguZGIucGF0Y2goZXhpc3RpbmcuX2lkLCB7CiAgICAgICAgY3VycmVudFN0ZXA6IGFyZ3MuY3VycmVudFN0ZXAsCiAgICAgICAgY29tcGxldGVkU3RlcHM6IGFyZ3MuY29tcGxldGVkU3RlcHMgPz8gZXhpc3RpbmcuY29tcGxldGVkU3RlcHMsCiAgICAgICAgc2tpcHBlZFN0ZXBzOiBhcmdzLnNraXBwZWRTdGVwcyA/PyBleGlzdGluZy5za2lwcGVkU3RlcHMsCiAgICAgICAgbGFzdFVwZGF0ZWRBdDogbm93LAogICAgICB9KTsKICAgICAgcmV0dXJuIGV4aXN0aW5nLl9pZDsKICAgIH0gZWxzZSB7CiAgICAgIC8vIENyZWF0ZSBuZXcgcHJvZ3Jlc3MgcmVjb3JkCiAgICAgIGNvbnN0IHByb2dyZXNzSWQgPSBhd2FpdCBjdHguZGIuaW5zZXJ0KCJvbmJvYXJkaW5nUHJvZ3Jlc3MiLCB7CiAgICAgICAgdXNlcklkOiBhcmdzLnVzZXJJZCwKICAgICAgICBjdXJyZW50U3RlcDogYXJncy5jdXJyZW50U3RlcCwKICAgICAgICBjb21wbGV0ZWRTdGVwczogYXJncy5jb21wbGV0ZWRTdGVwcyA/PyBbXSwKICAgICAgICBza2lwcGVkU3RlcHM6IGFyZ3Muc2tpcHBlZFN0ZXBzID8/IFtdLAogICAgICAgIHN0YXJ0ZWRBdDogbm93LAogICAgICAgIGxhc3RVcGRhdGVkQXQ6IG5vdywKICAgICAgfSk7CiAgICAgIHJldHVybiBwcm9ncmVzc0lkOwogICAgfQogIH0sCn0pOwoKLy8gTWFyayBhIHN0ZXAgYXMgY29tcGxldGVkCmV4cG9ydCBjb25zdCBjb21wbGV0ZVN0ZXAgPSBtdXRhdGlvbih7CiAgYXJnczogewogICAgdXNlcklkOiB2LmlkKCJ1c2VycyIpLAogICAgc3RlcE51bWJlcjogdi5udW1iZXIoKSwKICB9LAogIGhhbmRsZXI6IGFzeW5jIChjdHgsIGFyZ3MpID0+IHsKICAgIGxldCBwcm9ncmVzcyA9IGF3YWl0IGN0eC5kYgogICAgICAucXVlcnkoIm9uYm9hcmRpbmdQcm9ncmVzcyIpCiAgICAgIC53aXRoSW5kZXgoInVzZXJJZCIsIChxKSA9PiBxLmVxKCJ1c2VySWQiLCBhcmdzLnVzZXJJZCkpCiAgICAgIC5maXJzdCgpOwoKICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7CgogICAgLy8gSWYgbm8gcHJvZ3Jlc3MgZXhpc3RzLCBjcmVhdGUgaXQKICAgIGlmICghcHJvZ3Jlc3MpIHsKICAgICAgY29uc3QgcHJvZ3Jlc3NJZCA9IGF3YWl0IGN0eC5kYi5pbnNlcnQoIm9uYm9hcmRpbmdQcm9ncmVzcyIsIHsKICAgICAgICB1c2VySWQ6IGFyZ3MudXNlcklkLAogICAgICAgIGN1cnJlbnRTdGVwOiBhcmdzLnN0ZXBOdW1iZXIsCiAgICAgICAgY29tcGxldGVkU3RlcHM6IFtdLAogICAgICAgIHNraXBwZWRTdGVwczogW10sCiAgICAgICAgc3RhcnRlZEF0OiBub3csCiAgICAgICAgbGFzdFVwZGF0ZWRBdDogbm93LAogICAgICB9KTsKICAgICAgCiAgICAgIC8vIEZldGNoIHRoZSBuZXdseSBjcmVhdGVkIHByb2dyZXNzCiAgICAgIHByb2dyZXNzID0gYXdhaXQgY3R4LmRiLmdldChwcm9ncmVzc0lkKTsKICAgICAgaWYgKCFwcm9ncmVzcykgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiRmFpbGVkIHRvIGNyZWF0ZSBvbmJvYXJkaW5nIHByb2dyZXNzIik7CiAgICAgIH0KICAgIH0KCiAgICAvLyBBZGQgc3RlcCB0byBjb21wbGV0ZWQgc3RlcHMgaWYgbm90IGFscmVhZHkgdGhlcmUKICAgIGNvbnN0IGNvbXBsZXRlZFN0ZXBzID0gcHJvZ3Jlc3MuY29tcGxldGVkU3RlcHMuaW5jbHVkZXMoYXJncy5zdGVwTnVtYmVyKQogICAgICA/IHByb2dyZXNzLmNvbXBsZXRlZFN0ZXBzCiAgICAgIDogWy4uLnByb2dyZXNzLmNvbXBsZXRlZFN0ZXBzLCBhcmdzLnN0ZXBOdW1iZXJdOwoKICAgIC8vIFJlbW92ZSBmcm9tIHNraXBwZWQgc3RlcHMgaWYgaXQgd2FzIHRoZXJlCiAgICBjb25zdCBza2lwcGVkU3RlcHMgPSBwcm9ncmVzcy5za2lwcGVkU3RlcHMuZmlsdGVyKAogICAgICAocykgPT4gcyAhPT0gYXJncy5zdGVwTnVtYmVyCiAgICApOwoKICAgIGF3YWl0IGN0eC5kYi5wYXRjaChwcm9ncmVzcy5faWQsIHsKICAgICAgY29tcGxldGVkU3RlcHMsCiAgICAgIHNraXBwZWRTdGVwcywKICAgICAgbGFzdFVwZGF0ZWRBdDogbm93LAogICAgfSk7CgogICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9OwogIH0sCn0pOwoKLy8gU2tpcCBhIHN0ZXAKZXhwb3J0IGNvbnN0IHNraXBTdGVwID0gbXV0YXRpb24oewogIGFyZ3M6IHsKICAgIHVzZXJJZDogdi5pZCgidXNlcnMiKSwKICAgIHN0ZXBOdW1iZXI6IHYubnVtYmVyKCksCiAgfSwKICBoYW5kbGVyOiBhc3luYyAoY3R4LCBhcmdzKSA9PiB7CiAgICBsZXQgcHJvZ3Jlc3MgPSBhd2FpdCBjdHguZGIKICAgICAgLnF1ZXJ5KCJvbmJvYXJkaW5nUHJvZ3Jlc3MiKQogICAgICAud2l0aEluZGV4KCJ1c2VySWQiLCAocSkgPT4gcS5lcSgidXNlcklkIiwgYXJncy51c2VySWQpKQogICAgICAuZmlyc3QoKTsKCiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwoKICAgIC8vIElmIG5vIHByb2dyZXNzIGV4aXN0cywgY3JlYXRlIGl0CiAgICBpZiAoIXByb2dyZXNzKSB7CiAgICAgIGNvbnN0IHByb2dyZXNzSWQgPSBhd2FpdCBjdHguZGIuaW5zZXJ0KCJvbmJvYXJkaW5nUHJvZ3Jlc3MiLCB7CiAgICAgICAgdXNlcklkOiBhcmdzLnVzZXJJZCwKICAgICAgICBjdXJyZW50U3RlcDogYXJncy5zdGVwTnVtYmVyLAogICAgICAgIGNvbXBsZXRlZFN0ZXBzOiBbXSwKICAgICAgICBza2lwcGVkU3RlcHM6IFtdLAogICAgICAgIHN0YXJ0ZWRBdDogbm93LAogICAgICAgIGxhc3RVcGRhdGVkQXQ6IG5vdywKICAgICAgfSk7CiAgICAgIAogICAgICAvLyBGZXRjaCB0aGUgbmV3bHkgY3JlYXRlZCBwcm9ncmVzcwogICAgICBwcm9ncmVzcyA9IGF3YWl0IGN0eC5kYi5nZXQocHJvZ3Jlc3NJZCk7CiAgICAgIGlmICghcHJvZ3Jlc3MpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkZhaWxlZCB0byBjcmVhdGUgb25ib2FyZGluZyBwcm9ncmVzcyIpOwogICAgICB9CiAgICB9CgogICAgLy8gQWRkIHN0ZXAgdG8gc2tpcHBlZCBzdGVwcyBpZiBub3QgYWxyZWFkeSB0aGVyZQogICAgY29uc3Qgc2tpcHBlZFN0ZXBzID0gcHJvZ3Jlc3Muc2tpcHBlZFN0ZXBzLmluY2x1ZGVzKGFyZ3Muc3RlcE51bWJlcikKICAgICAgPyBwcm9ncmVzcy5za2lwcGVkU3RlcHMKICAgICAgOiBbLi4ucHJvZ3Jlc3Muc2tpcHBlZFN0ZXBzLCBhcmdzLnN0ZXBOdW1iZXJdOwoKICAgIGF3YWl0IGN0eC5kYi5wYXRjaChwcm9ncmVzcy5faWQsIHsKICAgICAgc2tpcHBlZFN0ZXBzLAogICAgICBsYXN0VXBkYXRlZEF0OiBub3csCiAgICB9KTsKCiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07CiAgfSwKfSk7CgovLyBDb21wbGV0ZSBlbnRpcmUgb25ib2FyZGluZwpleHBvcnQgY29uc3QgY29tcGxldGVPbmJvYXJkaW5nID0gbXV0YXRpb24oewogIGFyZ3M6IHsgdXNlcklkOiB2LmlkKCJ1c2VycyIpIH0sCiAgaGFuZGxlcjogYXN5bmMgKGN0eCwgYXJncykgPT4gewogICAgbGV0IHByb2dyZXNzID0gYXdhaXQgY3R4LmRiCiAgICAgIC5xdWVyeSgib25ib2FyZGluZ1Byb2dyZXNzIikKICAgICAgLndpdGhJbmRleCgidXNlcklkIiwgKHEpID0+IHEuZXEoInVzZXJJZCIsIGFyZ3MudXNlcklkKSkKICAgICAgLmZpcnN0KCk7CgogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKCiAgICAvLyBJZiBubyBwcm9ncmVzcyBleGlzdHMsIGNyZWF0ZSBpdCAoZWRnZSBjYXNlKQogICAgaWYgKCFwcm9ncmVzcykgewogICAgICBjb25zdCBwcm9ncmVzc0lkID0gYXdhaXQgY3R4LmRiLmluc2VydCgib25ib2FyZGluZ1Byb2dyZXNzIiwgewogICAgICAgIHVzZXJJZDogYXJncy51c2VySWQsCiAgICAgICAgY3VycmVudFN0ZXA6IDUsCiAgICAgICAgY29tcGxldGVkU3RlcHM6IFsxLCAyLCAzLCA0LCA1XSwKICAgICAgICBza2lwcGVkU3RlcHM6IFtdLAogICAgICAgIHN0YXJ0ZWRBdDogbm93LAogICAgICAgIGxhc3RVcGRhdGVkQXQ6IG5vdywKICAgICAgICBjb21wbGV0ZWRBdDogbm93LAogICAgICB9KTsKICAgICAgCiAgICAgIHByb2dyZXNzID0gYXdhaXQgY3R4LmRiLmdldChwcm9ncmVzc0lkKTsKICAgICAgaWYgKCFwcm9ncmVzcykgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiRmFpbGVkIHRvIGNyZWF0ZSBvbmJvYXJkaW5nIHByb2dyZXNzIik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGF3YWl0IGN0eC5kYi5wYXRjaChwcm9ncmVzcy5faWQsIHsKICAgICAgICBjb21wbGV0ZWRBdDogbm93LAogICAgICAgIGxhc3RVcGRhdGVkQXQ6IG5vdywKICAgICAgfSk7CiAgICB9CgogICAgLy8gQ3JlYXRlIGEgd2VsY29tZSBub3RpZmljYXRpb24KICAgIGF3YWl0IGN0eC5kYi5pbnNlcnQoIm5vdGlmaWNhdGlvbnMiLCB7CiAgICAgIHVzZXJJZDogYXJncy51c2VySWQsCiAgICAgIHR5cGU6ICJwcm9maWxlX2NyZWF0ZWQiLAogICAgICB0aXRsZTogIldlbGNvbWUgdG8gRGF0ZUxpbmshIPCfjokiLAogICAgICBib2R5OiAiWW91ciBwcm9maWxlIGlzIGFsbCBzZXQuIFN0YXJ0IGRpc2NvdmVyaW5nIGFtYXppbmcgcGVvcGxlISIsCiAgICAgIHByaW9yaXR5OiAiaGlnaCIsCiAgICAgIGNhdGVnb3J5OiAic3lzdGVtIiwKICAgICAgaXNSZWFkOiBmYWxzZSwKICAgICAgY3JlYXRlZEF0OiBub3csCiAgICB9KTsKCiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBjb21wbGV0ZWRBdDogbm93IH07CiAgfSwKfSk7CgovLyBDaGVjayBpZiBvbmJvYXJkaW5nIGlzIGNvbXBsZXRlCmV4cG9ydCBjb25zdCBpc09uYm9hcmRpbmdDb21wbGV0ZSA9IHF1ZXJ5KHsKICBhcmdzOiB7IHVzZXJJZDogdi5pZCgidXNlcnMiKSB9LAogIGhhbmRsZXI6IGFzeW5jIChjdHgsIGFyZ3MpID0+IHsKICAgIGNvbnN0IHByb2dyZXNzID0gYXdhaXQgY3R4LmRiCiAgICAgIC5xdWVyeSgib25ib2FyZGluZ1Byb2dyZXNzIikKICAgICAgLndpdGhJbmRleCgidXNlcklkIiwgKHEpID0+IHEuZXEoInVzZXJJZCIsIGFyZ3MudXNlcklkKSkKICAgICAgLmZpcnN0KCk7CgogICAgcmV0dXJuIHsKICAgICAgaXNDb21wbGV0ZTogISFwcm9ncmVzcz8uY29tcGxldGVkQXQsCiAgICAgIGN1cnJlbnRTdGVwOiBwcm9ncmVzcz8uY3VycmVudFN0ZXAgPz8gMSwKICAgICAgY29tcGxldGVkU3RlcHM6IHByb2dyZXNzPy5jb21wbGV0ZWRTdGVwcyA/PyBbXSwKICAgIH07CiAgfSwKfSk7Cg=="}